<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="HTML5," />





  <link rel="alternate" href="/atom.xml" title="赖同学" type="application/atom+xml" />






<meta name="description" content="学习链接：HTML 5与CSS 3权威指南 W3cScholl CanvasHTML5 中的一个新增元素，可以在页面绘制出各种漂亮的图形与图像。 绘制图形canvas 元素就是 HTML5 中新增的一个用来绘制图形。在页面上放置一个 canvas元素，相当于在页面上放置一块画布，可以在其中进行图形绘制。 在页面中放置 canvas元素12345678910111213141516171819202">
<meta name="keywords" content="HTML5">
<meta property="og:type" content="article">
<meta property="og:title" content="面试官问我HTML5是什么（中）">
<meta property="og:url" content="http://laibh.top/面试官问我HTML5是什么（中）.html">
<meta property="og:site_name" content="赖同学">
<meta property="og:description" content="学习链接：HTML 5与CSS 3权威指南 W3cScholl CanvasHTML5 中的一个新增元素，可以在页面绘制出各种漂亮的图形与图像。 绘制图形canvas 元素就是 HTML5 中新增的一个用来绘制图形。在页面上放置一个 canvas元素，相当于在页面上放置一块画布，可以在其中进行图形绘制。 在页面中放置 canvas元素12345678910111213141516171819202">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2022-03-04T10:00:38.468Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="面试官问我HTML5是什么（中）">
<meta name="twitter:description" content="学习链接：HTML 5与CSS 3权威指南 W3cScholl CanvasHTML5 中的一个新增元素，可以在页面绘制出各种漂亮的图形与图像。 绘制图形canvas 元素就是 HTML5 中新增的一个用来绘制图形。在页面上放置一个 canvas元素，相当于在页面上放置一块画布，可以在其中进行图形绘制。 在页面中放置 canvas元素12345678910111213141516171819202">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '1YNH8Y3MP9',
      apiKey: '61c189facf700193dfcbb902369ce227',
      indexName: 'MyBlog',
      hits: {"per_page":10},
      labels: {"input_placeholder":"想要找些什么呢","hits_empty":"${query} 没有被找到，再试试","hits_stats":"在 ${time} ms 查找了${hits}个结果"}
    }
  };
</script>



  <link rel="canonical" href="http://laibh.top/面试官问我HTML5是什么（中）.html"/>





  <title>面试官问我HTML5是什么（中） | 赖同学</title>
  








</head>
<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">赖同学</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description"></h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            站点地图
          </a>
        </li>
      
        
        <li class="menu-item menu-item-guestbook">
          <a href="/guestbook" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-comment"></i> <br />
            
            留言
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://laibh.top/面试官问我HTML5是什么（中）.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="赖彬鸿">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/myPhoto.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="赖同学">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">面试官问我HTML5是什么（中）</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-25T09:30:54+08:00">
                2019-05-25
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2022-03-04T18:00:38+08:00">
                2022-03-04
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/前端面试/" itemprop="url" rel="index">
                    <span itemprop="name">前端面试</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/面试官问我HTML5是什么（中）.html" class="leancloud_visitors" data-flag-title="面试官问我HTML5是什么（中）">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  13,687
                </span>
              

              

              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>学习链接：<br><a href="https://read.douban.com/ebook/15160963/">HTML 5与CSS 3权威指南</a></p>
<p><a href="https://www.w3cschool.cn/html/">W3cScholl</a></p>
<h2 id="Canvas"><a href="#Canvas" class="headerlink" title="Canvas"></a>Canvas</h2><p>HTML5 中的一个新增元素，可以在页面绘制出各种漂亮的图形与图像。</p>
<h3 id="绘制图形"><a href="#绘制图形" class="headerlink" title="绘制图形"></a>绘制图形</h3><p>canvas 元素就是 HTML5 中新增的一个用来绘制图形。在页面上放置一个 <code>canvas</code>元素，相当于在页面上放置一块画布，可以在其中进行图形绘制。</p>
<h3 id="在页面中放置-canvas元素"><a href="#在页面中放置-canvas元素" class="headerlink" title="在页面中放置 canvas元素"></a>在页面中放置 canvas元素</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Canvas<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span>=<span class="string">"draw('canvas')"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">"canvas"</span> <span class="attr">width</span>=<span class="string">"400"</span> <span class="attr">height</span>=<span class="string">"300"</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"canvas.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--script--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params">id</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> canvas = <span class="built_in">document</span>.getElementById(id);</span></span><br><span class="line"><span class="javascript">  <span class="keyword">if</span> (!canvas) <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> context = canvas.getContext(<span class="string">'2d'</span>);</span></span><br><span class="line"><span class="javascript">  context.fillStyle = <span class="string">'#EEEEFF'</span>;</span></span><br><span class="line"><span class="undefined">  context.fillRect(0, 0, 400, 300);</span></span><br><span class="line"><span class="javascript">  context.fillStyle = <span class="string">'red'</span>;</span></span><br><span class="line"><span class="javascript">  context.strokeStyle = <span class="string">'blue'</span>;</span></span><br><span class="line"><span class="undefined">  context.lineWidth = 1;</span></span><br><span class="line"><span class="undefined">  context.fillRect(50,50,100,100);</span></span><br><span class="line"><span class="undefined">  context.strokeRect(50,50,100,100);</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>首先，要指定 ID,width,height 这三个属性。</p>
<h4 id="绘制矩形"><a href="#绘制矩形" class="headerlink" title="绘制矩形"></a>绘制矩形</h4><ol>
<li>取得 canvas 元素，用 DOM 方法取得要绘制的目标元素</li>
<li>取得上下文（context）。进行绘制的时候需要用到图形上下文（graphics context），图形上下文是一个封装了很多绘图功能的对象。使用 canvas 对象的 <code>getContext</code>方法来获得图形上下文。</li>
<li>填充与绘制边框。绘制图形的时候有两种方式：填充（fill）与绘制边框（stroke）。填充是指填充图形内部，绘制边框是指不填充图形内部，值绘制图形的外框。</li>
<li>设定绘图样式（style）。在进行图形绘制的时候，要设定好绘图的样式，然后调用相关的方法进行图形绘制。相关的属性有 fillStyle(填充图形的样式)，strokeStyle(图形边框的样式)</li>
<li>指定线宽。使用图形上下文对象的 lineWidth 属性设置图形边框的宽度。</li>
<li>指定颜色值。颜色名，或者十六进制的颜色值</li>
<li>分别使用 fillRect 与 strokeRect 方法来填充矩形和绘制矩形边框。</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">context.fillRect(x,y,width,height);</span><br><span class="line">context.strokeRect(x,y,width,height);</span><br></pre></td></tr></table></figure>
<p>还有一个 clearRect 方法，擦除指定矩形区域中的图形，使得矩形中的颜色全部变成透明。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">context.clearRect(x,y,width,height);</span><br></pre></td></tr></table></figure>
<h3 id="使用路径"><a href="#使用路径" class="headerlink" title="使用路径"></a>使用路径</h3><h4 id="绘制圆形"><a href="#绘制圆形" class="headerlink" title="绘制圆形"></a>绘制圆形</h4><p>使用路径绘制图形的过程：</p>
<ol>
<li>开始创建路径</li>
<li>创建图形的路径</li>
<li>路径创建完成后，关闭路径</li>
<li>设定绘制样式，调用绘制方法，绘制路径</li>
</ol>
<p>大概的意思就是，先用路径勾勒图形轮廓，然后设置颜色，进行绘制。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drawCircle</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> canvas = <span class="built_in">document</span>.getElementById(id);</span><br><span class="line">  <span class="keyword">if</span> (!canvas) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">const</span> context = canvas.getContext(<span class="string">'2d'</span>);</span><br><span class="line">  context.fillStyle = <span class="string">'#EEEEFF'</span>;</span><br><span class="line">  context.fillRect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">400</span>, <span class="number">300</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">    context.beginPath();</span><br><span class="line">    context.arc(i * <span class="number">25</span>, i * <span class="number">25</span>, i * <span class="number">10</span>, <span class="number">0</span>, <span class="built_in">Math</span>.PI * <span class="number">2</span>, <span class="literal">true</span>)</span><br><span class="line">    context.closePath();</span><br><span class="line">    context.fillStyle = <span class="string">'rgba(255,0,0,0.25)'</span>;</span><br><span class="line">    context.fill();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中，<code>context.arc(x,y,radius,startAngle,endAngle,anticlockwise)</code></p>
<p>这个方法使用了六个参数，<code>x</code>为绘制圆形的横坐标，<code>y</code>为纵坐标，<code>radius</code>为圆形半径，<code>startAngle</code>为开始的角度，<code>endAngle</code>为结束角度，<code>anticlockwise</code>为是否按顺时针方向进行绘制。</p>
<p>关于角度与弧度的计算</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> radius = degress * <span class="built_in">Math</span>.PI / <span class="number">180</span>;</span><br></pre></td></tr></table></figure>
<p><code>arc</code>方法不仅可以用阿里绘制圆形，也可以用来绘制圆弧。因此，使用时必须要指定开始角度与结束角度。因为这两个角度决定了弧度。<code>anticlockwise</code>为一个布尔值的参数，参数为 true 时，按顺时针绘制，参数为 false时，按逆时针绘制。</p>
<p>绘制完图形后，使用 <code>context.closePath()</code>将路径关闭，接着就可以使用 <code>fill</code>方法（<code>stroke</code>）填充图形与绘制图形边框了。</p>
<h4 id="不关闭路径"><a href="#不关闭路径" class="headerlink" title="不关闭路径"></a>不关闭路径</h4><p>如果不关闭路径，已经创建的路径会被永远保留，使用 fill 或者 stroke 绘制的时候会重复绘制已存在的路径</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drawCircle</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> canvas = <span class="built_in">document</span>.getElementById(id);</span><br><span class="line">  <span class="keyword">if</span> (!canvas) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">const</span> context = canvas.getContext(<span class="string">'2d'</span>);</span><br><span class="line">  context.fillStyle = <span class="string">'#EEEEFF'</span>;</span><br><span class="line">  context.fillRect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">400</span>, <span class="number">300</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">    context.arc(i * <span class="number">25</span>, i * <span class="number">25</span>, i * <span class="number">10</span>, <span class="number">0</span>, <span class="built_in">Math</span>.PI * <span class="number">2</span>, <span class="literal">true</span>)</span><br><span class="line">    context.fillStyle = <span class="string">'rgba(255,0,0,0.25)'</span>;</span><br><span class="line">    context.fill();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="绘制线"><a href="#绘制线" class="headerlink" title="绘制线"></a>绘制线</h4><p><strong>moveTo 与 lineTo</strong></p>
<p>moveTo 方法的作用是将光标移动到指定坐标，绘制直线的时候以这个坐标点为起点</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">moveTo(x,y)</span><br></pre></td></tr></table></figure>
<p>lineTo方法，也是用两个参数，x ，y表示直线终点的横纵坐标。使用该方法绘制直线后，光标会自动移动到 lineTo 方法参数所指定的直线终点。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drawLine</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> canvas = <span class="built_in">document</span>.getElementById(id);</span><br><span class="line">  <span class="keyword">if</span> (!canvas) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">const</span> context = canvas.getContext(<span class="string">'2d'</span>);</span><br><span class="line">  context.fillStyle = <span class="string">'#EEEEFF'</span>;</span><br><span class="line">  context.fillRect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">400</span>, <span class="number">300</span>);</span><br><span class="line">  <span class="keyword">let</span> dx = <span class="number">150</span>;</span><br><span class="line">  <span class="keyword">let</span> dy = <span class="number">150</span>;</span><br><span class="line">  <span class="keyword">let</span> s = <span class="number">100</span>;</span><br><span class="line">  context.beginPath();</span><br><span class="line">  context.fillStyle = <span class="string">'rgb(100,255,100)'</span>;</span><br><span class="line">  context.strokeStyle = <span class="string">'rgb(0,0,100)'</span>;</span><br><span class="line">  <span class="keyword">let</span> dig = <span class="built_in">Math</span>.PI / <span class="number">15</span> * <span class="number">11</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">30</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> x = <span class="built_in">Math</span>.sin(i * dig);</span><br><span class="line">    <span class="keyword">let</span> y = <span class="built_in">Math</span>.cos(i * dig);</span><br><span class="line">    context.lineTo(dx + x * s, dy + y * s);</span><br><span class="line">  &#125;</span><br><span class="line">  context.closePath()</span><br><span class="line">  context.fill();</span><br><span class="line">  context.stroke();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="使用-bezierCurveTo-绘制贝塞尔曲线"><a href="#使用-bezierCurveTo-绘制贝塞尔曲线" class="headerlink" title="使用 bezierCurveTo 绘制贝塞尔曲线"></a>使用 bezierCurveTo 绘制贝塞尔曲线</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">context.bezierCurveTo(cp1x,cp1y,cp2x,cpy2y,x,y);</span><br></pre></td></tr></table></figure>
<p>绘制曲线，需要两个控制点以及一点终点。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drawBezierLine</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> canvas = <span class="built_in">document</span>.getElementById(id);</span><br><span class="line">  <span class="keyword">if</span> (!canvas) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">const</span> context = canvas.getContext(<span class="string">'2d'</span>);</span><br><span class="line">  context.fillStyle = <span class="string">'#EEEEFF'</span>;</span><br><span class="line">  context.fillRect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">400</span>, <span class="number">300</span>);</span><br><span class="line">  <span class="keyword">let</span> dx = <span class="number">150</span>;</span><br><span class="line">  <span class="keyword">let</span> dy = <span class="number">150</span>;</span><br><span class="line">  <span class="keyword">let</span> s = <span class="number">100</span>;</span><br><span class="line">  context.beginPath();</span><br><span class="line">  context.fillStyle = <span class="string">'rgb(100,255,100)'</span>;</span><br><span class="line">  context.strokeStyle = <span class="string">'rgb(0,0,100)'</span>;</span><br><span class="line">  <span class="keyword">let</span> dig = <span class="built_in">Math</span>.PI / <span class="number">15</span> * <span class="number">11</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">30</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> x = <span class="built_in">Math</span>.sin(i * dig);</span><br><span class="line">    <span class="keyword">let</span> y = <span class="built_in">Math</span>.cos(i * dig);</span><br><span class="line">    context.bezierCurveTo(dx + x * s, dy + y * s - <span class="number">100</span>, dx + x * s + <span class="number">100</span>, dy + y * s, dx + x * s, dy + y * s);</span><br><span class="line">  &#125;</span><br><span class="line">  context.closePath()</span><br><span class="line">  context.fill();</span><br><span class="line">  context.stroke();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>quadraticCurveTo</code>方法绘制二次贝塞尔曲线</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">context.quadraticCurveTo(cpx,cpy,x,y)</span><br></pre></td></tr></table></figure>
<h3 id="绘制渐变图形"><a href="#绘制渐变图形" class="headerlink" title="绘制渐变图形"></a>绘制渐变图形</h3><h4 id="绘制线性渐变"><a href="#绘制线性渐变" class="headerlink" title="绘制线性渐变"></a>绘制线性渐变</h4><p>绘制线性渐变需要用到 <code>lineargradient</code>对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">context.createLinearGradient(xStart,yStart,xEnd,yEnd);</span><br></pre></td></tr></table></figure>
<p>接着使用 addColorStop 方法设定</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">context.addColorStop(offset,color);</span><br></pre></td></tr></table></figure>
<p>offset 为所设定的颜色离开渐变起始点的偏移量。参数的值是0到1之间的浮点值，渐变起始点的偏移量是0，渐变结束点的偏移量是1.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drawLineGradient</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> canvas = <span class="built_in">document</span>.getElementById(id);</span><br><span class="line">  <span class="keyword">if</span> (!canvas) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">const</span> context = canvas.getContext(<span class="string">'2d'</span>);</span><br><span class="line">  <span class="keyword">const</span> gl = context.createLinearGradient(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">300</span>);</span><br><span class="line">  gl.addColorStop(<span class="number">0</span>, <span class="string">'rgb(255,255,0)'</span>);</span><br><span class="line">  gl.addColorStop(<span class="number">1</span>, <span class="string">'rgb(0,255,255)'</span>);</span><br><span class="line">  context.fillStyle = gl;</span><br><span class="line">  context.fillRect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">400</span>, <span class="number">300</span>);</span><br><span class="line">  <span class="keyword">const</span> g2 = context.createLinearGradient(<span class="number">0</span>, <span class="number">0</span>, <span class="number">300</span>, <span class="number">0</span>);</span><br><span class="line">  g2.addColorStop(<span class="number">0</span>, <span class="string">'rgba(0,0,255,0.5)'</span>);</span><br><span class="line">  g2.addColorStop(<span class="number">0</span>, <span class="string">'rgba(255,0,0,0.5)'</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">    context.beginPath();</span><br><span class="line">    context.fillStyle = g2;</span><br><span class="line">    context.arc(i * <span class="number">25</span>, i * <span class="number">25</span>, i * <span class="number">10</span>, <span class="number">0</span>, <span class="built_in">Math</span>.PI * <span class="number">2</span>, <span class="literal">true</span>);</span><br><span class="line">    context.closePath();</span><br><span class="line">    context.fill();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="绘制径向渐变"><a href="#绘制径向渐变" class="headerlink" title="绘制径向渐变"></a>绘制径向渐变</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">context.createRadialGradient(xStart,yStart,radiusStart,xEnd,yEnd,radiusEnd);</span><br></pre></td></tr></table></figure>
<p>分别指定两个圆的大小和位置。从第一个圆的圆心处向外进行扩散渐变，一直扩散到第二个圆的外轮廓处。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drawRadialGradient</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> canvas = <span class="built_in">document</span>.getElementById(id);</span><br><span class="line">  <span class="keyword">if</span> (!canvas) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">const</span> context = canvas.getContext(<span class="string">'2d'</span>);</span><br><span class="line">  <span class="keyword">const</span> g1 = context.createRadialGradient(<span class="number">400</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">400</span>, <span class="number">0</span>, <span class="number">400</span>);</span><br><span class="line">  g1.addColorStop(<span class="number">0.1</span>, <span class="string">'rgb(255,255,0)'</span>);</span><br><span class="line">  g1.addColorStop(<span class="number">0.3</span>, <span class="string">'rgb(255,0,255)'</span>);</span><br><span class="line">  g1.addColorStop(<span class="number">1</span>, <span class="string">'rgb(0,255,255)'</span>);</span><br><span class="line">  context.fillStyle = g1;</span><br><span class="line">  context.fillRect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">400</span>, <span class="number">300</span>);</span><br><span class="line">  <span class="keyword">const</span> g2 = context.createRadialGradient(<span class="number">250</span>, <span class="number">250</span>, <span class="number">0</span>, <span class="number">250</span>, <span class="number">250</span>, <span class="number">300</span>);</span><br><span class="line">  g2.addColorStop(<span class="number">0.1</span>, <span class="string">'rgb(255,0,0,0.5)'</span>);</span><br><span class="line">  g2.addColorStop(<span class="number">0.7</span>, <span class="string">'rgb(255,255,0,0.5)'</span>);</span><br><span class="line">  g2.addColorStop(<span class="number">1</span>, <span class="string">'rgb(0,0,255,0.5)'</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">    context.beginPath();</span><br><span class="line">    context.fillStyle = g2;</span><br><span class="line">    context.arc(i * <span class="number">25</span>, i * <span class="number">25</span>, i * <span class="number">10</span>, <span class="number">0</span>, <span class="built_in">Math</span>.PI * <span class="number">2</span>, <span class="literal">true</span>);</span><br><span class="line">    context.closePath();</span><br><span class="line">    context.fill();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="绘制变形图形"><a href="#绘制变形图形" class="headerlink" title="绘制变形图形"></a>绘制变形图形</h3><h4 id="坐标变换"><a href="#坐标变换" class="headerlink" title="坐标变换"></a>坐标变换</h4><p>主要有三种形式：</p>
<ul>
<li>平移，使用图形上下文的 <code>translate</code>方法来移动图形坐标轴原点。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">context.translate(x,y);</span><br></pre></td></tr></table></figure>
<ul>
<li>扩大，使用对象的 <code>scale</code>方法将图形放大</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">context.scale(x,y)</span><br></pre></td></tr></table></figure>
<ul>
<li>旋转，使用 <code>rotate</code>方法将图形进行旋转</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">context.rotate(angle);</span><br></pre></td></tr></table></figure>
<p>旋转中西是坐标轴的原点，顺时针方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drawDeformationGraphics</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> canvas = <span class="built_in">document</span>.getElementById(id);</span><br><span class="line">  <span class="keyword">if</span> (!canvas) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">const</span> context = canvas.getContext(<span class="string">'2d'</span>);</span><br><span class="line">  context.fillStyle = <span class="string">'#EEEEFF'</span>;</span><br><span class="line">  context.fillRect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">400</span>, <span class="number">300</span>);</span><br><span class="line">   <span class="comment">// 改变圆心位置</span></span><br><span class="line">  context.translate(<span class="number">200</span>, <span class="number">50</span>);</span><br><span class="line">  context.fillStyle = <span class="string">'rgba(255,0,0,0.25)'</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">50</span>; i++) &#123;</span><br><span class="line">    context.translate(<span class="number">25</span>, <span class="number">25</span>);</span><br><span class="line">    context.scale(<span class="number">0.95</span>, <span class="number">0.95</span>);</span><br><span class="line">    context.rotate(<span class="built_in">Math</span>.PI / <span class="number">10</span>);</span><br><span class="line">    context.fillRect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">50</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的代码使用坐标变换的方法。首先绘制了一个长方形，然后在一个循环中反复使用平移坐标轴，图形缩小，图形旋转三种技巧绘制出来变形图形。</p>
<h4 id="与路径结合使用"><a href="#与路径结合使用" class="headerlink" title="与路径结合使用"></a>与路径结合使用</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drawDeformationGraphicsWithFivePointedStar</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> canvas = <span class="built_in">document</span>.getElementById(id);</span><br><span class="line">  <span class="keyword">if</span> (!canvas) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">const</span> context = canvas.getContext(<span class="string">'2d'</span>);</span><br><span class="line">  context.fillStyle = <span class="string">'#EEEEFF'</span>;</span><br><span class="line">  context.fillRect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">400</span>, <span class="number">300</span>);</span><br><span class="line">  context.translate(<span class="number">200</span>, <span class="number">50</span>);</span><br><span class="line">  context.fillStyle = <span class="string">'rgba(255,0,0,0.25)'</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">50</span>; i++) &#123;</span><br><span class="line">    context.translate(<span class="number">25</span>, <span class="number">25</span>);</span><br><span class="line">    context.scale(<span class="number">0.95</span>, <span class="number">0.95</span>);</span><br><span class="line">    context.rotate(<span class="built_in">Math</span>.PI / <span class="number">10</span>);</span><br><span class="line">    createFivePointedStar(context);</span><br><span class="line">    context.fill();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createFivePointedStar</span>(<span class="params">context</span>) </span>&#123;</span><br><span class="line">  context.beginPath();</span><br><span class="line">  context.fillStyle = <span class="string">'rgba(255,0,0,0.5)'</span>;</span><br><span class="line">  <span class="keyword">const</span> dx = <span class="number">100</span>;</span><br><span class="line">  <span class="keyword">const</span> dy = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">const</span> s = <span class="number">50</span>;</span><br><span class="line">  <span class="keyword">let</span> dig = <span class="built_in">Math</span>.PI / <span class="number">5</span> * <span class="number">4</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> x = <span class="built_in">Math</span>.sin(i * dig);</span><br><span class="line">    <span class="keyword">let</span> y = <span class="built_in">Math</span>.cos(i * dig);</span><br><span class="line">    context.lineTo(dx + x * s, dy + y * s);</span><br><span class="line">  &#125;</span><br><span class="line">  context.closePath();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="矩阵变换"><a href="#矩阵变换" class="headerlink" title="矩阵变换"></a>矩阵变换</h4><p>当图形上下文被创建完毕时，事实上也创建了一个默认的变换矩阵，如果不对这个变换矩阵进行修改，绘制的图形将以画布的最左上角为坐标原点绘制图形，绘制出来的图形也不经过缩放、变形的处理。我们可以对这个变换矩形进行修改</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">context.transform(a , b , c , d , e , f )</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align:left">参数</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><em>a</em></td>
<td style="text-align:left">水平缩放绘图</td>
</tr>
<tr>
<td style="text-align:left"><em>b</em></td>
<td style="text-align:left">水平倾斜绘图</td>
</tr>
<tr>
<td style="text-align:left"><em>c</em></td>
<td style="text-align:left">垂直倾斜绘图</td>
</tr>
<tr>
<td style="text-align:left"><em>d</em></td>
<td style="text-align:left">垂直缩放绘图</td>
</tr>
<tr>
<td style="text-align:left"><em>e</em></td>
<td style="text-align:left">水平移动绘图</td>
</tr>
<tr>
<td style="text-align:left"><em>f</em></td>
<td style="text-align:left">垂直移动绘图</td>
</tr>
</tbody>
</table>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drawTransform</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> canvas = <span class="built_in">document</span>.getElementById(id);</span><br><span class="line">  <span class="keyword">if</span> (!canvas) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">const</span> context = canvas.getContext(<span class="string">'2d'</span>);</span><br><span class="line">  <span class="keyword">const</span> colors = [<span class="string">'red'</span>, <span class="string">'orange'</span>, <span class="string">'yellow'</span>, <span class="string">'green'</span>, <span class="string">'blue'</span>, <span class="string">'navy'</span>, <span class="string">'purple'</span>];</span><br><span class="line">  context.lineWidth = <span class="number">10</span>;</span><br><span class="line">  context.transform(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">100</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; colors.length; i++) &#123;</span><br><span class="line">    <span class="comment">// 定义每次向下移动 10个像素的变换矩阵</span></span><br><span class="line">    context.transform(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">10</span>);</span><br><span class="line">    context.strokeStyle = colors[i];</span><br><span class="line">    context.beginPath();</span><br><span class="line">    context.arc(<span class="number">50</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">0</span>, <span class="built_in">Math</span>.PI, <span class="literal">true</span>);</span><br><span class="line">    context.stroke();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>setTransform 会将变换矩阵重置</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setTransform(m11,m12,m21,m22,dx,dy)</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drawSetTransform</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> canvas = <span class="built_in">document</span>.getElementById(id);</span><br><span class="line">  <span class="keyword">if</span> (!canvas) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">const</span> context = canvas.getContext(<span class="string">'2d'</span>);</span><br><span class="line">  context.strokeStyle = <span class="string">'red'</span>;</span><br><span class="line">  context.strokeRect(<span class="number">30</span>, <span class="number">10</span>, <span class="number">60</span>, <span class="number">20</span>);</span><br><span class="line">  <span class="keyword">let</span> rad = <span class="number">45</span> * <span class="built_in">Math</span>.PI / <span class="number">180</span>;</span><br><span class="line"></span><br><span class="line">  context.setTransform(<span class="built_in">Math</span>.cos(rad), <span class="built_in">Math</span>.sin(rad), -<span class="built_in">Math</span>.sin(rad), <span class="built_in">Math</span>.cos(rad), <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  context.strokeStyle = <span class="string">'blue'</span>;</span><br><span class="line">  context.strokeRect(<span class="number">30</span>, <span class="number">10</span>, <span class="number">60</span>, <span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">  context.setTransform(<span class="number">2.5</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2.5</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  context.strokeStyle = <span class="string">'green'</span>;</span><br><span class="line">  context.strokeRect(<span class="number">30</span>, <span class="number">10</span>, <span class="number">60</span>, <span class="number">20</span>);</span><br><span class="line">  </span><br><span class="line">  context.setTransform(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">40</span>, <span class="number">80</span>);</span><br><span class="line">  context.strokeStyle = <span class="string">'gray'</span>;</span><br><span class="line">  context.strokeRect(<span class="number">30</span>, <span class="number">10</span>, <span class="number">60</span>, <span class="number">20</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="图形组合"><a href="#图形组合" class="headerlink" title="图形组合"></a>图形组合</h3><p>设定图形上下文对象的 <code>globalCompositeOperation</code>属性能自己决定图形的组合方式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">context.globalCompositeOperation = type</span><br></pre></td></tr></table></figure>
<p>type 的值必须是下面几种字符串之一：</p>
<ul>
<li><p>source-over(默认值)</p>
<p>表示新图形覆盖杂原有图形上</p>
</li>
<li><p>destination-over</p>
<p>表示在原有图形之下绘制新图形</p>
</li>
<li><p>source-in</p>
<p>新图形与原有图形作 in 运算，只显示新图形中与原有图像相互重叠的部分，新图形与原有图形的其他部分均变成透明</p>
</li>
<li><p>destination-in</p>
<p>原有图形与新图形作 in 运算，只显示原有图形中与新图形相重叠的部分，新图形与原有图形的其他部分均变成透明</p>
</li>
<li><p>source-out</p>
<p>新图形与原有图形 out 运算。只显示新图形中与原有图形不重叠的部分，新图形与原有图形的其他部分变成透明</p>
</li>
<li><p>destination-out</p>
<p>新图形与原有图形 out 运算。只显示原有图形中与新图形不重叠的部分，原有图形与新图形的其他部分变成透明</p>
</li>
<li><p>source-atop</p>
<p>只绘制新图形中与原有图形重叠的部分与未被重叠覆盖的原有图形，新图形的其他部分变成透明</p>
</li>
<li><p>destination-atop</p>
<p>只绘制原有图形中被新图形重叠覆盖的部分与新图形的其他部分，原有图形中的其他部分变成透明，不绘制新图形中与原有图形相重叠的部分</p>
</li>
<li><p>lighter</p>
<p>原有图形与新图形均绘制，重叠部分做加色处理</p>
</li>
<li><p>xor</p>
<p>只绘制新图形中与原有图形不重叠的部分，重叠部分变成透明</p>
</li>
<li><p>copy</p>
<p>只绘制新图形，原有图形中未与新图形重叠的部分变成透明</p>
</li>
</ul>
<h3 id="给图形绘制阴影"><a href="#给图形绘制阴影" class="headerlink" title="给图形绘制阴影"></a>给图形绘制阴影</h3><ul>
<li>shadowOffsetX——阴影的横线位移量</li>
<li>shadowOffsetY——阴影的纵向位移量</li>
<li>shadowColor——阴影的颜色</li>
<li>shadowBlur——阴影的模糊范围</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drawShadowFifthStar</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> canvas = <span class="built_in">document</span>.getElementById(id);</span><br><span class="line">  <span class="keyword">if</span> (!canvas) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">const</span> context = canvas.getContext(<span class="string">'2d'</span>);</span><br><span class="line">  context.fillStyle = <span class="string">'#EEEEFF'</span>;</span><br><span class="line">  context.fillRect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">400</span>, <span class="number">300</span>);</span><br><span class="line">  context.shadowOffsetX = <span class="number">10</span>;</span><br><span class="line">  context.shadowOffsetY = <span class="number">10</span>;</span><br><span class="line">  context.shadowColor = <span class="string">'rgba(100,100,100,0.5)'</span>;</span><br><span class="line">  context.shadowBlur = <span class="number">7.5</span>;</span><br><span class="line">  context.translate(<span class="number">0</span>, <span class="number">50</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">    context.translate(<span class="number">50</span>, <span class="number">50</span>);</span><br><span class="line">    createFivePointedStar(context);</span><br><span class="line">    context.fill();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="使用图像"><a href="#使用图像" class="headerlink" title="使用图像"></a>使用图像</h3><h4 id="绘制图像"><a href="#绘制图像" class="headerlink" title="绘制图像"></a>绘制图像</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 宽高 为原图像宽高</span></span><br><span class="line">context.drawImage(image,x,y);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 增加宽高的自定义</span></span><br><span class="line">context.drawImage(image,x,y,w,h)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将画布中绘制好的图像的全部或者部分复制到画布的另一个位置上</span></span><br><span class="line">context.drawImage(image,sx,sy,sw,sh,dx,dy,dw,dh)</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drawCanvasImage</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> canvas = <span class="built_in">document</span>.getElementById(id);</span><br><span class="line">  <span class="keyword">if</span> (!canvas) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">const</span> context = canvas.getContext(<span class="string">'2d'</span>);</span><br><span class="line">  context.fillStyle = <span class="string">'#EEEEFF'</span>;</span><br><span class="line">  context.fillRect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">400</span>, <span class="number">300</span>)</span><br><span class="line">  image = <span class="keyword">new</span> Image();</span><br><span class="line">  image.src = <span class="string">'../Desktop/微信图片_20190311090059.jpg'</span></span><br><span class="line">  image.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    drawBigImage(context, image)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drawImage</span>(<span class="params">context, image</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">7</span>; i++) &#123;</span><br><span class="line">    context.drawImage(image, <span class="number">0</span> + i * <span class="number">50</span>, <span class="number">0</span> + i * <span class="number">25</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drawBigImage</span>(<span class="params">context, image</span>) </span>&#123;</span><br><span class="line">  context.drawImage(image, <span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">  context.drawImage(image, <span class="number">23</span>, <span class="number">5</span>, <span class="number">57</span>, <span class="number">80</span>, <span class="number">110</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="图像平铺"><a href="#图像平铺" class="headerlink" title="图像平铺"></a>图像平铺</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drawTileImage</span>(<span class="params">canvas, context, image</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(canvas);</span><br><span class="line">  <span class="keyword">const</span> scale = <span class="number">5</span>;</span><br><span class="line">  <span class="keyword">let</span> n1 = image.width / scale;</span><br><span class="line">  <span class="keyword">let</span> n2 = image.height / scale;</span><br><span class="line">  <span class="keyword">let</span> n3 = canvas.width / n1;</span><br><span class="line">  <span class="keyword">let</span> n4 = canvas.height / n2;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; n3; i++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; n4; j++) &#123;</span><br><span class="line">      context.drawImage(image, i * n1, j * n2, n1, n2);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面使用变量和循环来实现图像平铺。还可以用更简便的图形上下文的 <code>createPattern</code>方法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">context.createPattern(image,type)</span><br></pre></td></tr></table></figure>
<p>image 参数为要平铺的图像，type 参数：</p>
<ul>
<li>no-repeat：不平铺</li>
<li>repeat-x：横方向平铺</li>
<li>repeat-y：纵方向平铺</li>
<li>repeat：全方向平铺</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drawCanvasImage</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> canvas = <span class="built_in">document</span>.getElementById(id);</span><br><span class="line">  <span class="keyword">if</span> (!canvas) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">const</span> context = canvas.getContext(<span class="string">'2d'</span>);</span><br><span class="line">  context.fillStyle = <span class="string">'#EEEEFF'</span>;</span><br><span class="line">  context.fillRect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">400</span>, <span class="number">300</span>)</span><br><span class="line">  image = <span class="keyword">new</span> Image();</span><br><span class="line">  image.src = <span class="string">'../Desktop/微信图片_20190311090059.jpg'</span>;</span><br><span class="line">  image.width = <span class="number">10</span>;</span><br><span class="line">  image.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> canvasTemp = <span class="built_in">document</span>.createElement(<span class="string">'canvas'</span>);</span><br><span class="line">    <span class="keyword">const</span> contextTemp = canvasTemp.getContext(<span class="string">'2d'</span>);</span><br><span class="line">    canvasTemp.width = <span class="number">100</span>;</span><br><span class="line">    canvasTemp.height = <span class="number">100</span>;</span><br><span class="line">    contextTemp.drawImage(<span class="keyword">this</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">100</span>,<span class="number">100</span>);</span><br><span class="line">    <span class="keyword">let</span> ptrn = context.createPattern(canvasTemp,<span class="string">'repeat'</span>);</span><br><span class="line">    <span class="comment">// context.drawImage(image, 23, 5, 57, 80);</span></span><br><span class="line">    context.fillStyle = ptrn;</span><br><span class="line">    context.fillRect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">400</span>, <span class="number">300</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当图像太大的时候，可以通过把图像绘制在一个临时的 canvas 里面，然后再用主canvas 重复这个临时 canvas </p>
<h4 id="图像裁剪"><a href="#图像裁剪" class="headerlink" title="图像裁剪"></a>图像裁剪</h4><p>使用 clip 方法设置裁剪区域</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cutImage</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> canvas = <span class="built_in">document</span>.getElementById(id);</span><br><span class="line">  <span class="keyword">if</span> (!canvas) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">const</span> context = canvas.getContext(<span class="string">'2d'</span>);</span><br><span class="line">  <span class="keyword">const</span> gr = context.createLinearGradient(<span class="number">0</span>, <span class="number">400</span>, <span class="number">300</span>, <span class="number">0</span>);</span><br><span class="line">  gr.addColorStop(<span class="number">0</span>, <span class="string">'rgb(255,255,0)'</span>);</span><br><span class="line">  gr.addColorStop(<span class="number">1</span>, <span class="string">'rgb(0,255,255)'</span>);</span><br><span class="line">  context.fillStyle = gr;</span><br><span class="line">  context.fillRect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">400</span>, <span class="number">300</span>);</span><br><span class="line">  image = <span class="keyword">new</span> Image();</span><br><span class="line">  image.src = <span class="string">'../Desktop/微信图片_20190311090059.jpg'</span>;</span><br><span class="line">  image.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    createFivePointedStar(context);</span><br><span class="line">    context.drawImage(image, <span class="number">-50</span>, <span class="number">-150</span>, <span class="number">400</span>, <span class="number">300</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createFivePointedStar</span>(<span class="params">context</span>) </span>&#123;</span><br><span class="line">  context.beginPath();</span><br><span class="line">  context.translate(<span class="number">100</span>,<span class="number">150</span>);</span><br><span class="line">  context.fillStyle = <span class="string">'rgba(255,0,0,0.5)'</span>;  </span><br><span class="line">  <span class="keyword">const</span> dx = <span class="number">100</span>;</span><br><span class="line">  <span class="keyword">const</span> dy = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">const</span> s = <span class="number">50</span>;</span><br><span class="line">  <span class="keyword">let</span> dig = <span class="built_in">Math</span>.PI / <span class="number">5</span> * <span class="number">4</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> x = <span class="built_in">Math</span>.sin(i * dig);</span><br><span class="line">    <span class="keyword">let</span> y = <span class="built_in">Math</span>.cos(i * dig);</span><br><span class="line">    context.lineTo(dx + x * s, dy + y * s);</span><br><span class="line">  &#125;</span><br><span class="line">  context.closePath();</span><br><span class="line">  context.clip();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="像素处理"><a href="#像素处理" class="headerlink" title="像素处理"></a>像素处理</h4><p>使用 getImageData 方法可以获取图像中的像素,获得像素组依次 rgba 值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">imageData = context.getImageData(x,y,width,height);</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align:left">参数</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><em>x</em></td>
<td style="text-align:left">开始复制的左上角位置的 x 坐标。</td>
</tr>
<tr>
<td style="text-align:left"><em>y</em></td>
<td style="text-align:left">开始复制的左上角位置的 y 坐标。</td>
</tr>
<tr>
<td style="text-align:left"><em>width</em></td>
<td style="text-align:left">将要复制的矩形区域的宽度。</td>
</tr>
<tr>
<td style="text-align:left"><em>height</em></td>
<td style="text-align:left">将要复制的矩形区域的高度。</td>
</tr>
</tbody>
</table>
<p>对于 ImageData 对象中的每个像素，都存在着四方面的信息，即 RGBA 值：</p>
<ul>
<li>R - 红色 (0-255)</li>
<li>G - 绿色 (0-255)</li>
<li>B - 蓝色 (0-255)</li>
<li>A - alpha 通道 (0-255; 0 是透明的，255 是完全可见的)</li>
</ul>
<p>利用 putImageData 将图像数据放回画布,期间做一些颜色处理，可以模拟滤镜。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">image.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// createFivePointedStar(context);</span></span><br><span class="line">  context.drawImage(image, <span class="number">0</span>, <span class="number">0</span>, <span class="number">400</span>, <span class="number">300</span>);</span><br><span class="line">  <span class="keyword">let</span> imagedata = context.getImageData(<span class="number">0</span>, <span class="number">0</span>, image.width, image.height)</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, n = imagedata.data.length; i &lt; n; i += <span class="number">4</span>) &#123;</span><br><span class="line">    imagedata.data[i + <span class="number">0</span>] = <span class="number">255</span> - imagedata.data[i + <span class="number">0</span>];</span><br><span class="line">    imagedata.data[i + <span class="number">1</span>] = <span class="number">255</span> - imagedata.data[i + <span class="number">2</span>];</span><br><span class="line">    imagedata.data[i + <span class="number">2</span>] = <span class="number">255</span> - imagedata.data[i + <span class="number">1</span>];</span><br><span class="line">  &#125;</span><br><span class="line">  context.putImageData(imagedata, <span class="number">0</span>, <span class="number">0</span>, <span class="number">400</span>, <span class="number">300</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">context.putImageData(imgData,x,y,dirtyX,dirtyY,dirtyWidth,dirtyHeight);</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align:left">参数</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><em>imgData</em></td>
<td style="text-align:left">规定要放回画布的 ImageData 对象。</td>
</tr>
<tr>
<td style="text-align:left"><em>x</em></td>
<td style="text-align:left">ImageData 对象左上角的 x 坐标，以像素计。</td>
</tr>
<tr>
<td style="text-align:left"><em>y</em></td>
<td style="text-align:left">ImageData 对象左上角的 y 坐标，以像素计。</td>
</tr>
<tr>
<td style="text-align:left"><em>dirtyX</em></td>
<td style="text-align:left">可选。水平值（x），以像素计，在画布上放置图像的位置。</td>
</tr>
<tr>
<td style="text-align:left"><em>dirtyY</em></td>
<td style="text-align:left">可选。水平值（y），以像素计，在画布上放置图像的位置。</td>
</tr>
<tr>
<td style="text-align:left"><em>dirtyWidth</em></td>
<td style="text-align:left">可选。在画布上绘制图像所使用的宽度。</td>
</tr>
<tr>
<td style="text-align:left"><em>dirtyHeight</em></td>
<td style="text-align:left">可选。在画布上绘制图像所使用的高度。</td>
</tr>
</tbody>
</table>
<h3 id="绘制文字"><a href="#绘制文字" class="headerlink" title="绘制文字"></a>绘制文字</h3><p>fillText 填充方式绘制字符串</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">context.fillText(text,x,y,maxWidth);</span><br></pre></td></tr></table></figure>
<p>maxWidth，允许最大的宽度，像素单位</p>
<p>strokeText 用轮廓方式绘制字符串</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">context.strokeText(text,x,y,maxWidth);</span><br></pre></td></tr></table></figure>
<p>一些关于文字绘制的属性：</p>
<ul>
<li>font：字体</li>
<li>textAlign：水平对齐方式，start(默认)、end、left、right、center</li>
<li>textBaseline：垂直对齐方式，top、hanging、middle、alphabetic(默认)、ideographic、bottom</li>
</ul>
<p>获得文字的宽度</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">context.measureText(text)</span><br></pre></td></tr></table></figure>
<p>接受一个参数 text，该参数为需要绘制的文字，返回一个 TextMetrics 对象，TextMetrics对象的 width 属性表示使用当前指定的文字后  text 参数中指定的文字的总文字宽度</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drawText</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> canvas = <span class="built_in">document</span>.getElementById(id);</span><br><span class="line">  <span class="keyword">if</span> (!canvas) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">const</span> context = canvas.getContext(<span class="string">'2d'</span>);</span><br><span class="line">  context.font = <span class="string">'italic 20px sans-serif'</span>;</span><br><span class="line">  <span class="keyword">let</span> txt = <span class="string">'字符串的宽度为：'</span>;</span><br><span class="line">  <span class="keyword">let</span> tml = context.measureText(txt);</span><br><span class="line">  context.fillText(txt, <span class="number">10</span>, <span class="number">30</span>);</span><br><span class="line">  context.fillText(tml.width, tml.width + <span class="number">10</span>, <span class="number">30</span>);</span><br><span class="line">  context.font = <span class="string">'bold 30px sans-serif'</span>;</span><br><span class="line">  <span class="keyword">let</span> tm2 = context.measureText(txt);</span><br><span class="line">  context.fillText(txt, <span class="number">10</span>, <span class="number">70</span>);</span><br><span class="line">  context.fillText(tm2.width, tm2.width + <span class="number">10</span>, <span class="number">70</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><h4 id="保存与恢复状态"><a href="#保存与恢复状态" class="headerlink" title="保存与恢复状态"></a>保存与恢复状态</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将当前状态保存到 栈中</span></span><br><span class="line">context.save();</span><br><span class="line"><span class="comment">// 从栈中取出之前保存的图形上下文的状态进行恢复 </span></span><br><span class="line">context.restore();</span><br></pre></td></tr></table></figure>
<p>绘画状态包括坐标的原点、变形时的变换矩阵，图形上下文对象的当前属性值。</p>
<p>可以应用在下面但不仅仅下面的场景：</p>
<ul>
<li>图像或图形变形</li>
<li>图像裁剪</li>
<li>改变图形上下文的以下属性的时候：fillStyle、font、globalAlpha、globalComposite、Operation、lineCap、lineJoin、lineWidth、miterLimit、shadowBlur、shadowColor、shadowOffsetX、shadowOffsetY、strokeStyle、textAlign、textBaseline</li>
</ul>
<h4 id="保存文件"><a href="#保存文件" class="headerlink" title="保存文件"></a>保存文件</h4><p> 原理实际上是把当前的绘画状态输出到一个 data URL 地址所指向的数据中的过程。data URL指的是目前大部分浏览器能够识别的一种 base64编码的 URL，主要用于小型的、可以在网页中直接嵌入的，而不需要从外部文件嵌入的数据，例如 img 元素中的图像文件等。</p>
<p>toDataURL 方法把绘画状态输出到一个 data URL中，然后重新装载，客户可以直接把装载后的文件进行保存。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">canvas.toDataURL(type);</span><br><span class="line"><span class="comment">// type 表示输出输出类型的 MIME 类型</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drawDataURL</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> canvas = <span class="built_in">document</span>.getElementById(id);</span><br><span class="line">  <span class="keyword">if</span> (!canvas) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">const</span> context = canvas.getContext(<span class="string">'2d'</span>);</span><br><span class="line">  context.fillStyle = <span class="string">'rgb(0,0,255)'</span>;</span><br><span class="line">  context.fillRect(<span class="number">0</span>, <span class="number">0</span>, canvas.width, canvas.height);</span><br><span class="line">  context.fillStyle = <span class="string">'rgb(255,255,0)'</span>;</span><br><span class="line">  context.fillRect(<span class="number">10</span>, <span class="number">20</span>, <span class="number">50</span>, <span class="number">50</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(canvas.toDataURL(<span class="string">"image/jepg"</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="简单动画的制作"><a href="#简单动画的制作" class="headerlink" title="简单动画的制作"></a>简单动画的制作</h4><p>canvas 画布中制作的动画实际上就是一个不断擦除（clearRect）、重绘的过程。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">animationOnCanvas</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> canvas = <span class="built_in">document</span>.getElementById(id);</span><br><span class="line">  <span class="keyword">if</span> (!canvas) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  context = canvas.getContext(<span class="string">'2d'</span>);</span><br><span class="line">  width = canvas.width;</span><br><span class="line">  height = canvas.height;</span><br><span class="line">  i = <span class="number">0</span>;</span><br><span class="line">  setInterval(rotate, <span class="number">100</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">rotate</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  context.clearRect(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">  context.fillStyle = <span class="string">'red'</span>;</span><br><span class="line">  context.fillRect(i, <span class="number">0</span>, <span class="number">20</span>, <span class="number">20</span>);</span><br><span class="line">  i += <span class="number">20</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="多媒体播放"><a href="#多媒体播放" class="headerlink" title="多媒体播放"></a>多媒体播放</h2><h3 id="关于-video-与-audio元素"><a href="#关于-video-与-audio元素" class="headerlink" title="关于 video 与 audio元素"></a>关于 video 与 audio元素</h3><p>HTML4页面中播放视频或者音频数据</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">object</span> <span class="attr">classid</span>=<span class="string">"clsid:F08DF954-8592-11D1-B16A-00C0F0283628"</span> <span class="attr">id</span>=<span class="string">"Slider1"</span> <span class="attr">width</span>=<span class="string">"100"</span> <span class="attr">height</span>=<span class="string">"50"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"BorderStyle"</span> <span class="attr">value</span>=<span class="string">"1"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"MousePointer"</span> <span class="attr">value</span>=<span class="string">"0"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"Enabled"</span> <span class="attr">value</span>=<span class="string">"1"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"Min"</span> <span class="attr">value</span>=<span class="string">"0"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"Max"</span> <span class="attr">value</span>=<span class="string">"10"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"allowFullScreen"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"allowscriptaccess"</span> <span class="attr">value</span>=<span class="string">"always"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">embed</span> <span class="attr">type</span>=<span class="string">"application/x-shockwave-flash"</span> <span class="attr">width</span>=<span class="string">"425"</span> <span class="attr">height</span>=<span class="string">"344"</span> <span class="attr">src</span>=<span class="string">"p.swf"</span> <span class="attr">allowscriptaccess</span>=<span class="string">"always"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">allowfullscreen</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">embed</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">object</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>可以看出上面代码的一些缺点：冗长，需要使用 Flash 插件，用户没有安装的话，则视频看不了。需要结合多个元素，并且需要添加很多属性。</p>
<p>HTML5 中的则是：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">audio</span> <span class="attr">src</span>=<span class="string">'xxx.mp3'</span>&gt;</span></span><br><span class="line">    您的浏览器器不支持 audio 元素</span><br><span class="line"><span class="tag">&lt;/<span class="name">audio</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">video</span> <span class="attr">width</span>=<span class="string">"640"</span> <span class="attr">height</span>=<span class="string">"360"</span> <span class="attr">src</span>=<span class="string">'xxx.mp4'</span>&gt;</span></span><br><span class="line">    您的浏览器器不支持 video 元素</span><br><span class="line"><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--结合 source元素为同一个媒体数据指定多个播放格式与编码方式，浏览器会从中找到一种自己支持的播放格式来播放 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">video</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">source</span> <span class="attr">src</span>=<span class="string">"sample.ogv"</span> <span class="attr">type</span>=<span class="string">"video/ogg"</span>;<span class="attr">codecs</span>=<span class="string">"theora,vorbis"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">source</span> <span class="attr">src</span>=<span class="string">"sample.mov"</span> <span class="attr">type</span>=<span class="string">"video/quicktime"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--type指播放媒体的MIME类型，codes表示媒体的编码格式--&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h3><ul>
<li><p>src</p>
<p>指定媒体数据的 URL 地址</p>
</li>
<li><p>autoplay</p>
<p>指定媒体是否在页面加载后自动播放</p>
</li>
<li><p>preload</p>
<p>指定数据是否预加载。预加载浏览器会预先将视频或者音频数据缓冲，加快播放速度，因为播放时数据已经缓冲完毕。该属性有 none（不进行预加载）、metadata（只预加载媒体的元数据：媒体字节数、第一帧、播放列表、持续时间等）、auto(默认，表示预加载全部视频或者音频)。</p>
</li>
<li><p>poster(video独有)</p>
<p>当视频不可用的时候，可以使用该元素向用户展示一副替代用的图片。用户体验良好</p>
</li>
<li><p>loop</p>
<p>循环播放</p>
</li>
<li><p>controls</p>
<p>添加浏览器自带的播放用的控制条，具有播放、暂停等按钮。</p>
</li>
<li><p>width 与 height（video独有）</p>
<p>该属性中指定视频的宽度和高度（像素）</p>
</li>
<li><p>error</p>
<p>读取使用媒体数据的过程中出错的话，返回一个 MediaError对象，该对象的code返回对应的错误状态，有4个值</p>
<p>MEDIA_ERR_ABORTED(数字值为1)：媒体数据的下载过程由于用户操作的原因而被中止</p>
<p>MEDIA_ERR_NETWORK(数字值为2)：确认媒体资源可用，但是在下载时出现网络错误，媒体数据的下载过程被中止</p>
<p>MEDIA_ERR_DECODE(数字值为3)：确认媒体资源可用，但是解码时发生错误。</p>
<p>MEDIA_ERR_SRC_NOT_SUPPORTED(数字值为4)：媒体资源不可用媒体格式不被支持，error属性为只读属性</p>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> video = <span class="built_in">document</span>.getElementById(<span class="string">'video element'</span>);</span><br><span class="line">video.addEventListener(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> &#123; error &#125; = video;</span><br><span class="line">  <span class="keyword">switch</span> (error.code) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'视频的下载过程被中止'</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'网络发生故障，视频的下载过程被中止'</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'解码失败'</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'不支持的播放格式'</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'无'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>networkState,4个可能值<ul>
<li>NETWORK_EMPTY(数字值为0)：音频/视频尚未初始化</li>
<li>NETWORK_IDLE(1)：音频/视频是活动的且已选取资源，但并未使用网络</li>
<li>NETWORK_LOADING(2)：浏览器正在下载数据</li>
<li>NETWORK_NO_SOURCE(3)：未找到音频/视频来源</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">video.addEventListener(<span class="string">'progress'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; networkState &#125; = video;</span><br><span class="line">  <span class="keyword">if</span> (networkState === <span class="number">2</span>) &#123;</span><br><span class="line">    x.innerHTML = <span class="string">`加载中...[<span class="subst">$&#123;e.loaded&#125;</span>/<span class="subst">$&#123;e.total&#125;</span> byte]`</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (networkState === <span class="number">3</span>) &#123;</span><br><span class="line">    x.innerHTML = <span class="string">'记载失败'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li><p>currentSrc</p>
<p>读取播放中的媒体数据的 URL地址，为只读属性</p>
</li>
<li><p>buffered（只读）</p>
<p>buffered 属性返回 TimeRanges 对象。该对象表示用户的音视频缓冲范围，缓冲范围指的是已缓冲音视频的时间范围。如果用户在音频中跳跃播放，会得到多个缓冲范围。</p>
</li>
</ul>
<p>语法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">audio|video.buffered</span><br></pre></td></tr></table></figure>
<p>返回值</p>
<table>
<thead>
<tr>
<th style="text-align:left">值</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">TimeRanges 对象</td>
<td style="text-align:left">表示音视频的已缓冲部分。TimeRanges 对象属性：length - 获得音视频中已缓冲范围的数量<br>start(index) - 获得某个已缓冲范围的开始位置<br/>end(index) - 获得某个已缓冲范围的结束位置<br/><strong>注释：</strong>首个缓冲范围的下表是 0。</td>
</tr>
</tbody>
</table>
<ul>
<li><p>readyState（只读）</p>
<p>返回媒体当前的播放位置的就绪状态值：</p>
<p>HAVE_NOTHING(0)：没有获取到媒体的任何信息，当前的播放位置没有可播放数据</p>
<p>HAVE_METADATA(1)：已经获取到足够的媒体数据，但是当前播放位置没有有效的媒体数据（获取到的媒体数据无效）</p>
<p>HAVE_CURRENT_DATA(2)：当前播放位置已经有数据可以播放，但没有获取到可以让播放器前进的数据。当媒体为视频，即当前帧的数据已经获得，也获得了下一帧大数据，或者当前帧已经是最后一帧</p>
<p>HAVE_FUTURE_DATA(3)：当前播放位置已经有数据可以播放，而且也获得到了可以让播放器前进的数据。当媒体为视频时，即当前帧的数据已经获得，而且也获得了下一帧的数据，当前帧是播放的最后一帧时，readyState 属性不可能为 HAVE_FUTURE_DATA</p>
<p>HAVE_ENOUGH_DATA(4)：当前播放位置已经有数据可以播放，同时也获得了可以让播放器前进的数据，而且浏览器确认媒体数据以某一种速度可以加载，可以保证有足够的后续数据进行播放。</p>
</li>
<li><p>seeking属性与seekable（只读）</p>
<p>seeking属性返回一个布尔值，表示浏览器是否正在请求某一特定播放为孩子的数据，true表示浏览器正在请求数据，false表示浏览器正在停止请求。</p>
<p>seekable返回一个 TimeRanges对象，该对象表示请求到的数据的时间范围。当媒体为视频时，开始时间为请求到视频数据第一帧的时间结束为请求到视频数据最后一帧的时间。</p>
</li>
<li><p>currentTime（可读写）/startTime（只读）/duration（只读）</p>
<p>currentTime获取当前播放位置，也可以通过修改currentTime来修改当前播放位置。如果修改的位置上没有可用的媒体数据时，将抛出 INVALID_STATE_ERR 异常。如果修改的位置超出了浏览器在一次请求中可以请求的数据范围，将抛出 INDEX_SIZE_ERR  异常。</p>
<p>startTime 来读取媒体播放的开始时间，通常为0</p>
<p>duration 读取媒体文件总的播放时间</p>
<p>三者单位均为秒</p>
</li>
<li><p>played/paused/ended（均为只读）</p>
<p>played 返回一个 TimeRanges 对象，从该对象中可以去读媒体文件的以播放部分的时间段。开始时间为已播放部分的开始时间，结束时间为已播放部分的结束时间。</p>
<p>paused 返回一个布尔值，表示是否处于暂停播放中，true 表示媒体暂停播放，false 表示媒体正在播放</p>
<p>end 返回一个布尔值，表示是否播放完毕，true表示播放完毕，false表示还没有播放完毕</p>
</li>
<li><p>defaultPlaybackRate/playbackRate</p>
<p>前者读取或者修改默认的播放速率，后者可以读取修改当前的播放速率</p>
</li>
<li><p>volume与 muted</p>
<p>Volume 读取或者修改媒体的播放音量，范围为0到1。0为静音，1为最大音量</p>
<p>muted读取或者修改媒体的静音状态，布尔值。true表示静音状态，false表示非静音状态</p>
</li>
</ul>
<h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><p>video与 audio都有以下四种方法：</p>
<ul>
<li>play。播放媒体，将 paused变为 false</li>
<li>pause。暂停媒体，将 paused 变为 true</li>
<li>load。重新载入媒体进行播放，将 playbackRate变为 defaultPlaybackRate，error变为 null</li>
<li>canPlayType。来测试浏览器是否支持指定的媒体类型。<code>support = videoElement.canPlayType(type)</code>。该方法使用一个参数type，该参数的指定方法与 source元素的type参数的指定方法相同，都用播放文件的 MIME 类型来指定，可以在指定的字符串中加上表示媒体编码格式的 codes参数。该方法返回3个可能值：<ul>
<li>空字符串：表示浏览器不支持此种媒体类型</li>
<li>maybe：表示浏览器可能支持此种媒体类型</li>
<li>probably：表示浏览器确定支持此种媒体类型</li>
</ul>
</li>
</ul>
<h3 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h3><p>事件处理方式分为两种：</p>
<ul>
<li>addEventListener</li>
<li>获取事件句柄的方式</li>
</ul>
<table>
<thead>
<tr>
<th>事件</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>loadstart</td>
<td>浏览器开始在网上寻找媒体数据</td>
</tr>
<tr>
<td>progress</td>
<td>浏览器正在获取媒体数据</td>
</tr>
<tr>
<td>suspend</td>
<td>浏览器暂停获取媒体数据，但是下载过程并没有正常结束</td>
</tr>
<tr>
<td>abort</td>
<td>浏览器在下载完全部媒体数据之前中止获取媒体数据，但是并不是由错误引起的</td>
</tr>
<tr>
<td>error</td>
<td>获取媒体数据过程中出错</td>
</tr>
<tr>
<td>emptied</td>
<td>video元素或者 audio元素所在网络突然变为未初始状态。可能引起的原因有两个：载入媒体过程中突然发生一个致命错误和在浏览器正在选择支持的播放格式时，又调用了 load 方法重新载入媒体</td>
</tr>
<tr>
<td>stalled</td>
<td>浏览器尝试获取媒体数据失败</td>
</tr>
<tr>
<td>play</td>
<td>即使开始播放，当执行了 play 方法时触发，或者数据下载完之后元素被谁 autoplay</td>
</tr>
<tr>
<td>pause</td>
<td>播放暂停，当执行了 pause 方法时触发</td>
</tr>
<tr>
<td>loadedmetadata</td>
<td>浏览器获取完毕媒体的时长好字节数</td>
</tr>
<tr>
<td>loadeddata</td>
<td>浏览器已经加载完毕当前播放位置的媒体数据，准备播放</td>
</tr>
<tr>
<td>waiting</td>
<td>播放过程由于得不到下一帧而暂停播放（例如下一帧尚未加载完毕），但很快就能够播放下一帧</td>
</tr>
<tr>
<td>playing</td>
<td>正在播放</td>
</tr>
<tr>
<td>canplay</td>
<td>浏览器能够播放媒体，但估计以前播放速率不能直接将媒体播放完毕，播放需要缓冲</td>
</tr>
<tr>
<td>canplaythrough</td>
<td>浏览器能够播放媒体，而且以当前播放速率能够将媒体播放完毕，不再需要进行缓冲</td>
</tr>
<tr>
<td>seeking</td>
<td>seeking属性变为 true，浏览器正在请求数据</td>
</tr>
<tr>
<td>seeked</td>
<td>seeking属性变成false，浏览器停止请求数据</td>
</tr>
<tr>
<td>timeupdate</td>
<td>当前播放位置被改变，可能是播放过程中的自然改变，也可能是人为地改变，或由于播放不能连续而发生的跳变</td>
</tr>
<tr>
<td>ended</td>
<td>播放结束后停止播放</td>
</tr>
<tr>
<td>ratechange</td>
<td>defaultplaybackRate属性（默认播放速率）或 playbackRate属性（当前播放速率）被改变</td>
</tr>
<tr>
<td>durationchange</td>
<td>播放时长被改变</td>
</tr>
<tr>
<td>volumechange</td>
<td>volume（音量）被改变或者 muted（静音状态） 被改变</td>
</tr>
</tbody>
</table>
<h3 id="事件捕捉示例"><a href="#事件捕捉示例" class="headerlink" title="事件捕捉示例"></a>事件捕捉示例</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">video.addEventListener(<span class="string">'timeupdate'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> timer = <span class="built_in">document</span>.getElementById(<span class="string">'time'</span>);</span><br><span class="line">  timer.innerHTML = <span class="built_in">Math</span>.floor(video.currentTime) + <span class="string">'/'</span> + <span class="built_in">Math</span>.floor(video.duration) + <span class="string">'(秒)'</span>;</span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>
<h2 id="本地存储"><a href="#本地存储" class="headerlink" title="本地存储"></a>本地存储</h2><h3 id="Web-Storage"><a href="#Web-Storage" class="headerlink" title="Web Storage"></a>Web Storage</h3><p>我们可以使用 cookies 在客户端保存注入用户等简单的用户信息，但它有一些限制：</p>
<ul>
<li>大小：cookies大小被限制在 4KB</li>
<li>带宽：cookies 随 HTTP 事务一起被发送，会浪费一部分发送 cookies使用的带宽</li>
<li>复杂度</li>
</ul>
<p>在 HTML5中重新提供了一种在客户端本地保存数据的功能，就是 Web Storage 功能。它分为两种</p>
<ul>
<li><p>sessionStorage</p>
<p>将数据保存在 seesion对象中。所谓的 session，是指用户在浏览某个网站的时候，从进入网站到浏览器关闭所经过这段时间，也就是用户浏览器这个网站所花费的时间，session 对象可以用来保存这时间所要求保存的任何数据、</p>
</li>
<li><p>localStorage</p>
<p>将数据保存在客户端本地的硬件设备（通常值硬盘，但也可以是其他硬件设备）中，即使浏览器被关闭了，该数据仍然存在，下次打开浏览器访问网站仍然可以使用。</p>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// sessionStorage</span></span><br><span class="line"><span class="comment">// 保存数据</span></span><br><span class="line">sessionStorage.setItem(key,value);</span><br><span class="line"></span><br><span class="line"><span class="comment">//读取数据</span></span><br><span class="line">变量 = seesionStorage.getItem(key)</span><br><span class="line"></span><br><span class="line"><span class="comment">// localStorage</span></span><br><span class="line"><span class="comment">// 保存数据</span></span><br><span class="line">localStorage.setItem(key,value);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 保存数据</span></span><br><span class="line">变量 = localStorage.getItem(key)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 保存时不允许重复键名。保存后可以修改键值，但是不允许修改键名（只能重新取键名，然后保存键值）</span></span><br></pre></td></tr></table></figure>
<h3 id="示例：简单-web-留言本"><a href="#示例：简单-web-留言本" class="headerlink" title="示例：简单 web 留言本"></a>示例：简单 web 留言本</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>简单 Web 留言本<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">name</span>=<span class="string">"memo"</span> <span class="attr">id</span>=<span class="string">"memo"</span> <span class="attr">cols</span>=<span class="string">"60"</span> <span class="attr">rows</span>=<span class="string">"10"</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"追加"</span> <span class="attr">onclick</span>=<span class="string">"saveStorage('memo')"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"初始化"</span> <span class="attr">onclick</span>=<span class="string">"clearStorage('msg')"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"msg"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="keyword">function</span> <span class="title">saveStorage</span>(<span class="params">id</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> data = <span class="built_in">document</span>.getElementById(id).value;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> time = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span></span><br><span class="line"><span class="undefined">    localStorage.setItem(time, data);</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="string">'数据已经保存了'</span>);</span></span><br><span class="line"><span class="javascript">    loadStorage(<span class="string">'msg'</span>);</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="keyword">function</span> <span class="title">loadStorage</span>(<span class="params">id</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> result = <span class="string">`&lt;table border="1"&gt;`</span>;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; localStorage.length; i++) &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> key = localStorage.key(i);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> value = localStorage.getItem(key);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();</span></span><br><span class="line"><span class="undefined">      date.setTime(key);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> datestr = date.toGMTString();</span></span><br><span class="line"><span class="xml">      result += `<span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;value&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;datestr&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span>`</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="javascript">    result += <span class="string">`&lt;/table&gt;`</span>;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> target = <span class="built_in">document</span>.getElementById(id);</span></span><br><span class="line"><span class="undefined">    target.innerHTML = result;</span></span><br><span class="line"><span class="undefined">  &#125;;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="keyword">function</span> <span class="title">clearStorage</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">    localStorage.clear();</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="string">'全部数据被清除'</span>);</span></span><br><span class="line"><span class="javascript">    loadStorage(<span class="string">'msg'</span>);</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="示例：简易数据库"><a href="#示例：简易数据库" class="headerlink" title="示例：简易数据库"></a>示例：简易数据库</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>简易数据库<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>姓名：<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"name"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>EMAIL:<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"email"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>电话号码:<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"tel"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>备注:<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"memo"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">onclick</span>=<span class="string">"saveStorage()"</span> <span class="attr">value</span>=<span class="string">"保存"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>检索：</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"find"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"检索"</span> <span class="attr">onclick</span>=<span class="string">"findStorage('msg')"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"msg"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="keyword">function</span> <span class="title">saveStorage</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> data = <span class="keyword">new</span> <span class="built_in">Object</span>;</span></span><br><span class="line"><span class="javascript">    data.name = <span class="built_in">document</span>.getElementById(<span class="string">'name'</span>).value;</span></span><br><span class="line"><span class="javascript">    data.email = <span class="built_in">document</span>.getElementById(<span class="string">'email'</span>).value;</span></span><br><span class="line"><span class="javascript">    data.tel = <span class="built_in">document</span>.getElementById(<span class="string">'name'</span>).value;</span></span><br><span class="line"><span class="javascript">    data.memo = <span class="built_in">document</span>.getElementById(<span class="string">'memo'</span>).value;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> str = <span class="built_in">JSON</span>.stringify(data);</span></span><br><span class="line"><span class="undefined">    localStorage.setItem(data.name, str);</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="string">'数据已经保存了'</span>);</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="keyword">function</span> <span class="title">findStorage</span>(<span class="params">id</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> find = <span class="built_in">document</span>.getElementById(<span class="string">'find'</span>).value;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> str = localStorage.getItem(find);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> data = <span class="built_in">JSON</span>.parse(str);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> result = <span class="string">`姓名： <span class="subst">$&#123;data.name&#125;</span>&lt;br&gt;`</span>;</span></span><br><span class="line"><span class="javascript">    result += <span class="string">`EMAIL： <span class="subst">$&#123;data.email&#125;</span>&lt;br&gt;`</span>;</span></span><br><span class="line"><span class="javascript">    result += <span class="string">`电话号码： <span class="subst">$&#123;data.tel&#125;</span>&lt;br&gt;`</span>;</span></span><br><span class="line"><span class="javascript">    result += <span class="string">`备注： <span class="subst">$&#123;data.memo&#125;</span>&lt;br&gt;`</span>;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> target = <span class="built_in">document</span>.getElementById(id);</span></span><br><span class="line"><span class="undefined">    target.innerHTML = result;</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="本地数据库-新的推荐IndexedDB实现"><a href="#本地数据库-新的推荐IndexedDB实现" class="headerlink" title="本地数据库(新的推荐IndexedDB实现)"></a>本地数据库(新的推荐IndexedDB实现)</h2><p>HTML5中内置了一个可以通过 SQL 语言来访问的数据库</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> db = openDatabase(<span class="string">'mydb'</span>,<span class="string">'1.0'</span>,<span class="string">'Test DB'</span>,<span class="number">2</span>*<span class="number">1024</span>*<span class="number">1024</span>)</span><br></pre></td></tr></table></figure>
<p>openDatabase接收五个参数：</p>
<ol>
<li>数据库名字</li>
<li>数据库版本号</li>
<li>显示名字</li>
<li>数据库保存数据的大小（以字节为单位 )</li>
<li>回调函数（非必须)</li>
</ol>
<p>transaction 方法来执行事务处理，防止在对数据库进行访问以及有关操作的时候收到外界的干扰。当一条语法执行失败的时候，整个事务会回滚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.transaction(<span class="function"><span class="keyword">function</span>(<span class="params">context</span>)</span>&#123;</span><br><span class="line">    context.executeSql(<span class="string">'CREATE TABLE IF NOT EXISTS tesTable (id unique,name)'</span>);</span><br><span class="line">    context.executeSql(<span class="string">'INSERT INTO testTable(id,name) VALUES (0,"haha")'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>executeSql 方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transaction.executeSql(sqlquery,[],dataHandler,errorHandler);</span><br></pre></td></tr></table></figure>
<p>executeSql 接收四个参数：</p>
<ol>
<li>查询字符串</li>
<li>用以替换查询字符串中问号的参数</li>
<li>执行成功回调函数（可选）</li>
<li>执行失败回调函数（可选）</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transaction.executeSql(<span class="string">"UPDATE people set age=?where name=?;"</span>,[age,name],(transaction,result)=&gt;&#123;&#125;,(transaction,errmsg)=&gt;&#123;&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="实例：留言本"><a href="#实例：留言本" class="headerlink" title="实例：留言本"></a>实例：留言本</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span>=<span class="string">"init()"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>使用数据库实现的 Web 留言本<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>姓名：<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"name"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>留言：<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"memo"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"保存"</span> <span class="attr">onclick</span>=<span class="string">"saveData()"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">table</span> <span class="attr">id</span>=<span class="string">"datatable"</span> <span class="attr">border</span>=<span class="string">"1"</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"msg"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">let</span> datatable = <span class="literal">null</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">let</span> db = openDatabase(<span class="string">'MyData'</span>, <span class="string">''</span>, <span class="string">'My Database'</span>, <span class="number">102400</span>);</span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(datatable.childNodes);</span></span><br><span class="line"><span class="javascript">    datatable = <span class="built_in">document</span>.getElementById(<span class="string">'datatable'</span>);</span></span><br><span class="line"><span class="undefined">    showAllData();</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="keyword">function</span> <span class="title">removeAllData</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">for</span> (<span class="keyword">let</span> i = datatable.childNodes.length - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span></span><br><span class="line"><span class="undefined">      datatable.removeChild(datatable.childNodes[i]);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> tr = <span class="built_in">document</span>.createElement(<span class="string">'tr'</span>);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> th1 = <span class="built_in">document</span>.createElement(<span class="string">'th'</span>);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> th2 = <span class="built_in">document</span>.createElement(<span class="string">'th'</span>);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> th3 = <span class="built_in">document</span>.createElement(<span class="string">'th'</span>);</span></span><br><span class="line"><span class="javascript">    th1.innerHTML = <span class="string">'姓名'</span>;</span></span><br><span class="line"><span class="javascript">    th2.innerHTML = <span class="string">'留言'</span>;</span></span><br><span class="line"><span class="javascript">    th3.innerHTML = <span class="string">'时间'</span>;</span></span><br><span class="line"><span class="undefined">    tr.appendChild(th1);</span></span><br><span class="line"><span class="undefined">    tr.appendChild(th2);</span></span><br><span class="line"><span class="undefined">    tr.appendChild(th3);</span></span><br><span class="line"><span class="undefined">    datatable.appendChild(tr);</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="keyword">function</span> <span class="title">showData</span>(<span class="params">row</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> tr = <span class="built_in">document</span>.createElement(<span class="string">'tr'</span>);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> td1 = <span class="built_in">document</span>.createElement(<span class="string">'td'</span>);</span></span><br><span class="line"><span class="undefined">    td1.innerHTML = row.name;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> td2 = <span class="built_in">document</span>.createElement(<span class="string">'td'</span>);</span></span><br><span class="line"><span class="undefined">    td2.innerHTML = row.message;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> td3 = <span class="built_in">document</span>.createElement(<span class="string">'td'</span>);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> t = <span class="keyword">new</span> <span class="built_in">Date</span>();</span></span><br><span class="line"><span class="undefined">    t.setTime(row.time);</span></span><br><span class="line"><span class="javascript">    td3.innerHTML = t.toLocaleDateString() + <span class="string">" "</span> + t.toLocaleTimeString();</span></span><br><span class="line"><span class="undefined">    tr.appendChild(td1);</span></span><br><span class="line"><span class="undefined">    tr.appendChild(td2);</span></span><br><span class="line"><span class="undefined">    tr.appendChild(td3);</span></span><br><span class="line"><span class="undefined">    datatable.appendChild(tr);</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="keyword">function</span> <span class="title">showAllData</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    db.transaction(<span class="function"><span class="keyword">function</span> (<span class="params">tx</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      tx.executeSql(<span class="string">'CREATE TABLE IF NOT EXISTS MsgData(name TEXT,message TEXT,time INTEGER)'</span>, []);</span></span><br><span class="line"><span class="javascript">      tx.executeSql(<span class="string">'SELECT * FROM MsgData'</span>, [], <span class="function"><span class="keyword">function</span> (<span class="params">tx, rs</span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">        removeAllData();</span></span><br><span class="line"><span class="javascript">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; rs.rows.length; i++) &#123;</span></span><br><span class="line"><span class="undefined">          showData(rs.rows.item(i));</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">      &#125;)</span></span><br><span class="line"><span class="undefined">    &#125;);</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="keyword">function</span> <span class="title">addData</span>(<span class="params">name, message, time</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    db.transaction(<span class="function"><span class="keyword">function</span> (<span class="params">tx</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      tx.executeSql(<span class="string">'INSERT INTO MsgData VALUES(?,?,?)'</span>, [name, message, time], <span class="function"><span class="keyword">function</span> (<span class="params">tx, rs</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">'成功保存数据'</span>);</span></span><br><span class="line"><span class="javascript">      &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">tx, error</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;error.source&#125;</span>:<span class="subst">$&#123;error.message&#125;</span>`</span>);</span></span><br><span class="line"><span class="undefined">      &#125;)</span></span><br><span class="line"><span class="undefined">    &#125;)</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="keyword">function</span> <span class="title">saveData</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> name = <span class="built_in">document</span>.getElementById(<span class="string">'name'</span>).value;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> memo = <span class="built_in">document</span>.getElementById(<span class="string">'memo'</span>).value;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> time = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span></span><br><span class="line"><span class="undefined">    addData(name, memo, time);</span></span><br><span class="line"><span class="undefined">    showAllData();</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>不过，Web SQL Database规范已经被废弃。因为每个浏览器都有自己的实现，浏览器的兼容性就不重要了。</p>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/IndexedDB_API">关于 IndexedDB</a></p>
<h2 id="离线应用程序（已废弃）"><a href="#离线应用程序（已废弃）" class="headerlink" title="离线应用程序（已废弃）"></a>离线应用程序（<strong>已废弃</strong>）</h2><p>HTML5 引入了应用程序缓存，这意味着 web 应用可进行缓存，并可在没有因特网连接时进行访问。</p>
<p>应用程序缓存为应用带来三个优势：</p>
<ul>
<li>离线浏览 - 用户可在应用离线时使用它们</li>
<li>速度 - 已缓存资源加载得更快</li>
<li>减少服务器负载 - 浏览器将只从服务器下载更新过或更改过的资源。</li>
</ul>
<p><strong>本地缓存与浏览器网页缓存的区别</strong></p>
<p>本地缓存为整个 Web 程序服务的，浏览器的网页缓存只服务于单个网页。任何网页都有网页缓存，而本地缓存值缓存指定的网页。本地缓存可以控制缓存更新，利用缓存对象的各种属性、状态和事件来开发出离线应用程序</p>
<h3 id="manifest文件"><a href="#manifest文件" class="headerlink" title="manifest文件"></a>manifest文件</h3><p>首先在 index.html 中引入</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">！DOCTYPE</span> <span class="attr">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">mainfest</span> =<span class="string">'index.appcache'</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>每个指定了 manifest 的页面在用户对其访问时都会被缓存。如果未指定 manifest 属性，则页面不会被缓存（除非在 manifest 文件中直接指定了该页面）。</p>
<p>manifest 文件的建议的文件扩展名是：”.appcache”。</p>
<p>请注意，manifest 文件需要配置<em>正确的 MIME-type</em>，即 “text/cache-manifest”。必须在 web 服务器上进行配置。</p>
<p>Web 应用程序的本地缓存是通过每个页面的 <code>manifest</code>文件来管理的。是一个简单的文件文本，清单列举了需要被缓存或者不需要被缓存的资源文件的文件名以及访问路径。</p>
<p>manifest 文件可分为三个部分：</p>
<ul>
<li><em>CACHE MANIFEST</em> - 在此标题下列出的文件将在首次下载后进行缓存</li>
<li><em>NETWORK</em> - 在此标题下列出的文件需要与服务器的连接，且不会被缓存</li>
<li><em>FALLBACK</em> - 在此标题下列出的文件规定当页面无法访问时的回退页面（比如 404 页面）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">CACHE MANIFEST</span><br><span class="line"># 文件开头必须要书写 CACHE MANIFEST</span><br><span class="line"># 以下是需要缓存的文件</span><br><span class="line"></span><br><span class="line">other.html</span><br><span class="line">images/1.jpg</span><br><span class="line">js/jquery.js</span><br><span class="line">css/bootstrap.css</span><br><span class="line"></span><br><span class="line">NETWORK：</span><br><span class="line">login.asp</span><br><span class="line"></span><br><span class="line">FALLBACK:</span><br><span class="line">online.js locale.js</span><br><span class="line"># 如果无法建立因特网连接，用 404页面替换/html/目录所有的文件，第一个是 URI资源，第二个是替补</span><br><span class="line">/html5/ /404.html</span><br></pre></td></tr></table></figure>
<p><strong>更新缓存</strong></p>
<p>一旦应用被缓存，它就会保持缓存知道下列的情况发生：</p>
<ul>
<li>用户清空浏览器缓存</li>
<li>manifest 文件被修改</li>
<li>由程序来更新应用缓存</li>
</ul>
<h3 id="浏览器与服务器的交互过程"><a href="#浏览器与服务器的交互过程" class="headerlink" title="浏览器与服务器的交互过程"></a>浏览器与服务器的交互过程</h3><p>场景：访问 网站A,以 index.html 为主页，使用 manifest 缓存了 index.html、1.js、1.css、1.jpg几个资源文件。</p>
<p>第一次访问：</p>
<ol>
<li>浏览器请求访问网站 A</li>
<li>服务器访问 index.html</li>
<li>浏览器解析 index.html，请求页面上的所有资源，包括 HTML/图像文件/CSS/JS/manifest文件等</li>
<li>服务器返回所有资源</li>
<li>浏览器处理 manifest文件，请求 manifest指定的本地缓存的文件，即使3中已经请求过了。如果要求缓存所有文件也是一个比较大的重复过程。</li>
<li>服务器返回所有要求缓存的文件</li>
<li>浏览器对本地缓存文件进行缓存，触发一个事件，通知本地缓存被更新</li>
</ol>
<p>manifest文件没有被修改，第二次访问：</p>
<ol>
<li>浏览器再次请求网站A</li>
<li>浏览器发现这个页面被本地缓存，于是使用本地缓存中的 index.html页面</li>
<li>浏览器解析 index.html，使用所有本地缓存中的资源文件</li>
<li>浏览器向服务器请求 manifest 文件</li>
<li>服务器返回一个 304，通知浏览器 manifest没有发生变化</li>
</ol>
<p>manifest文件被修改了，第三次访问：</p>
<ol>
<li>浏览器再次请求网站A</li>
<li>浏览器发送这个页面被本地缓存了，于是使用本地缓存中的 index.html页面</li>
<li>浏览器解析 index.html 文件，使用所有本地缓存中的资源文件</li>
<li>浏览器向服务器请求 manifest文件</li>
<li>服务器返回更新过的 manifest文件</li>
<li>浏览器处理 manifest文件，发送文件已经更新了，于是请求所有要求进行本地缓存的资源文件，包括 index.html 本身</li>
<li>浏览器返回要求进行本地缓存的资源文件</li>
<li>浏览器对本地缓存进行更新，存入所有新的资源文件，并且触发一个事件，通知本地缓存被更新了</li>
</ol>
<p>浏览器缓存过程中会触发一系列事件，该事件处理程序注册在ApplicationCache对象上，此对象是window的applicationCache属性的值。</p>
<p>下面详细描述了加载文档与更新应用缓存的流程：</p>
<ol>
<li>当浏览器访问一个包含 <code>manifest</code> 特性的文档时，如果应用缓存不存在，浏览器会加载文档，然后获取所有在清单文件中列出的文件，生成应用缓存的第一个版本。</li>
<li>对该文档的后续访问会使浏览器直接从应用缓存(而不是服务器)中加载文档与其他在清单文件中列出的资源。此外，浏览器还会向 <code>window.applicationCache 对象发送一个</code> <code>checking</code> 事件，在遵循合适的 HTTP 缓存规则前提下，获取清单文件。</li>
<li>如果当前缓存的清单副本是最新的，浏览器将向 <code>applicationCache 对象发送一个</code> <code>noupdate</code> 事件，到此，更新过程结束。注意，如果你在服务器修改了任何缓存资源，同时也应该修改清单文件，这样浏览器才能知道它需要重新获取资源。</li>
<li>如果清单文件<em>已经</em>改变，文件中列出的所有文件—也包括通过调用 <code>applicationCache.add() 方法添加到缓存中的那些文件</code>—会被获取并放到一个临时缓存中，遵循适当的 HTTP 缓存规则。对于每个加入到临时缓存中的文件，浏览器会向 <code>applicationCache 对象发送一个</code> <code>progress</code> 事件。如果出现任何错误，浏览器会发送一个 <code>error</code> 事件，并暂停更新。</li>
<li>一旦所有文件都获取成功，它们会自动移送到真正的离线缓存中，并向  <code>applicationCache</code>对象发送一个 <code>cached</code> 事件。鉴于文档早已经被从缓存加载到浏览器中，所以更新后的文档不会重新渲染，直到页面重新加载(可以手动或通过程序).</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//载入的时候，检查该清单文件。</span></span><br><span class="line"><span class="built_in">window</span>.applicationCache.onchecking = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    $(<span class="string">"san"</span>).innerHTML = <span class="string">"checking for a new version"</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//如果清单文件没有动，同时应用程序也已经缓存了，该事件执行。</span></span><br><span class="line"><span class="built_in">window</span>.applicationCache.onnoupdate = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    $(<span class="string">"san"</span>).innerHTML = <span class="string">"This version is up-to-date"</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//如果还未缓存应用程序，或者清单有改动</span></span><br><span class="line"><span class="built_in">window</span>.applicationCache.ondownloading = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    $(<span class="string">"san"</span>).innerHTML = <span class="string">"Downloading new version"</span>;</span><br><span class="line">    <span class="built_in">window</span>.progresscount = <span class="number">0</span>; <span class="comment">//在下面的事件中用到</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//下载过程不断调用progress事件，通常在每个文件下载完的时候。</span></span><br><span class="line"><span class="built_in">window</span>.applicationCache.onprogress = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> progress = <span class="string">""</span>; </span><br><span class="line">    <span class="keyword">if</span>(e &amp;&amp; e.lengthComputable)&#123;</span><br><span class="line">        progress = <span class="string">""</span> + <span class="built_in">Math</span>.round(<span class="number">100</span>*e.loaded / e.total) + <span class="string">"%"</span>; <span class="comment">//计算下载完成比例</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        progress = <span class="string">"("</span> + ++progresscount + <span class="string">")"</span>;  <span class="comment">//输出调用次数。</span></span><br><span class="line">    &#125;</span><br><span class="line">    $(<span class="string">"san"</span>).innerHTML = <span class="string">"Downloading new version"</span> + progress;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//当下载完成并且首次将应用程序下载到缓存中时</span></span><br><span class="line"><span class="built_in">window</span>.applicationCache.oncached = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    $(<span class="string">"san"</span>).innerHTML = <span class="string">"This application is now cached locally"</span> ;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//下载完成并且首次将应用程序下载到缓存中。</span></span><br><span class="line"><span class="built_in">window</span>.applicationCache.oncached = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    status(<span class="string">"This application is now cached locally"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//下载完成并缓存的程序更新后触发，注意触发此事件时，用户任然看到老版本，只有当用户再次载入时才会访问最新版。</span></span><br><span class="line"><span class="built_in">window</span>.applicationCache.onupdateready = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    status(<span class="string">"A new version has been downloaded.  Reload to run it"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//处于离线时，检查清单失败触发。</span></span><br><span class="line"> </span><br><span class="line"><span class="built_in">window</span>.applicationCache.onerror = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    status(<span class="string">"Couldn't load manifest or cache application"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//程序引用一个不存在的清单文件触发，同时将应用从缓存中删除。</span></span><br><span class="line"><span class="built_in">window</span>.applicationCache.onobsolete = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    status(<span class="string">"This application is no longer cached. "</span> + </span><br><span class="line">           <span class="string">"Reload to get the latest version from the network."</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="通信-API"><a href="#通信-API" class="headerlink" title="通信 API"></a>通信 API</h2><h3 id="跨文档消息传输"><a href="#跨文档消息传输" class="headerlink" title="跨文档消息传输"></a>跨文档消息传输</h3><p>可以在不同网页文档、不同端口、不同域之间进行消息传递。</p>
<p>HTML5 提供了在网页文档之间互相接受与发送消息的功能，只要获取到网页所在窗口对象的实例，不仅同源（域+端口号）的 Web 之间可以互相通信，甚至可以实现跨域通信。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.postMessage();</span><br><span class="line"><span class="comment">// 这个方法可以安全实现跨域通信。提供了一个受控禁止来规避同源策略的限制。这个方法被调用时，会在所有页面脚本执行完毕之后向目标窗口派发一个 MessageEvent 消息。这个消息有四个属性：message属性表示 message类型，data属性为 window.postMessage的第一个参数；origin属性表示调用 window.postMessage方法调用页面的当前状态；source属性记录调用 window.postMessage方法的窗口消息</span></span><br><span class="line"></span><br><span class="line">otherWindow.postMessage(message,targetOrigin,[transfer]);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* otherWindow 其他窗口的一个引用，比如 iframe的contentWindow属性，执行 window.open返回的窗口对象，或者是命名过或数值索引的 window.frames</span></span><br><span class="line"><span class="comment">* message 将要发送到其他 window的数据，会被结构化克隆算法序列化。意味着不受什么限制将数据对象安全传送给目标窗口不用自己序列化</span></span><br><span class="line"><span class="comment">* targetOrigin 通过窗口的 origin 属性来指定哪些窗口能接受到消息时间。可以是“*”或者一个URI.如果目标窗口的协议、主机地址或端口这三者的任意一项不匹配targetOrigin提供的值，那么消息就不会被发送；只有三者完全匹配，消息才会被发送。这个机制用来控制消息可以发送到哪些窗口；</span></span><br><span class="line"><span class="comment">* transfer 可选 是一串和 message同时传递的 Transferable 对象，这些对象的所有权将被转移给消息的接收方，而发送一方不再保有所有权。</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p><strong>派发事件</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'message'</span>,receiveMessage,<span class="literal">false</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">receiveMessage</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> &#123; origin,data,source&#125; = event;</span><br><span class="line">    <span class="keyword">if</span>(origin !== <span class="string">'http://example.com:8080'</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(source+<span class="string">':'</span>+data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* message的属性;</span></span><br><span class="line"><span class="comment">* data 从其他 window 传递来的对象</span></span><br><span class="line"><span class="comment">* origin 调用 postMessage 时消息发送方窗口的 origin，不能保证是该窗口当前的 或者 未来的origin，因为 postMessage被调用后可能被导航到不同的位置</span></span><br><span class="line"><span class="comment">* source 对发送消息窗口的引用，可以使用这个在具有不同 origin 的两个窗口建立双向通信</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p><strong>示例</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// A窗口域名是 http://example.com:8080 下面是 A 窗口 script 里面代码</span></span><br><span class="line"><span class="keyword">let</span> popup = <span class="built_in">window</span>.open(...popup details...);</span><br><span class="line"><span class="comment">// 如果弹出框没有被阻止且加载完成</span></span><br><span class="line"><span class="comment">// 这行语句没有发送信息出去，即使假设当前页面没有改变location（因为targetOrigin设置不对）</span></span><br><span class="line">popup.postMessage(<span class="string">"The user is 'bob' and the password is 'secret'"</span>,<span class="string">"https://secure.example.net"</span>);</span><br><span class="line"><span class="comment">// 假设当前页面没有改变location，这条语句会成功添加message到发送队列中去（targetOrigin设置对了）</span></span><br><span class="line">popup.postMessage(<span class="string">"hello there!"</span>,<span class="string">"http://example.com"</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">receiveMessage</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(event.origin !== <span class="string">'http://example.org'</span>) <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'message'</span>,receiveMessage,<span class="literal">false</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 弹出页 popup域名是 http://example.org 下面是 script 里面代码</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//当A页面postMessage被调用后，这个function被addEventListenner调用</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">receiveMessage</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(event.origin !== <span class="string">'http://example.com:8080'</span>) <span class="keyword">return</span></span><br><span class="line">     <span class="comment">// event.data 是 "hello there!"</span></span><br><span class="line">    <span class="comment">// event.source 就当前弹出页的来源页面</span></span><br><span class="line">    event.source.postMessage(<span class="string">"hi there yourself!  the secret response "</span> +<span class="string">"is: rheeeeet!"</span>,event.origin);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">"message"</span>, receiveMessage, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>
<h3 id="Web-Sockets-通信"><a href="#Web-Sockets-通信" class="headerlink" title="Web Sockets 通信"></a>Web Sockets 通信</h3><p>使用 Web Sockets API 可以在服务器与客户端之间建立一个非 HTTP 的双向连接。这个连接是实时的，也是要永久的，除非某一方显示关闭。</p>
<p><strong>常量</strong></p>
<table>
<thead>
<tr>
<th><strong>Constant</strong></th>
<th><strong>Value</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>WebSocket.CONNECTING</code></td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>WebSocket.OPEN</code></td>
<td><code>1</code></td>
</tr>
<tr>
<td><code>WebSocket.CLOSING</code></td>
<td><code>2</code></td>
</tr>
<tr>
<td><code>WebSocket.CLOSED</code></td>
<td><code>3</code></td>
</tr>
</tbody>
</table>
<p>以上是WebSocket 构造函数的原型中存在的一些常量，可通过 <code>WebSocket.readyState</code> 对照上述常量判断 WebSocket 连接 当前所处的状态</p>
<p><strong>用法：</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// URL字符串以 ws 或者 wss（加密通信时）文字开头</span></span><br><span class="line"><span class="keyword">const</span> socket = <span class="keyword">new</span> WebSocket(<span class="string">'ws://localhost:8080'</span>);</span><br><span class="line"></span><br><span class="line">socket.addEventListener(<span class="string">'open'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// send方法对服务器发送数据，只能发送文本数据，可以使用 JSON对象把任何 js对象转换为文本数据后发送</span></span><br><span class="line">    socket.send(<span class="string">'Hello Server!'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">socket.addEventListerner(<span class="string">'message'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Message from server'</span>,event.data);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//事件句柄</span></span><br><span class="line"><span class="comment">// 接受服务器传过来的数据</span></span><br><span class="line">socket.onmessage = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> &#123; data &#125; = event</span><br><span class="line">&#125;</span><br><span class="line">socket.onopen = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 开始通信</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 监听 socket 关闭事件</span></span><br><span class="line">socket.onclose = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 通信结束时的处理</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 关闭 socket，切断通信连接0000</span></span><br><span class="line">socket.close()</span><br></pre></td></tr></table></figure>
<h2 id="使用-Web-Workers-处理线程"><a href="#使用-Web-Workers-处理线程" class="headerlink" title="使用 Web Workers 处理线程"></a>使用 Web Workers 处理线程</h2><p>web worker 是运行在后台的 javaScript，不会影响页面的性能。</p>
<p>创建后台线程的步骤很简单。将需要在后台线程中指定的脚本文件的 URL 地址作为参数，然后创建 Worker对象就可以了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> worker = <span class="keyword">new</span> Worker(<span class="string">'worker.js'</span>);</span><br><span class="line"><span class="comment">// 后台线程是不能访问到页面或者窗口对象的，所以如果使用到 window对象或者 document对象会以前你错误的发生</span></span><br></pre></td></tr></table></figure>
<p>可以通过发送和接收消息来与后台线程互相传递数据。通过 Worker 对象的 onmessage 事件句柄活期户后台线程之间的消息</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">worker.onmessage = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 处理收到的消息</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// message 文本数据</span></span><br><span class="line">worker.postMessage(message);</span><br></pre></td></tr></table></figure>
<h3 id="示例：求和计算"><a href="#示例：求和计算" class="headerlink" title="示例：求和计算"></a>示例：求和计算</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>从1到给定数值求和<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  输入数值：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"num"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"calculate()"</span>&gt;</span>计算<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> worker = <span class="keyword">new</span> Worker(<span class="string">'SumCalculate.js'</span>);</span></span><br><span class="line"><span class="javascript">    worker.onmessage = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(event.data);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">calculate</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> num = <span class="built_in">parseInt</span>(<span class="built_in">document</span>.getElementById(<span class="string">'num'</span>).value,<span class="number">10</span>);</span></span><br><span class="line"><span class="undefined">      worker.postMessage(num);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SumCalculate.js</span></span><br><span class="line">onmessage = <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> num = event.data;</span><br><span class="line">  <span class="keyword">let</span> result = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt;= num; i++) &#123;</span><br><span class="line">    result += i;</span><br><span class="line">  &#125;</span><br><span class="line">  postMessage(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="示例：与线程进行数据的交互"><a href="#示例：与线程进行数据的交互" class="headerlink" title="示例：与线程进行数据的交互"></a>示例：与线程进行数据的交互</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>从随机生成的数字中抽取3的倍数并显示<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">table</span> <span class="attr">id</span>=<span class="string">"table"</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="comment">// 随机数组</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> intArray = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">100</span>);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> intStr = <span class="string">''</span>;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// 生成100个随机数</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span></span><br><span class="line"><span class="javascript">      intArray[i] = <span class="built_in">parseInt</span>(<span class="built_in">Math</span>.random() * <span class="number">100</span>);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span> (i != <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="javascript">        intStr += <span class="string">';'</span>;       </span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">      intStr += intArray[i]</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> worker = <span class="keyword">new</span> Worker(<span class="string">'script.js'</span>);</span></span><br><span class="line"><span class="undefined">    worker.postMessage(intStr);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    worker.onmessage = <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span> (event.data != <span class="string">''</span>) &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> j;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> k;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> tr;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> td;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> intArray = event.data.split(<span class="string">';'</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> table = <span class="built_in">document</span>.getElementById(<span class="string">'table'</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; intArray.length; i++) &#123;</span></span><br><span class="line"><span class="javascript">          j = <span class="built_in">parseInt</span>(i / <span class="number">10</span>, <span class="number">0</span>);</span></span><br><span class="line"><span class="undefined">          k = i % 10;</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 该行不存在</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">if</span> (k == <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">// 添加行</span></span></span><br><span class="line"><span class="javascript">            tr = <span class="built_in">document</span>.createElement(<span class="string">'tr'</span>);</span></span><br><span class="line"><span class="javascript">            tr.id = <span class="string">'tr'</span> + j;</span></span><br><span class="line"><span class="undefined">            table.appendChild(tr);</span></span><br><span class="line"><span class="javascript">          &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">            tr = <span class="built_in">document</span>.getElementById(<span class="string">'tr'</span> + j);</span></span><br><span class="line"><span class="undefined">          &#125;</span></span><br><span class="line"><span class="javascript">          td = <span class="built_in">document</span>.createElement(<span class="string">'td'</span>);</span></span><br><span class="line"><span class="undefined">          tr.appendChild(td);</span></span><br><span class="line"><span class="undefined">          td.innerHTML = intArray[j * 10 + k];</span></span><br><span class="line"><span class="javascript">          td.style.backgroundColor = <span class="string">'blue'</span>;</span></span><br><span class="line"><span class="javascript">          td.style.color = <span class="string">'white'</span>;</span></span><br><span class="line"><span class="undefined">          td.width = 30;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// script.js</span></span><br><span class="line">onmessage = <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> &#123; data &#125; = event;</span><br><span class="line">  <span class="keyword">let</span> returnStr=<span class="string">""</span>;</span><br><span class="line">  <span class="keyword">let</span> intArray = data.split(<span class="string">';'</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; intArray.length; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">parseInt</span>(intArray[i]) % <span class="number">3</span> == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (returnStr != <span class="string">''</span>) &#123;</span><br><span class="line">        returnStr += <span class="string">';'</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      returnStr += intArray[i]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  postMessage(returnStr)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="线程嵌套"><a href="#线程嵌套" class="headerlink" title="线程嵌套"></a>线程嵌套</h3><p><strong>单层嵌套</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// html script</span></span><br><span class="line"><span class="keyword">let</span> worket = <span class="keyword">new</span> Worker(<span class="string">'script.js'</span>)</span><br><span class="line">worket.onmessage = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(event.data)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// script.js</span></span><br><span class="line"></span><br><span class="line">onmessage = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> &#123; data &#125; = event;</span><br><span class="line">    <span class="keyword">let</span> worker = <span class="keyword">new</span> Worker(<span class="string">'script2.js'</span>)</span><br><span class="line">    <span class="comment">// 把数据提交给子线程处理</span></span><br><span class="line">    worker.postMessage(<span class="built_in">JSON</span>.stringfy(data))</span><br><span class="line">    worker.onmessage = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">        <span class="comment">// 把结果返回主页面</span></span><br><span class="line">        postMessage(event.data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// script2.js</span></span><br><span class="line">onmessage = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> &#123; data &#125; = event;</span><br><span class="line">    result = someMethod(data);</span><br><span class="line">    <span class="comment">// 将处理好的处理返回</span></span><br><span class="line">    postMessage(result)</span><br><span class="line">    <span class="comment">// 如果不再使用则关闭子线程</span></span><br><span class="line">    close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>多个线程中进行数据的交互</strong></p>
<p>实现子线程与子线程之间数据交互的，大致需要下面步骤：</p>
<ol>
<li>先创建发送数据的子线程</li>
<li>执行子线程中的任务，然后把要传递的数据发送给主线程</li>
<li>在主线程接受到子线程传回来的消息时，创建接受数据的子线程，然后把发送数据的子线程中返回的消息传递给接受数据的子线程</li>
<li>执行接受数据子线程中的代码</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">onmessage = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">let</span> worker;</span><br><span class="line">    worker = <span class="keyword">new</span> Worker(<span class="string">'worker1.js'</span>);</span><br><span class="line">    worker.onmessage = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">        <span class="comment">// 接受子线程中的数据</span></span><br><span class="line">        <span class="keyword">let</span> &#123; data &#125; = event;</span><br><span class="line">        worker = <span class="keyword">new</span> Worker(<span class="string">'worker2.js'</span>);</span><br><span class="line">        <span class="comment">// 把从发送数据的子线程中发回的消息传递给接受数据的子线程</span></span><br><span class="line">        worker.postMessage(data);</span><br><span class="line">        worker.onmessage = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">            <span class="comment">// 获取接受数据的子线程中传回的数据</span></span><br><span class="line">            <span class="keyword">let</span> &#123;data&#125; = event;</span><br><span class="line">            <span class="comment">// 把结果发送到主页面</span></span><br><span class="line">            postMessage(data);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// worker1.js 发送数据的子线程</span></span><br><span class="line">onmessga = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> &#123;someData&#125; = event;</span><br><span class="line">    result = someMethod(someData);</span><br><span class="line">    postMassage(result);</span><br><span class="line">    <span class="comment">// 关闭子线程</span></span><br><span class="line">    close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="线程中可用的变量、函数与类"><a href="#线程中可用的变量、函数与类" class="headerlink" title="线程中可用的变量、函数与类"></a>线程中可用的变量、函数与类</h3><ul>
<li><p>self</p>
<p>表示本线程范围内的作用域</p>
</li>
<li><p>postMessage(message)</p>
<p>向创建线程的源窗口发送信息</p>
</li>
<li><p>onmessage</p>
<p>获取接受消息的事件句柄</p>
</li>
<li><p>importScripts(urls)</p>
<p>导入其他脚本文件，参数为文件的 URL地址，可以导入多个</p>
</li>
<li><p>navigator</p>
<p>与 window.navigator对象类似，具有 appName、platform、userAgent、appVersion这些属性</p>
</li>
<li><p>sessionStorage/localStorage</p>
<p>可以在线程中使用 Web Storage</p>
</li>
<li><p>XMLHttpRequest</p>
<p>在线程中处理 Ajax请求</p>
</li>
<li><p>setTimeout/setInterval</p>
<p>在线程中实现定时处理</p>
</li>
<li><p>close</p>
<p>结束本线程</p>
</li>
<li><p>eval/isNaN/escape</p>
<p>使用 javascipt 的核心函数</p>
</li>
<li><p>object</p>
<p>可以创建对象</p>
</li>
<li><p>WebSockets</p>
<p>使用 WebSockets API 来想服务器发送和接收信息</p>
</li>
</ul>

      
    </div>
    
    
    

    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    赖彬鸿
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://laibh.top/面试官问我HTML5是什么（中）.html" title="面试官问我HTML5是什么（中）">http://laibh.top/面试官问我HTML5是什么（中）.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/HTML5/" <i class="fa fa-tag"></i> HTML5</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/面试官问我HTML5是什么（上）.html" rel="next" title="面试官问我HTML5是什么（上）">
                <i class="fa fa-chevron-left"></i> 面试官问我HTML5是什么（上）
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/面试官问我HTML5是什么（下）.html" rel="prev" title="面试官问我HTML5是什么（下）">
                面试官问我HTML5是什么（下） <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
        
  <script>
    window._bd_share_config = {
      "common": {
        "bdText": "",
        "bdMini": "1",
        "bdMiniList": false,
        "bdPic": ""
      },
      "image": {
        "viewList": ["tsina", "douban", "sqq", "qzone", "weixin", "twi", "fbook"],
        "viewText": "分享到：",
        "viewSize": "16"
      },
      "slide": {
        "bdImg": "5",
        "bdPos": "left",
        "bdTop": "100"
      }
    }
  </script>

<script>
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/static/api/js/share.js?v=89860593.js?'+~(-new Date()/36e5)];;
</script>

      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC8zOTcwMy8xNjIzMA"></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/myPhoto.jpg"
                alt="赖彬鸿" />
            
              <p class="site-author-name" itemprop="name">赖彬鸿</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">135</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">32</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">40</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          
          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/LbhFront-end" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.cnblogs.com/lbh2018/" target="_blank" title="博客园">
                      
                        <i class="fa fa-fw fa-globe"></i>博客园</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://yq.aliyun.com/users/1802204154913774?spm=a2c4e.11153940.blogcont662526.4.6c0a34f6E2lR5o" target="_blank" title="云栖">
                      
                        <i class="fa fa-fw fa-globe"></i>云栖</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:544289495@qq.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=544289495&website=www.oicqzone.com" target="_blank" title="QQ">
                      
                        <i class="fa fa-fw fa-qq"></i>QQ</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.google.com.hk/search?safe=strict&source=hp&ei=JtLCXIriJ8G4-gS_-4qABQ&q=site%3Alaibh.top&btnK=Google+%E6%90%9C%E7%B4%A2&oq=site%3Alaibh.top&gs_l=psy-ab.3...1158.6834..7051...5.0..1.246.3720.2-17......0....1..gws-wiz.....0..0j0i10.rJMUHvdrbds" target="_blank" title="Google">
                      
                        <i class="fa fa-fw fa-google"></i>Google</a>
                  </span>
                
            </div>
          
         <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=90  src="//music.163.com/outchain/player?type=0&id=2353471182&auto=0&height=90"></iframe>
          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                友情链接
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.chjtx.com/JRoll/" title="醉萝卜" target="_blank">醉萝卜</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://hzd.plus/" title="Zhendong" target="_blank">Zhendong</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.cnblogs.com/cnyball" title="cnyballk" target="_blank">cnyballk</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://johnzz.top/" title="John" target="_blank">John</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://xiaojun1994.top/" title="xiaojun1994" target="_blank">xiaojun1994</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://me.ursb.me" title="Airing" target="_blank">Airing</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.iyouhun.com" title="游魂" target="_blank">游魂</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://icoty.github.io/" title="荒野之萍" target="_blank">荒野之萍</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://im-one.github.io/" title="imOne" target="_blank">imOne</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://blog.hourxu.com/" title="Ambre" target="_blank">Ambre</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.huyujs.com" title="胡雨" target="_blank">胡雨</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.andou.live" title="安逗" target="_blank">安逗</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.jianshu.com/u/701a8bbf4f7e" title="陈健斌" target="_blank">陈健斌</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://itobys.github.io/" title="汤姆Tom酱" target="_blank">汤姆Tom酱</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://breeze2.github.io/blog/" title="林毅锋" target="_blank">林毅锋</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.qzroc.com/" title="大鹏博客" target="_blank">大鹏博客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://lyreal666.com/" title="余腾靖的博客" target="_blank">余腾靖的博客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://buzuosheng.com/" title="不作声" target="_blank">不作声</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.baidu.com/s?ie=UTF-8&wd=site%3Alaibh.top" title="百度" target="_blank">百度</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.google.com.hk/search?safe=strict&source=hp&ei=zXdWXfemLJbO0PEP8qyXyA0&q=site%3Alaibh.top&oq=site%3Alaibh.top&gs_l=psy-ab.3...580.8501..8767...0.0..0.397.934.2-1j2......0....2j1..gws-wiz.QESXfWGadT0&ved=0ahUKEwi3wbusiofkAhUWJzQIHXLWBdkQ4dUDCAU&uact=5" title="谷歌" target="_blank">谷歌</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Canvas"><span class="nav-number">1.</span> <span class="nav-text">Canvas</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#绘制图形"><span class="nav-number">1.1.</span> <span class="nav-text">绘制图形</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#在页面中放置-canvas元素"><span class="nav-number">1.2.</span> <span class="nav-text">在页面中放置 canvas元素</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#绘制矩形"><span class="nav-number">1.2.1.</span> <span class="nav-text">绘制矩形</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用路径"><span class="nav-number">1.3.</span> <span class="nav-text">使用路径</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#绘制圆形"><span class="nav-number">1.3.1.</span> <span class="nav-text">绘制圆形</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#不关闭路径"><span class="nav-number">1.3.2.</span> <span class="nav-text">不关闭路径</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#绘制线"><span class="nav-number">1.3.3.</span> <span class="nav-text">绘制线</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#使用-bezierCurveTo-绘制贝塞尔曲线"><span class="nav-number">1.3.4.</span> <span class="nav-text">使用 bezierCurveTo 绘制贝塞尔曲线</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#绘制渐变图形"><span class="nav-number">1.4.</span> <span class="nav-text">绘制渐变图形</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#绘制线性渐变"><span class="nav-number">1.4.1.</span> <span class="nav-text">绘制线性渐变</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#绘制径向渐变"><span class="nav-number">1.4.2.</span> <span class="nav-text">绘制径向渐变</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#绘制变形图形"><span class="nav-number">1.5.</span> <span class="nav-text">绘制变形图形</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#坐标变换"><span class="nav-number">1.5.1.</span> <span class="nav-text">坐标变换</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#与路径结合使用"><span class="nav-number">1.5.2.</span> <span class="nav-text">与路径结合使用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#矩阵变换"><span class="nav-number">1.5.3.</span> <span class="nav-text">矩阵变换</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#图形组合"><span class="nav-number">1.6.</span> <span class="nav-text">图形组合</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#给图形绘制阴影"><span class="nav-number">1.7.</span> <span class="nav-text">给图形绘制阴影</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用图像"><span class="nav-number">1.8.</span> <span class="nav-text">使用图像</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#绘制图像"><span class="nav-number">1.8.1.</span> <span class="nav-text">绘制图像</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#图像平铺"><span class="nav-number">1.8.2.</span> <span class="nav-text">图像平铺</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#图像裁剪"><span class="nav-number">1.8.3.</span> <span class="nav-text">图像裁剪</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#像素处理"><span class="nav-number">1.8.4.</span> <span class="nav-text">像素处理</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#绘制文字"><span class="nav-number">1.9.</span> <span class="nav-text">绘制文字</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#其他"><span class="nav-number">1.10.</span> <span class="nav-text">其他</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#保存与恢复状态"><span class="nav-number">1.10.1.</span> <span class="nav-text">保存与恢复状态</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#保存文件"><span class="nav-number">1.10.2.</span> <span class="nav-text">保存文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#简单动画的制作"><span class="nav-number">1.10.3.</span> <span class="nav-text">简单动画的制作</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#多媒体播放"><span class="nav-number">2.</span> <span class="nav-text">多媒体播放</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#关于-video-与-audio元素"><span class="nav-number">2.1.</span> <span class="nav-text">关于 video 与 audio元素</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#属性"><span class="nav-number">2.2.</span> <span class="nav-text">属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#方法"><span class="nav-number">2.3.</span> <span class="nav-text">方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#事件"><span class="nav-number">2.4.</span> <span class="nav-text">事件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#事件捕捉示例"><span class="nav-number">2.5.</span> <span class="nav-text">事件捕捉示例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#本地存储"><span class="nav-number">3.</span> <span class="nav-text">本地存储</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Web-Storage"><span class="nav-number">3.1.</span> <span class="nav-text">Web Storage</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#示例：简单-web-留言本"><span class="nav-number">3.2.</span> <span class="nav-text">示例：简单 web 留言本</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#示例：简易数据库"><span class="nav-number">3.3.</span> <span class="nav-text">示例：简易数据库</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#本地数据库-新的推荐IndexedDB实现"><span class="nav-number">4.</span> <span class="nav-text">本地数据库(新的推荐IndexedDB实现)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#实例：留言本"><span class="nav-number">4.1.</span> <span class="nav-text">实例：留言本</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#离线应用程序（已废弃）"><span class="nav-number">5.</span> <span class="nav-text">离线应用程序（已废弃）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#manifest文件"><span class="nav-number">5.1.</span> <span class="nav-text">manifest文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#浏览器与服务器的交互过程"><span class="nav-number">5.2.</span> <span class="nav-text">浏览器与服务器的交互过程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#通信-API"><span class="nav-number">6.</span> <span class="nav-text">通信 API</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#跨文档消息传输"><span class="nav-number">6.1.</span> <span class="nav-text">跨文档消息传输</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Web-Sockets-通信"><span class="nav-number">6.2.</span> <span class="nav-text">Web Sockets 通信</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用-Web-Workers-处理线程"><span class="nav-number">7.</span> <span class="nav-text">使用 Web Workers 处理线程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#示例：求和计算"><span class="nav-number">7.1.</span> <span class="nav-text">示例：求和计算</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#示例：与线程进行数据的交互"><span class="nav-number">7.2.</span> <span class="nav-text">示例：与线程进行数据的交互</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#线程嵌套"><span class="nav-number">7.3.</span> <span class="nav-text">线程嵌套</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#线程中可用的变量、函数与类"><span class="nav-number">7.4.</span> <span class="nav-text">线程中可用的变量、函数与类</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart throb" style="color: #d43f57;"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">赖彬鸿</span>

  
</div>

  <script src='https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js'></script>
  <script>
    if (window.mermaid) {
      mermaid.initialize("");
    }
  </script>

<!--

  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>



-->
<div>
<span id="busuanzi_container_site_pv" title="访问量">
    <i class="fa fa fa-eye"></i> <span id="busuanzi_value_site_pv"></span>
</span>
<span id="busuanzi_container_site_uv" title="访问人数">
  <i class="fa fa-user"></i> <span id="busuanzi_value_site_uv"></span>
</span>
<span class="post-count" title="博客总字数"><i class="fa fa-pagelines" aria-hidden="true"></i>745.9k</span>
</div>
<i class="fa fa-shield" aria-hidden="true" title="本站安全运行时间"></i> <span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span>
<script>
    var now = new Date();
    function createtime() {
        var grt= new Date("01/29/2018 09:47:04");//此处修改你的建站时间或者网站上线时间
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds);
        if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = dnum+" 天 ";
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒";
    }
setInterval("createtime()",250);
</script>

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>
  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="//cdn.bootcss.com/jquery/2.1.3/jquery.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  












  




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=5.1.4"></script>



  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("JcDzlAxx8A0MJDQ9xpJTOBUe-gzGzoHsz", "hih724suAgjSWQnvOuIEvxza");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  
  <script type="text/javascript" src="/js/src/js.cookie.js?v=5.1.4"></script>
  <script type="text/javascript" src="/js/src/scroll-cookie.js?v=5.1.4"></script>


  

  <!-- 代码块复制功能 -->
  <script type="text/javascript" src="/js/src/clipboard.js"></script>  
  <script type="text/javascript" src="/js/src/clipboard-use.js"></script>
<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/tororo.model.json"},"display":{"position":"right","width":200,"height":400},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
