<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="测试," />





  <link rel="alternate" href="/atom.xml" title="赖同学" type="application/atom+xml" />






<meta name="description" content="前端必备的测试DellLee 老师的 前端要学的测试课 从Jest入门到TDD/BDD双实战学习记录。 知识点 Jest 基础 基础API、异步测试、Mock技巧、快照、timer测试、Dom测试 实现项目 Vue、Vue-test-utils、React、Enzyme、TDD+单元测试、BDD+集成测试 初识测试123456789101112131415161718192021222324252">
<meta name="keywords" content="测试">
<meta property="og:type" content="article">
<meta property="og:title" content="前端必备的测试">
<meta property="og:url" content="http://laibh.top/2019-08-19-前端必备的测试学习.html">
<meta property="og:site_name" content="赖同学">
<meta property="og:description" content="前端必备的测试DellLee 老师的 前端要学的测试课 从Jest入门到TDD/BDD双实战学习记录。 知识点 Jest 基础 基础API、异步测试、Mock技巧、快照、timer测试、Dom测试 实现项目 Vue、Vue-test-utils、React、Enzyme、TDD+单元测试、BDD+集成测试 初识测试123456789101112131415161718192021222324252">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2022-03-04T10:00:38.464Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="前端必备的测试">
<meta name="twitter:description" content="前端必备的测试DellLee 老师的 前端要学的测试课 从Jest入门到TDD/BDD双实战学习记录。 知识点 Jest 基础 基础API、异步测试、Mock技巧、快照、timer测试、Dom测试 实现项目 Vue、Vue-test-utils、React、Enzyme、TDD+单元测试、BDD+集成测试 初识测试123456789101112131415161718192021222324252">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '1YNH8Y3MP9',
      apiKey: '61c189facf700193dfcbb902369ce227',
      indexName: 'MyBlog',
      hits: {"per_page":10},
      labels: {"input_placeholder":"想要找些什么呢","hits_empty":"${query} 没有被找到，再试试","hits_stats":"在 ${time} ms 查找了${hits}个结果"}
    }
  };
</script>



  <link rel="canonical" href="http://laibh.top/2019-08-19-前端必备的测试学习.html"/>





  <title>前端必备的测试 | 赖同学</title>
  








</head>
<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">赖同学</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description"></h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            站点地图
          </a>
        </li>
      
        
        <li class="menu-item menu-item-guestbook">
          <a href="/guestbook" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-comment"></i> <br />
            
            留言
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://laibh.top/2019-08-19-前端必备的测试学习.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="赖彬鸿">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/myPhoto.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="赖同学">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">前端必备的测试</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-19T08:33:54+08:00">
                2019-08-19
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2022-03-04T18:00:38+08:00">
                2022-03-04
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/测试/" itemprop="url" rel="index">
                    <span itemprop="name">测试</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2019-08-19-前端必备的测试学习.html" class="leancloud_visitors" data-flag-title="前端必备的测试">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  14,541
                </span>
              

              

              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="前端必备的测试"><a href="#前端必备的测试" class="headerlink" title="前端必备的测试"></a>前端必备的测试</h1><p>DellLee 老师的 <a href="https://coding.imooc.com/class/372.html">前端要学的测试课 从Jest入门到TDD/BDD双实战</a>学习记录。</p>
<p><strong>知识点</strong></p>
<p>Jest 基础</p>
<p><code>基础API</code>、<code>异步测试</code>、<code>Mock技巧</code>、<code>快照</code>、<code>timer测试</code>、<code>Dom测试</code></p>
<p>实现项目</p>
<p><code>Vue</code>、<code>Vue-test-utils</code>、<code>React</code>、<code>Enzyme</code>、<code>TDD+单元测试</code>、<code>BDD+集成测试</code></p>
<h2 id="初识测试"><a href="#初识测试" class="headerlink" title="初识测试"></a>初识测试</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// math.js</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">minus</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a - b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">  add,</span><br><span class="line">  minus</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// math.test.js</span></span><br><span class="line"><span class="comment">// 简陋测试</span></span><br><span class="line"><span class="keyword">import</span> &#123; add, minus &#125; <span class="keyword">from</span> <span class="string">'./math'</span></span><br><span class="line"><span class="keyword">let</span> result</span><br><span class="line"><span class="keyword">let</span> expected</span><br><span class="line">result = add(<span class="number">3</span>, <span class="number">7</span>)</span><br><span class="line">expected = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (result !== <span class="number">10</span>) &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="built_in">Error</span>(<span class="string">`3 + 7 应该等于 <span class="subst">$&#123;expected&#125;</span>,但结果却是 <span class="subst">$&#123;result&#125;</span>`</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">result = minus(<span class="number">3</span>, <span class="number">3</span>)</span><br><span class="line">expected = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (result !== <span class="number">0</span>) &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="built_in">Error</span>(<span class="string">`3 - 3 应该等于 <span class="subst">$&#123;expected&#125;</span>,但结果却是 <span class="subst">$&#123;result&#125;</span>`</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 封装版</span></span><br><span class="line"><span class="keyword">import</span> &#123; add, minus &#125; <span class="keyword">from</span> <span class="string">'./math'</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">expect</span>(<span class="params">result</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    toBe: <span class="function"><span class="keyword">function</span> (<span class="params">actual</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (result !== actual) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`预期值与实际值不相等 预期<span class="subst">$&#123;actual&#125;</span> 结果却是 <span class="subst">$&#123;result&#125;</span>`</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">desc, fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    fn();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;desc&#125;</span>通过测试`</span>)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;desc&#125;</span>没有通过测试 <span class="subst">$&#123;e&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">test(<span class="string">'测试加法3 + 7'</span>, () =&gt; &#123;</span><br><span class="line">  expect(add(<span class="number">3</span>, <span class="number">7</span>)).toBe(<span class="number">6</span>)</span><br><span class="line">&#125;)</span><br><span class="line">test(<span class="string">'测试减法6 - 3'</span>, () =&gt; &#123;</span><br><span class="line">  expect(minus(<span class="number">6</span>, <span class="number">3</span>)).toBe(<span class="number">6</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="自动化框架：Jest"><a href="#自动化框架：Jest" class="headerlink" title="自动化框架：Jest"></a>自动化框架：Jest</h2><p>优点：性能、功能、易用性、速度快、Api简单、易配置、隔离性好、监控模式、IDE整合、Snapshot、多项目并行、覆盖率、Mock丰富</p>
<h3 id="简单配置"><a href="#简单配置" class="headerlink" title="简单配置"></a>简单配置</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 项目内部调用 jest</span></span><br><span class="line">npx jest --init </span><br><span class="line"><span class="meta">#</span><span class="bash"> 选择 </span></span><br><span class="line">browser-like</span><br><span class="line"><span class="meta">#</span><span class="bash"> 随后选择自动生成报告，自动清除实例在每个<span class="built_in">test</span>之前，就会生成一下配置文件</span></span><br><span class="line">jest.config.js</span><br></pre></td></tr></table></figure>
<p><code>jest.config.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// For a detailed explanation regarding each configuration property, visit:</span></span><br><span class="line"><span class="comment">// https://jestjs.io/docs/en/configuration.html</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// All imported modules in your tests should be mocked automatically</span></span><br><span class="line">  <span class="comment">// 自动模拟在测试用例中的所有导入模块，在 __mocks__ 文件夹中寻找</span></span><br><span class="line">  <span class="comment">// automock: false,</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Stop running tests after `n` failures</span></span><br><span class="line">  <span class="comment">// 默认情况下，Jest运行所有测试并在完成后将所有错误生成到控制台，bil 让 jest 在 n 失败后停止运行测试</span></span><br><span class="line">  <span class="comment">// bail: 0,</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Respect "browser" field in package.json when resolving modules</span></span><br><span class="line">  <span class="comment">// false =&gt; browser | true =&gt; node</span></span><br><span class="line">  <span class="comment">// browser: false,</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// The directory where Jest should store its cached dependency information</span></span><br><span class="line">  <span class="comment">// 存放 jest 依赖信息缓存的目录</span></span><br><span class="line">  <span class="comment">// cacheDirectory: "C:\\Users\\Administrator\\AppData\\Local\\Temp\\jest",</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Automatically clear mock calls and instances between every test</span></span><br><span class="line">  <span class="comment">// 自动清除模拟调用和实例在每次测试之间</span></span><br><span class="line">  clearMocks: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Indicates whether the coverage information should be collected while executing the test</span></span><br><span class="line">  <span class="comment">// 是否收集测试时的覆盖率信息，因为要带上覆盖率搜集语句访问所有执行过的文件，这可能会让测试执行速度明显减慢</span></span><br><span class="line">  <span class="comment">// collectCoverage: false,</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// An array of glob patterns indicating a set of files for which coverage information should be collected</span></span><br><span class="line">  <span class="comment">// 指示应收集覆盖率信息的全局模式一组文件，即使文件不存在测试，也将为其收集覆盖率信息，并且测试套件中不需要它</span></span><br><span class="line">  <span class="comment">// collectCoverageFrom: null,</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// The directory where Jest should output its coverage files</span></span><br><span class="line">  <span class="comment">// jest 输出测速覆盖率文件的目录</span></span><br><span class="line">  <span class="comment">// 运行 npx jest --coverage</span></span><br><span class="line">  coverageDirectory: <span class="string">"coverage"</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// An array of regexp pattern strings used to skip coverage collection</span></span><br><span class="line">  <span class="comment">// 忽略测试的文件路径的正则匹配</span></span><br><span class="line">  <span class="comment">// coveragePathIgnorePatterns: [</span></span><br><span class="line">  <span class="comment">//   "\\\\node_modules\\\\"</span></span><br><span class="line">  <span class="comment">// ],</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// A list of reporter names that Jest uses when writing coverage reports</span></span><br><span class="line">  <span class="comment">// coverageReporters: [</span></span><br><span class="line">  <span class="comment">//   "json",</span></span><br><span class="line">  <span class="comment">//   "text",</span></span><br><span class="line">  <span class="comment">//   "lcov",</span></span><br><span class="line">  <span class="comment">//   "clover"</span></span><br><span class="line">  <span class="comment">// ],</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// An object that configures minimum threshold enforcement for coverage results</span></span><br><span class="line">  <span class="comment">// coverageThreshold: null,</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// A path to a custom dependency extractor</span></span><br><span class="line">  <span class="comment">// dependencyExtractor: null,</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Make calling deprecated APIs throw helpful error messages</span></span><br><span class="line">  <span class="comment">// errorOnDeprecated: false,</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Force coverage collection from ignored files using an array of glob patterns</span></span><br><span class="line">  <span class="comment">// forceCoverageMatch: [],</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// A path to a module which exports an async function that is triggered once before all test suites</span></span><br><span class="line">  <span class="comment">// globalSetup: null,</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// A path to a module which exports an async function that is triggered once after all test suites</span></span><br><span class="line">  <span class="comment">// globalTeardown: null,</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// A set of global variables that need to be available in all test environments</span></span><br><span class="line">  <span class="comment">// globals: &#123;&#125;,</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// The maximum amount of workers used to run your tests. Can be specified as % or a number. E.g. maxWorkers: 10% will use 10% of your CPU amount + 1 as the maximum worker number. maxWorkers: 2 will use a maximum of 2 workers.</span></span><br><span class="line">  <span class="comment">// maxWorkers: "50%",</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// An array of directory names to be searched recursively up from the requiring module's location</span></span><br><span class="line">  <span class="comment">// moduleDirectories: [</span></span><br><span class="line">  <span class="comment">//   "node_modules"</span></span><br><span class="line">  <span class="comment">// ],</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// An array of file extensions your modules use</span></span><br><span class="line">  <span class="comment">// 模块使用文件扩展名数组，当你导入的文件没有扩展名的时候，它会在这个数组里面去自动匹配</span></span><br><span class="line">  <span class="comment">// moduleFileExtensions: [</span></span><br><span class="line">  <span class="comment">//   "js",</span></span><br><span class="line">  <span class="comment">//   "json",</span></span><br><span class="line">  <span class="comment">//   "jsx",</span></span><br><span class="line">  <span class="comment">//   "ts",</span></span><br><span class="line">  <span class="comment">//   "tsx",</span></span><br><span class="line">  <span class="comment">//   "node"</span></span><br><span class="line">  <span class="comment">// ],</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// A map from regular expressions to module names that allow to stub out resources with a single module</span></span><br><span class="line">  <span class="comment">// 模块名映射，类 webpack alias 以及 jsconfig.js 的 compilerOptions.paths</span></span><br><span class="line">  <span class="comment">// moduleNameMapper: &#123;&#125;,</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// An array of regexp pattern strings, matched against all module paths before considered 'visible' to the module loader</span></span><br><span class="line">  <span class="comment">// modulePathIgnorePatterns: [],</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Activates notifications for test results</span></span><br><span class="line">  <span class="comment">// notify: false,</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// An enum that specifies notification mode. Requires &#123; notify: true &#125;</span></span><br><span class="line">  <span class="comment">// notifyMode: "failure-change",</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// A preset that is used as a base for Jest's configuration</span></span><br><span class="line">  <span class="comment">// preset: null,</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Run tests from one or more projects</span></span><br><span class="line">  <span class="comment">// projects: null,</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Use this configuration option to add custom reporters to Jest</span></span><br><span class="line">  <span class="comment">// reporters: undefined,</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Automatically reset mock state between every test</span></span><br><span class="line">  <span class="comment">// resetMocks: false,</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Reset the module registry before running each individual test</span></span><br><span class="line">  <span class="comment">// resetModules: false,</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// A path to a custom resolver</span></span><br><span class="line">  <span class="comment">// resolver: null,</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Automatically restore mock state between every test</span></span><br><span class="line">  <span class="comment">// restoreMocks: false,</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// The root directory that Jest should scan for tests and modules within</span></span><br><span class="line">  <span class="comment">// rootDir: null,</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// A list of paths to directories that Jest should use to search for files in</span></span><br><span class="line">  <span class="comment">// roots: [</span></span><br><span class="line">  <span class="comment">//   "&lt;rootDir&gt;"</span></span><br><span class="line">  <span class="comment">// ],</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Allows you to use a custom runner instead of Jest's default test runner</span></span><br><span class="line">  <span class="comment">// runner: "jest-runner",</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// The paths to modules that run some code to configure or set up the testing environment before each test</span></span><br><span class="line">  <span class="comment">// setupFiles: [],</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// A list of paths to modules that run some code to configure or set up the testing framework before each test</span></span><br><span class="line">  <span class="comment">// 运行做测试的时候使用某些垫片为运行环境做兼容</span></span><br><span class="line">  <span class="comment">// setupFilesAfterEnv: [],</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// A list of paths to snapshot serializer modules Jest should use for snapshot testing</span></span><br><span class="line">  <span class="comment">// 快照格式化</span></span><br><span class="line">  <span class="comment">// snapshotSerializers: [],</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// The test environment that will be used for testing</span></span><br><span class="line">  <span class="comment">// testEnvironment: "jest-environment-jsdom",</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Options that will be passed to the testEnvironment</span></span><br><span class="line">  <span class="comment">// testEnvironmentOptions: &#123;&#125;,</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Adds a location field to test results</span></span><br><span class="line">  <span class="comment">// testLocationInResults: false,</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// The glob patterns Jest uses to detect test files</span></span><br><span class="line">  <span class="comment">// 匹配测试文件</span></span><br><span class="line">  <span class="comment">// testMatch: [</span></span><br><span class="line">  <span class="comment">//   "**/__tests__/**/*.[jt]s?(x)",</span></span><br><span class="line">  <span class="comment">//   "**/?(*.)+(spec|test).[tj]s?(x)"</span></span><br><span class="line">  <span class="comment">// ],</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// An array of regexp pattern strings that are matched against all test paths, matched tests are skipped</span></span><br><span class="line">  <span class="comment">// testPathIgnorePatterns: [</span></span><br><span class="line">  <span class="comment">//   "\\\\node_modules\\\\"</span></span><br><span class="line">  <span class="comment">// ],</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// The regexp pattern or array of patterns that Jest uses to detect test files</span></span><br><span class="line">  <span class="comment">// testRegex: [],</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// This option allows the use of a custom results processor</span></span><br><span class="line">  <span class="comment">// testResultsProcessor: null,</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// This option allows use of a custom test runner</span></span><br><span class="line">  <span class="comment">// testRunner: "jasmine2",</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// This option sets the URL for the jsdom environment. It is reflected in properties such as location.href</span></span><br><span class="line">  <span class="comment">// 模拟浏览器的地址</span></span><br><span class="line">  <span class="comment">// testURL: "http://localhost",</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Setting this value to "fake" allows the use of fake timers for functions such as "setTimeout"</span></span><br><span class="line">  <span class="comment">// timers: "real",</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// A map from regular expressions to paths to transformers</span></span><br><span class="line">  <span class="comment">// 不同文件类型对应不同的转换器</span></span><br><span class="line">  <span class="comment">// transform: null,</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// An array of regexp pattern strings that are matched against all source file paths, matched files will skip transformation</span></span><br><span class="line">  <span class="comment">// transformIgnorePatterns: [</span></span><br><span class="line">  <span class="comment">//   "\\\\node_modules\\\\"</span></span><br><span class="line">  <span class="comment">// ],</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// An array of regexp pattern strings that are matched against all modules before the module loader will automatically return a mock for them</span></span><br><span class="line">  <span class="comment">// unmockedModulePathPatterns: undefined,</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Indicates whether each individual test should be reported during the run</span></span><br><span class="line">  <span class="comment">// verbose: null,</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// An array of regexp patterns that are matched against all source file paths before re-running tests in watch mode</span></span><br><span class="line">  <span class="comment">// watchPathIgnorePatterns: [],</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Whether to use watchman for file crawling</span></span><br><span class="line">  <span class="comment">// watchman: true,</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="babelrc"><a href="#babelrc" class="headerlink" title="babelrc"></a>babelrc</h3><p>jest 未配置转换时，默认只支持 commonjs 语法。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"presets"</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">"@babel/preset-env"</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"targets"</span>: &#123;</span><br><span class="line">          <span class="attr">"node"</span>: <span class="string">"current"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>jest转换（commonjs -&gt; es module）大概工作原理：</p>
<ol>
<li>npm run jest</li>
<li>jest（babel-jest）jest 内部的</li>
<li>检测是有 babel-core</li>
<li>拿到 .babelrc 配置</li>
<li>再运行测试之前，结合 babel  把代码做一次转化</li>
<li>运行转化过的测试用例</li>
</ol>
<h2 id="常用匹配器（Matchers）"><a href="#常用匹配器（Matchers）" class="headerlink" title="常用匹配器（Matchers）"></a>常用匹配器（Matchers）</h2><h3 id="数字"><a href="#数字" class="headerlink" title="数字"></a>数字</h3><h4 id="toBe"><a href="#toBe" class="headerlink" title=".toBe()"></a>.toBe()</h4><h4 id="toEqual-value"><a href="#toEqual-value" class="headerlink" title=".toEqual(value)"></a>.toEqual(value)</h4><h4 id="toBeGreaterThan-number"><a href="#toBeGreaterThan-number" class="headerlink" title=".toBeGreaterThan(number)"></a>.toBeGreaterThan(number)</h4><h4 id="toBeGreaterThanOrEqual-number"><a href="#toBeGreaterThanOrEqual-number" class="headerlink" title=".toBeGreaterThanOrEqual(number)"></a>.toBeGreaterThanOrEqual(number)</h4><h4 id="toBeLessThan-number"><a href="#toBeLessThan-number" class="headerlink" title=".toBeLessThan(number)"></a>.toBeLessThan(number)</h4><h4 id="toBeLessThanOrEqual-number"><a href="#toBeLessThanOrEqual-number" class="headerlink" title=".toBeLessThanOrEqual(number)"></a>.toBeLessThanOrEqual(number)</h4><h4 id="toBeCloseTo-number-numDigits"><a href="#toBeCloseTo-number-numDigits" class="headerlink" title=".toBeCloseTo(number,numDigits?)"></a>.toBeCloseTo(number,numDigits?)</h4><p>第二个参数为精度，代表几位小数点，默认为2位</p>
<h4 id="toBeNaN"><a href="#toBeNaN" class="headerlink" title=".toBeNaN()"></a>.toBeNaN()</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数字相关</span></span><br><span class="line">test(<span class="string">'匹配器：toBe-数字相等'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="comment">// toBe 匹配器 matchers Object.is() ===</span></span><br><span class="line">  <span class="keyword">const</span> a = <span class="number">10</span></span><br><span class="line">  expect(a).toBe(<span class="number">10</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">test(<span class="string">'匹配器：toEqual-内容相等'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="comment">// toEqual 匹配器 matchers</span></span><br><span class="line">  <span class="keyword">const</span> a = &#123; <span class="attr">one</span>: <span class="number">1</span> &#125;</span><br><span class="line">  expect(a).toEqual(&#123; <span class="attr">one</span>: <span class="number">1</span> &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">test(<span class="string">'匹配器：toBeGreaterThan-大于比较数'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="comment">// toBeGreaterThan 匹配器 matchers</span></span><br><span class="line">  <span class="keyword">const</span> a = <span class="number">4</span></span><br><span class="line">  expect(a).toBeGreaterThan(<span class="number">3</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">test(<span class="string">'匹配器：toBeGreaterThanOrEqual-大于等于比较数'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="comment">// toBeGreaterThanOrEqual 匹配器 matchers</span></span><br><span class="line">  <span class="keyword">const</span> a = <span class="number">4</span></span><br><span class="line">  expect(a).toBeGreaterThanOrEqual(<span class="number">4</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">test(<span class="string">'匹配器：toBeLessThan-小于比较数'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="comment">// toBeLessThan 匹配器 matchers</span></span><br><span class="line">  <span class="keyword">const</span> a = <span class="number">4</span></span><br><span class="line">  expect(a).toBeLessThan(<span class="number">5</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">test(<span class="string">'匹配器：toBeLessThanOrEqual-小于等于比较数'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="comment">// toBeLessThanOrEqual 匹配器 matchers</span></span><br><span class="line">  <span class="keyword">const</span> a = <span class="number">4</span></span><br><span class="line">  expect(a).toBeLessThanOrEqual(<span class="number">4</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 浮点数</span></span><br><span class="line">test(<span class="string">'匹配器：toBeCloseTo-两个浮点数字相加'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="comment">// toBeCloseTo 匹配器 matchers</span></span><br><span class="line">  <span class="keyword">const</span> value = <span class="number">0.1</span> + <span class="number">0.2</span>;</span><br><span class="line">  <span class="comment">// expect(value).toBe(0.3);   这句会报错，因为浮点数有舍入误差</span></span><br><span class="line">  expect(value).toBeCloseTo(<span class="number">0.3</span>); <span class="comment">// 这句可以运行</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// NaN</span></span><br><span class="line">test(<span class="string">'匹配器：toBeNaN-等于NaN'</span>, () =&gt; &#123;</span><br><span class="line">  expect(<span class="literal">NaN</span>).toBeNaN();</span><br><span class="line">  expect(<span class="number">1</span>).not.toBeNaN();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="真假"><a href="#真假" class="headerlink" title="真假"></a>真假</h3><ul>
<li><code>toBeNull</code>只匹配 <code>null</code></li>
<li><code>toBeUndefined</code>只匹配 <code>undefined</code></li>
<li><code>toBeDefined</code> 与 <code>toBeUndefined</code>相反</li>
<li><code>toBeTruthy</code> 匹配任何 <code>if</code> 语句为真</li>
<li><code>toBeFalsy</code>匹配任何 <code>if</code> 语句为假</li>
</ul>
<h4 id="toBeNull"><a href="#toBeNull" class="headerlink" title=".toBeNull()"></a>.toBeNull()</h4><h4 id="toBeUndefined"><a href="#toBeUndefined" class="headerlink" title=".toBeUndefined()"></a>.toBeUndefined()</h4><h4 id="toBeDefined"><a href="#toBeDefined" class="headerlink" title=".toBeDefined()"></a>.toBeDefined()</h4><h4 id="toBeTruthy"><a href="#toBeTruthy" class="headerlink" title=".toBeTruthy()"></a>.toBeTruthy()</h4><h4 id="toBeFalsy"><a href="#toBeFalsy" class="headerlink" title=".toBeFalsy()"></a>.toBeFalsy()</h4><p>在JavaScript中，有六个falsy值：<code>false</code>，<code>0</code>，<code>&#39;&#39;</code>，<code>null</code>，<code>undefined</code>，和<code>NaN</code>。其他一切都是真实的。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 真假相关</span></span><br><span class="line">test(<span class="string">'匹配器：toBeNull-与null相等'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="comment">// toBeNull 匹配器 matchers</span></span><br><span class="line">  <span class="keyword">const</span> a = <span class="literal">null</span></span><br><span class="line">  expect(a).toBeNull()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">test(<span class="string">'匹配器：toBeUndefined-与undefined相等'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="comment">// toBeUndefined 匹配器 matchers</span></span><br><span class="line">  <span class="keyword">const</span> a = <span class="literal">undefined</span></span><br><span class="line">  expect(a).toBeUndefined()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">test(<span class="string">'匹配器：toBeDefined-被定义过的,非 undefined 的，可为 null'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="comment">// toBeDefined 匹配器 matchers</span></span><br><span class="line">  <span class="keyword">const</span> a = <span class="literal">null</span></span><br><span class="line">  expect(a).toBeDefined()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">test(<span class="string">'匹配器：toBeTruthy-真值或者隐藏为true的'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="comment">// toBeTruthy 匹配器 matchers</span></span><br><span class="line">  <span class="keyword">const</span> a = <span class="number">1</span></span><br><span class="line">  expect(a).toBeTruthy()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">test(<span class="string">'匹配器：toBeFalsy-真值或者隐藏为false的'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="comment">// toBeFalsy 匹配器 matchers</span></span><br><span class="line">  <span class="keyword">const</span> a = <span class="literal">null</span></span><br><span class="line">  expect(a).toBeFalsy()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="否定"><a href="#否定" class="headerlink" title="否定"></a>否定</h3><h4 id="not"><a href="#not" class="headerlink" title=".not"></a>.not</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">test(<span class="string">'匹配器：not-不是xx'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="comment">// not 匹配器 matchers</span></span><br><span class="line">  <span class="keyword">const</span> a = <span class="number">1</span></span><br><span class="line">  expect(a).not.toBeFalsy()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="expect-not-arrayContaining-array"><a href="#expect-not-arrayContaining-array" class="headerlink" title="expect.not.arrayContaining(array)"></a>expect.not.arrayContaining(array)</h4><p>匹配不是接收值的子集</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">describe(<span class="string">'not.arrayContaining'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> expected = [<span class="number">1</span>];</span><br><span class="line">  it(<span class="string">'如果接收的数组不包含1就通过测试'</span>, () =&gt; &#123;</span><br><span class="line">    expect([<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]).toEqual(</span><br><span class="line">      expect.not.arrayContaining(expected)</span><br><span class="line">    )</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="expect-not-objectContaining-object"><a href="#expect-not-objectContaining-object" class="headerlink" title="expect.not.objectContaining(object)"></a>expect.not.objectContaining(object)</h4><p>匹配不包含某个对象</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">describe(<span class="string">'not.objectContaining'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> expected = &#123; <span class="attr">haha</span>: <span class="string">'laibh.top'</span> &#125;;</span><br><span class="line">  it(<span class="string">'如果接收的对象不包含&#123; haha: laibh.top &#125;就通过测试'</span>, () =&gt; &#123;</span><br><span class="line">    expect(&#123; <span class="attr">haha</span>: <span class="string">'laibh.top1'</span> &#125;).toEqual(</span><br><span class="line">      expect.not.objectContaining(expected)</span><br><span class="line">    )</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="expect-not-stringContaining-string"><a href="#expect-not-stringContaining-string" class="headerlink" title="expect.not.stringContaining(string)"></a>expect.not.stringContaining(string)</h4><p>匹配不包含某个字符串</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">describe(<span class="string">'not.stringContaining'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> expected = <span class="string">'赖同学'</span>;</span><br><span class="line"></span><br><span class="line">  it(<span class="string">'如果接收的字符串不完全等于赖同学就通过测试'</span>, () =&gt; &#123;</span><br><span class="line">    expect(<span class="string">'赖'</span>).toEqual(expect.not.stringContaining(expected));</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="expect-not-stringMatching-string-regexp"><a href="#expect-not-stringMatching-string-regexp" class="headerlink" title="expect.not.stringMatching(string|regexp)"></a>expect.not.stringMatching(string|regexp)</h4><p>同上，不过参数可以是正则表达式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">describe(<span class="string">'not.stringMatching'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> expected = <span class="regexp">/赖同学/</span>;</span><br><span class="line"></span><br><span class="line">  it(<span class="string">'如果接收的字符串赖同学就通过测试'</span>, () =&gt; &#123;</span><br><span class="line">    expect(<span class="string">'赖'</span>).toEqual(expect.not.stringMatching(expected));</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h3><h4 id="toMatch-regexpOrString"><a href="#toMatch-regexpOrString" class="headerlink" title=".toMatch(regexpOrString)"></a>.toMatch(<code>regexpOrString</code>)</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 字符串</span></span><br><span class="line">test(<span class="string">'匹配器：toMatch-正则字符串匹配'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="comment">// toMatch 匹配器 matchers</span></span><br><span class="line">  <span class="keyword">const</span> str = <span class="string">'http://laibh.top'</span></span><br><span class="line">  expect(str).toMatch(<span class="string">'laibh'</span>)</span><br><span class="line">  <span class="comment">// 使用正则</span></span><br><span class="line">  expect(str).toMatch(<span class="regexp">/laibh/</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="expect-stringContaining-string"><a href="#expect-stringContaining-string" class="headerlink" title="expect.stringContaining(string)"></a>expect.stringContaining(string)</h4><p>匹配包含某个字符串</p>
<h4 id="expect-stringMatching-string-regexp"><a href="#expect-stringMatching-string-regexp" class="headerlink" title="expect.stringMatching(string|regexp)"></a>expect.stringMatching(string|regexp)</h4><p>匹配字符串，可用正则</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">describe(<span class="string">'stringMatching in arrayContaining'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> expected = [</span><br><span class="line">    expect.stringMatching(<span class="regexp">/^Alic/</span>),</span><br><span class="line">    expect.stringMatching(<span class="regexp">/^[BR]ob/</span>),</span><br><span class="line">  ];</span><br><span class="line">  it(<span class="string">'matches even if received contains additional elements'</span>, () =&gt; &#123;</span><br><span class="line">    expect([<span class="string">'Alicia'</span>, <span class="string">'Roberto'</span>, <span class="string">'Evelina'</span>]).toEqual(</span><br><span class="line">      expect.arrayContaining(expected),</span><br><span class="line">    );</span><br><span class="line">  &#125;);</span><br><span class="line">  it(<span class="string">'does not match if received does not contain expected elements'</span>, () =&gt; &#123;</span><br><span class="line">    expect([<span class="string">'Roberto'</span>, <span class="string">'Evelina'</span>]).not.toEqual(</span><br><span class="line">      expect.arrayContaining(expected),</span><br><span class="line">    );</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h3><h4 id="expect-toContain"><a href="#expect-toContain" class="headerlink" title="expect.toContain()"></a>expect.toContain()</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 数组</span></span><br><span class="line">test(<span class="string">'匹配器：toContain-数组包含某项'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="comment">// toContain 匹配器 matchers</span></span><br><span class="line">  <span class="keyword">const</span> arr = [<span class="string">'lai'</span>, <span class="string">'bin'</span>, <span class="string">'hong'</span>]</span><br><span class="line">  <span class="keyword">const</span> set = <span class="keyword">new</span> <span class="built_in">Set</span>(arr)</span><br><span class="line">  expect(set).toContain(<span class="string">'lai'</span>)</span><br><span class="line">  expect(arr).toContain(<span class="string">'lai'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="expect-arrayContaining-array"><a href="#expect-arrayContaining-array" class="headerlink" title="expect.arrayContaining(array)"></a>expect.arrayContaining(array)</h4><p>匹配子集</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">describe(<span class="string">'arrayContaining'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> expected = [<span class="string">'1'</span>, <span class="string">'2'</span>];</span><br><span class="line">  it(<span class="string">'即使接收值包含其他参数也匹配'</span>, () =&gt; &#123;</span><br><span class="line">    expect([<span class="string">'1'</span>, <span class="string">'2'</span>, <span class="string">'3'</span>]).toEqual(expect.arrayContaining(expected));</span><br><span class="line">  &#125;);</span><br><span class="line">  it(<span class="string">'只要接收值不包含期望的值就不匹配'</span>, () =&gt; &#123;</span><br><span class="line">    expect([<span class="string">'2'</span>, <span class="string">'4'</span>]).not.toEqual(expect.arrayContaining(expected));</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h3><h4 id="objectContaining-object"><a href="#objectContaining-object" class="headerlink" title="objectContaining(object)"></a>objectContaining(object)</h4><p>匹配任何递归预期属性的接收对象</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">test(<span class="string">'测试onPress函数回调参数匹配对象'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> onPress = jest.fn();</span><br><span class="line">  simulatePresses(onPress)</span><br><span class="line">  expect(onPress).toBeCalledWith(</span><br><span class="line">    expect.objectContaining(&#123;</span><br><span class="line">      x: expect.any(<span class="built_in">Number</span>),</span><br><span class="line">      y: expect.any(<span class="built_in">Number</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  )</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="toHaveProperty-keyPath-value"><a href="#toHaveProperty-keyPath-value" class="headerlink" title=".toHaveProperty(keyPath,value?)"></a>.toHaveProperty(keyPath,value?)</h4><p>检查对象中各种属性存在和值，第二个参数是可选的</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Object containing house features to be tested</span></span><br><span class="line"><span class="keyword">const</span> houseForSale = &#123;</span><br><span class="line">  bath: <span class="literal">true</span>,</span><br><span class="line">  bedrooms: <span class="number">4</span>,</span><br><span class="line">  kitchen: &#123;</span><br><span class="line">    amenities: [<span class="string">'oven'</span>, <span class="string">'stove'</span>, <span class="string">'washer'</span>],</span><br><span class="line">    area: <span class="number">20</span>,</span><br><span class="line">    wallColor: <span class="string">'white'</span>,</span><br><span class="line">    <span class="string">'nice.oven'</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">'ceiling.height'</span>: <span class="number">2</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">test(<span class="string">'this house has my desired features'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="comment">// Simple Referencing</span></span><br><span class="line">  expect(houseForSale).toHaveProperty(<span class="string">'bath'</span>);</span><br><span class="line">  expect(houseForSale).toHaveProperty(<span class="string">'bedrooms'</span>, <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">  expect(houseForSale).not.toHaveProperty(<span class="string">'pool'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 嵌套深层用 .</span></span><br><span class="line">  expect(houseForSale).toHaveProperty(<span class="string">'kitchen.area'</span>, <span class="number">20</span>);</span><br><span class="line">  expect(houseForSale).toHaveProperty(<span class="string">'kitchen.amenities'</span>, [</span><br><span class="line">    <span class="string">'oven'</span>,</span><br><span class="line">    <span class="string">'stove'</span>,</span><br><span class="line">    <span class="string">'washer'</span>,</span><br><span class="line">  ]);</span><br><span class="line"></span><br><span class="line">  expect(houseForSale).not.toHaveProperty(<span class="string">'kitchen.open'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 嵌套深层用 []</span></span><br><span class="line">  expect(houseForSale).toHaveProperty([<span class="string">'kitchen'</span>, <span class="string">'area'</span>], <span class="number">20</span>);</span><br><span class="line">  expect(houseForSale).toHaveProperty(</span><br><span class="line">    [<span class="string">'kitchen'</span>, <span class="string">'amenities'</span>],</span><br><span class="line">    [<span class="string">'oven'</span>, <span class="string">'stove'</span>, <span class="string">'washer'</span>],</span><br><span class="line">  );</span><br><span class="line">  expect(houseForSale).toHaveProperty([<span class="string">'kitchen'</span>, <span class="string">'amenities'</span>, <span class="number">0</span>], <span class="string">'oven'</span>);</span><br><span class="line">  expect(houseForSale).toHaveProperty([<span class="string">'kitchen'</span>, <span class="string">'nice.oven'</span>]);</span><br><span class="line">  expect(houseForSale).not.toHaveProperty([<span class="string">'kitchen'</span>, <span class="string">'open'</span>]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Referencing keys with dot in the key itself</span></span><br><span class="line">  expect(houseForSale).toHaveProperty([<span class="string">'ceiling.height'</span>], <span class="string">'tall'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="toMatchObject-object"><a href="#toMatchObject-object" class="headerlink" title=".toMatchObject(object)"></a>.toMatchObject(object)</h4><p>检查对象的属性的子集相匹配</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> houseForSale = &#123;</span><br><span class="line">  bath: <span class="literal">true</span>,</span><br><span class="line">  bedrooms: <span class="number">4</span>,</span><br><span class="line">  kitchen: &#123;</span><br><span class="line">    amenities: [<span class="string">'oven'</span>, <span class="string">'stove'</span>, <span class="string">'washer'</span>],</span><br><span class="line">    area: <span class="number">20</span>,</span><br><span class="line">    wallColor: <span class="string">'white'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> desiredHouse = &#123;</span><br><span class="line">  bath: <span class="literal">true</span>,</span><br><span class="line">  kitchen: &#123;</span><br><span class="line">    amenities: [<span class="string">'oven'</span>, <span class="string">'stove'</span>, <span class="string">'washer'</span>],</span><br><span class="line">    wallColor: expect.stringMatching(<span class="regexp">/white|yellow/</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">test(<span class="string">'the house has my desired features'</span>, () =&gt; &#123;</span><br><span class="line">  expect(houseForSale).toMatchObject(desiredHouse);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="类"><a href="#类" class="headerlink" title="类"></a>类</h3><h4 id="toBeInstanceOf-Class"><a href="#toBeInstanceOf-Class" class="headerlink" title=".toBeInstanceOf(Class)"></a>.toBeInstanceOf(Class)</h4><p>检查对象是一个类的实例</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">expect(<span class="keyword">new</span> A()).toBeInstanceOf(A);</span><br><span class="line">expect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;).toBeInstanceOf(<span class="built_in">Function</span>);</span><br><span class="line">expect(<span class="keyword">new</span> A()).toBeInstanceOf(<span class="built_in">Function</span>); <span class="comment">// throws</span></span><br></pre></td></tr></table></figure>
<h3 id="异常"><a href="#异常" class="headerlink" title="异常"></a>异常</h3><h4 id="toThrow-error"><a href="#toThrow-error" class="headerlink" title=".toThrow(error?)"></a>.toThrow(error?)</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> throwNewErrorFunc = <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'this is a new error'</span>) &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 异常</span></span><br><span class="line">test(<span class="string">'匹配器：toThrow-测试抛出异常'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="comment">// toThrow 匹配器 matchers</span></span><br><span class="line">  expect(throwNewErrorFunc).toThrow()</span><br><span class="line">  <span class="comment">// 测试抛出的内容</span></span><br><span class="line">  expect(throwNewErrorFunc).toThrow(<span class="string">'this is a new error'</span>)</span><br><span class="line">  <span class="comment">// 表达式也行</span></span><br><span class="line">  expect(throwNewErrorFunc).toThrow(<span class="regexp">/this is a new error/</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="任意"><a href="#任意" class="headerlink" title="任意"></a>任意</h3><h4 id="expect-anything"><a href="#expect-anything" class="headerlink" title="expect.anything()"></a>expect.anything()</h4><p>匹配除了 <code>null</code>、<code>undefined</code>的任意值，可以它使用在 <code>toEqual</code>或者 <code>toBeCalledWith</code>里面替代文字值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">test(<span class="string">'map 遍历一个非空的参数'</span>,()=&gt;&#123;</span><br><span class="line">    <span class="keyword">const</span> mock = jest.fn();</span><br><span class="line">    [<span class="number">1</span>].map(<span class="function"><span class="params">x</span> =&gt;</span> mock(x))</span><br><span class="line">    expect(mock).toBeCalledWith(expect.anything())</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="expect-any-constructor"><a href="#expect-any-constructor" class="headerlink" title="expect.any(constructor)"></a>expect.any(constructor)</h4><p>匹配任意构造器生成的实例</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">randocall</span>(<span class="params">fn</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> fn(<span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random()*<span class="number">6</span> + <span class="number">1</span>))</span><br><span class="line">&#125;</span><br><span class="line">test(<span class="string">'测试 randocall的回调函数调用了一个数字'</span>,()=&gt;&#123;</span><br><span class="line">    <span class="keyword">const</span> mock = jest.fn();</span><br><span class="line">    randocall(mock)</span><br><span class="line">    expect(mock).toBeCalledWith(expect.any(<span class="built_in">Number</span>))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="toHaveLength-number"><a href="#toHaveLength-number" class="headerlink" title=".toHaveLength(number)"></a>.toHaveLength(number)</h4><p>检查对象有个 length 属性并将设为某一数值。这对于检查数组或字符串大小特别有用。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">expect([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]).toHaveLength(<span class="number">3</span>);</span><br><span class="line">expect(<span class="string">'abc'</span>).toHaveLength(<span class="number">3</span>);</span><br><span class="line">expect(<span class="string">''</span>).not.toHaveLength(<span class="number">5</span>);</span><br></pre></td></tr></table></figure>
<h4 id="toContain-item"><a href="#toContain-item" class="headerlink" title=".toContain(item)"></a>.toContain(item)</h4><p>检查项目在数组或者字符串是否是另一个字符串的子串</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">test(<span class="string">'the flavor list contains lime'</span>, () =&gt; &#123;</span><br><span class="line">  expect(getAllFlavors()).toContain(<span class="string">'lime'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="toContainEqual-item"><a href="#toContainEqual-item" class="headerlink" title=".toContainEqual(item)"></a>.toContainEqual(item)</h4><p>检查具有特定结构和值的元素是否包含在数据中</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">'test contain'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> testValue = &#123; <span class="attr">bol</span>: <span class="literal">true</span> &#125;</span><br><span class="line">  expect([&#123; <span class="attr">bol</span>: <span class="literal">true</span> &#125;, &#123; <span class="attr">sour</span>: <span class="literal">false</span> &#125;]).toContainEqual(testValue)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="异步相关"><a href="#异步相关" class="headerlink" title="异步相关"></a>异步相关</h3><h4 id="expect-assertions"><a href="#expect-assertions" class="headerlink" title="expect.assertions()"></a>expect.assertions()</h4><p>匹配在测试用例里面使用断言的次数。确保在异步函数为了确保在回调函数里面断言被调用特别有用。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">test(<span class="string">'异步调用所有回调'</span>,()=&gt;&#123;</span><br><span class="line">    <span class="comment">// 确保有两个断言被调用</span></span><br><span class="line">    expect.assertions(<span class="number">2</span>)</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">callback1</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">        expect(data).toBeTruthy()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">callback2</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">        expect(data).toBeTruthy();</span><br><span class="line">    &#125;</span><br><span class="line">    doAsync(callback1,callback2)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="expect-hasAssertions"><a href="#expect-hasAssertions" class="headerlink" title="expect.hasAssertions()"></a>expect.hasAssertions()</h4><p>匹配在测试用例里面至少使用一次断言</p>
<h4 id="resolves"><a href="#resolves" class="headerlink" title=".resolves"></a>.resolves</h4><p>使用 <code>resolves</code>解开 fulfilled promise，如果 reject promise，则断言失败</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">test(<span class="string">'resolves to lemon'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="comment">// make sure to add a return statement</span></span><br><span class="line">  <span class="keyword">return</span> expect(<span class="built_in">Promise</span>.resolve(<span class="string">'lemon'</span>)).resolves.toBe(<span class="string">'lemon'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>测试是异步的，需要告诉 jest 等待返回解开的断言</p>
<p>也可以用 <code>async/await</code>结合 <code>.resolves</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">test(<span class="string">'resolves to lemon'</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">await</span> expect(<span class="built_in">Promise</span>.resolve(<span class="string">'lemon'</span>)).resolves.toBe(<span class="string">'lemon'</span>);</span><br><span class="line">  <span class="keyword">await</span> expect(<span class="built_in">Promise</span>.resolve(<span class="string">'lemon'</span>)).resolves.not.toBe(<span class="string">'octopus'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="rejects"><a href="#rejects" class="headerlink" title=".rejects"></a>.rejects</h4><p>使用 <code>rejects</code>解开 rejected  promise,如果 fulfilled promise,则断言失败</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">test(<span class="string">'rejects to octopus'</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="comment">// make sure to add a return statement</span></span><br><span class="line">  <span class="keyword">return</span> expect(<span class="built_in">Promise</span>.reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'octopus'</span>))).rejects.toThrow(<span class="string">'octopus'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>测试是异步的，需要告诉 jest 等待返回解开的断言</p>
<p>同样使用  <code>async/await</code>结合 <code>.rejects</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">test(<span class="string">'rejects to octopus'</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">await</span> expect(<span class="built_in">Promise</span>.reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'octopus'</span>))).rejects.toThrow(<span class="string">'octopus'</span>);</span><br><span class="line">  <span class="keyword">await</span> expect(<span class="built_in">Promise</span>.reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'octopus'</span>))).rejects.not.toThrow(<span class="string">'lemon'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="函数调用"><a href="#函数调用" class="headerlink" title="函数调用"></a>函数调用</h3><h4 id="toHaveBeenCalled-toBeCalled"><a href="#toHaveBeenCalled-toBeCalled" class="headerlink" title=".toHaveBeenCalled()|.toBeCalled()"></a>.toHaveBeenCalled()|.toBeCalled()</h4><p>确保模拟功能得到调用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drinkAll</span>(<span class="params">cb, flavour</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (flavour !== <span class="string">'octopus'</span>) &#123;</span><br><span class="line">    cb(flavour)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'test drinkAll function'</span>, () =&gt; &#123;</span><br><span class="line">  test(<span class="string">'drink somthing lemon-flavour'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> drink = jest.fn();</span><br><span class="line">    drinkAll(drink, <span class="string">'lemon'</span>)</span><br><span class="line">    expect(drink).toBeCalled();</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'test drinkAll function'</span>, () =&gt; &#123;</span><br><span class="line">  test(<span class="string">'does not drink somthing octopus-flavour'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> drink = jest.fn();</span><br><span class="line">    drinkAll(drink, <span class="string">'octopus'</span>)</span><br><span class="line">    expect(drink).not.toBeCalled();</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'test drinkAll function'</span>, () =&gt; &#123;</span><br><span class="line">  test(<span class="string">'drink somthing lemon-flavour'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> drink = jest.fn();</span><br><span class="line">    drinkAll(drink, <span class="string">'lemon'</span>)</span><br><span class="line">    expect(drink).toHaveBeenCalled();</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'test drinkAll function'</span>, () =&gt; &#123;</span><br><span class="line">  test(<span class="string">'does not drink somthing octopus-flavour'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> drink = jest.fn();</span><br><span class="line">    drinkAll(drink, <span class="string">'octopus'</span>)</span><br><span class="line">    expect(drink).not.toHaveBeenCalled();</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="toHaveBeenCallTimes-number-toBeCalledTimes-number"><a href="#toHaveBeenCallTimes-number-toBeCalledTimes-number" class="headerlink" title=".toHaveBeenCallTimes(number)|.toBeCalledTimes(number)"></a>.toHaveBeenCallTimes(number)|.toBeCalledTimes(number)</h4><p>确保模拟功能得到调用次数与指定数字一致</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">test(<span class="string">'drinkEach drinks each drink'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> drink = jest.fn();</span><br><span class="line">  drinkEach(drink, [<span class="string">'lemon'</span>, <span class="string">'octopus'</span>]);</span><br><span class="line">  expect(drink).toHaveBeenCalledTimes(<span class="number">2</span>);</span><br><span class="line">  expect(drink).toBeCalledTimes(<span class="number">2</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="toHaveBeenCalledWith-arg1-arg2-…-toBeCalledWith-arg1-arg2-…"><a href="#toHaveBeenCalledWith-arg1-arg2-…-toBeCalledWith-arg1-arg2-…" class="headerlink" title=".toHaveBeenCalledWith(arg1,arg2,…)|.toBeCalledWith(arg1,arg2,…)"></a>.toHaveBeenCalledWith(arg1,arg2,…)|.toBeCalledWith(arg1,arg2,…)</h4><p>确保模拟功能被调用的具体参数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">calledWithArg</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  cb(<span class="string">'Arg'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test(<span class="string">'test calledWithArg'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> fn = jest.fn();</span><br><span class="line">  calledWithArg(fn);</span><br><span class="line">  expect(fn).toBeCalledWith(<span class="string">'Arg'</span>);</span><br><span class="line">  expect(fn).toHaveBeenCalledWith(<span class="string">'Arg'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="toHaveBeenLastCalledWith-arg1-arg2-…-lastCalledWith-arg1-arg2-…"><a href="#toHaveBeenLastCalledWith-arg1-arg2-…-lastCalledWith-arg1-arg2-…" class="headerlink" title=".toHaveBeenLastCalledWith(arg1,arg2,…)|.lastCalledWith(arg1, arg2, …)"></a>.toHaveBeenLastCalledWith(arg1,arg2,…)|.lastCalledWith(arg1, arg2, …)</h4><p>确保模拟功能被最后一次调用的具体参数</p>
<h4 id="toHaveBeenNthCalledWith-nthCall-arg1-arg2-…-nthCalledWith-nthCall-arg1-arg2-…"><a href="#toHaveBeenNthCalledWith-nthCall-arg1-arg2-…-nthCalledWith-nthCall-arg1-arg2-…" class="headerlink" title=".toHaveBeenNthCalledWith(nthCall, arg1, arg2, ….)|.nthCalledWith(nthCall, arg1, arg2, ….)"></a>.toHaveBeenNthCalledWith(nthCall, arg1, arg2, ….)|.nthCalledWith(nthCall, arg1, arg2, ….)</h4><p>确保模拟功能多次调用的顺序</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">test(<span class="string">'drinkEach drinks each drink'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> drink = jest.fn();</span><br><span class="line">  drinkEach(drink, [<span class="string">'lemon'</span>, <span class="string">'octopus'</span>]);</span><br><span class="line">  expect(drink).toHaveBeenNthCalledWith(<span class="number">1</span>, <span class="string">'lemon'</span>);</span><br><span class="line">  expect(drink).toHaveBeenNthCalledWith(<span class="number">2</span>, <span class="string">'octopus'</span>);</span><br><span class="line">  expect(drink).nthCalledWith(<span class="number">1</span>, <span class="string">'lemon'</span>);</span><br><span class="line">  expect(drink).nthCalledWith(<span class="number">2</span>, <span class="string">'octopus'</span>);    </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>n 必须是从 1开始的正整数</p>
<h4 id="toHaveReturned-toReturn"><a href="#toHaveReturned-toReturn" class="headerlink" title=".toHaveReturned()|.toReturn()"></a>.toHaveReturned()|.toReturn()</h4><p>测试模拟函数成功返回(即没有抛出错误)至少一次</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">test(<span class="string">'test calledWithArg'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> fn = jest.fn();</span><br><span class="line">  calledWithArg(fn);</span><br><span class="line">  expect(fn).toHaveReturned();</span><br><span class="line">  expect(fn).toReturn();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="toHaveReturnedTimes-number-toReturnTimes-number"><a href="#toHaveReturnedTimes-number-toReturnTimes-number" class="headerlink" title=".toHaveReturnedTimes(number)|.toReturnTimes(number)"></a>.toHaveReturnedTimes(number)|.toReturnTimes(number)</h4><p>确保模拟函数返回成功的次数,抛出错误的模拟函数的任何调用都不计入函数返回的次数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">test(<span class="string">'drink returns twice'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> drink = jest.fn(<span class="function"><span class="params">()</span> =&gt;</span> <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">  drink();</span><br><span class="line">  drink();</span><br><span class="line"></span><br><span class="line">  expect(drink).toHaveReturnedTimes(<span class="number">2</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="toHaveReturnedWith-value-toReturnWith-value"><a href="#toHaveReturnedWith-value-toReturnWith-value" class="headerlink" title=".toHaveReturnedWith(value)|.toReturnWith(value)"></a>.toHaveReturnedWith(value)|.toReturnWith(value)</h4><p>确保模拟函数返回特定的值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">test(<span class="string">'test Return 123'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> fn = jest.fn(<span class="function"><span class="params">()</span> =&gt;</span> <span class="number">123</span>);</span><br><span class="line">  calledWithArg(fn);</span><br><span class="line">  expect(fn).toHaveReturnedWith(<span class="number">123</span>)</span><br><span class="line">  expect(fn).toReturnWith(<span class="number">123</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="toHaveLastReturnedWith-value-lastReturnedWith-value"><a href="#toHaveLastReturnedWith-value-lastReturnedWith-value" class="headerlink" title=".toHaveLastReturnedWith(value)|.lastReturnedWith(value)"></a>.toHaveLastReturnedWith(value)|.lastReturnedWith(value)</h4><p>确保模拟函数最后一次返回特定的值</p>
<h4 id="toHaveNthReturnedWith-nthCall-value-nthReturnedWith-nthCall-value"><a href="#toHaveNthReturnedWith-nthCall-value-nthReturnedWith-nthCall-value" class="headerlink" title=".toHaveNthReturnedWith(nthCall, value)|.nthReturnedWith(nthCall, value)"></a>.toHaveNthReturnedWith(nthCall, value)|.nthReturnedWith(nthCall, value)</h4><p>确保模拟函数第n次调用返回特定的值</p>
<p>第n个参数必须是从1开始的正整数。</p>
<h3 id="自定义扩展"><a href="#自定义扩展" class="headerlink" title="自定义扩展"></a>自定义扩展</h3><h4 id="expect-extend"><a href="#expect-extend" class="headerlink" title="expect.extend()"></a>expect.extend()</h4><p><code>pass</code>表示是否有匹配，<code>message</code>提供一个没有参数的函数，在出现错误的情况下返回消息。当<code>pass:false</code>，<code>message</code>返回 <code>expect(x).matcher()</code>失败的错误信息，<code>pass:true</code>，<code>message</code>返回当<code>expect(x).not.matcher()</code>失败时的错误消息</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// expect.extend(matchers)</span></span><br><span class="line">expect.extend(&#123;</span><br><span class="line">  toBeWithinRange(reveived, floor, ceiling) &#123;</span><br><span class="line">    <span class="keyword">const</span> pass = reveived &gt;= floor &amp;&amp; reveived &lt;= ceiling;</span><br><span class="line">    <span class="keyword">if</span> (pass) &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        message: <span class="function"><span class="params">()</span> =&gt;</span> <span class="string">`期待 <span class="subst">$&#123;reveived&#125;</span> 不在范围<span class="subst">$&#123;floor&#125;</span>-<span class="subst">$&#123;ceiling&#125;</span>内`</span>,</span><br><span class="line">        pass,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        message: <span class="function"><span class="params">()</span> =&gt;</span> <span class="string">`期待 <span class="subst">$&#123;reveived&#125;</span> 在范围<span class="subst">$&#123;floor&#125;</span>-<span class="subst">$&#123;ceiling&#125;</span>内`</span>,</span><br><span class="line">        pass,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">test(<span class="string">'测试范围'</span>, () =&gt; &#123;</span><br><span class="line">  expect(<span class="number">100</span>).toBeWithinRange(<span class="number">90</span>, <span class="number">100</span>)</span><br><span class="line">  expect(<span class="number">101</span>).not.toBeWithinRange(<span class="number">0</span>, <span class="number">100</span>)</span><br><span class="line">  expect(&#123; <span class="attr">apples</span>: <span class="number">6</span>, <span class="attr">bananas</span>: <span class="number">3</span> &#125;).toEqual(&#123;</span><br><span class="line">    apples: expect.toBeWithinRange(<span class="number">1</span>, <span class="number">10</span>),</span><br><span class="line">    bananas: expect.not.toBeWithinRange(<span class="number">11</span>, <span class="number">20</span>),</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>异步扩展,需要结合 <code>async</code>和 <code>await</code>函数来使用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">expect.extend(&#123;</span><br><span class="line">    <span class="keyword">async</span> toBeDivisibleByExternalValue(reveived)&#123;</span><br><span class="line">        <span class="comment">// 异步获取的除数</span></span><br><span class="line">        <span class="keyword">const</span> externalValue = <span class="keyword">await</span> getExternalValueFromRemoteSource();</span><br><span class="line">        <span class="keyword">const</span> pass = received % externalValue == <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(pass)&#123;</span><br><span class="line">            <span class="keyword">return</span>&#123;</span><br><span class="line">                message:<span class="function"><span class="params">()</span>=&gt;</span><span class="string">`期待<span class="subst">$&#123;received&#125;</span>不被<span class="subst">$&#123;externalValue&#125;</span>整除`</span>,</span><br><span class="line">                pass</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span>&#123;</span><br><span class="line">                message:<span class="function"><span class="params">()</span>=&gt;</span><span class="string">`期待<span class="subst">$&#123;received&#125;</span>被<span class="subst">$&#123;externalValue&#125;</span>整除`</span>,</span><br><span class="line">                pass</span><br><span class="line">            &#125;            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><a href="https://jestjs.io/docs/zh-Hans/expect">更多</a></p>
<h3 id="测试异步代码"><a href="#测试异步代码" class="headerlink" title="测试异步代码"></a>测试异步代码</h3><p>回调形式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fetchData.js</span></span><br><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">'@/utils/request'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fetchData = <span class="function">(<span class="params">cb</span>) =&gt;</span> &#123;</span><br><span class="line">  request(<span class="string">'http://www.dell-lee.com/react/api/demo.json'</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (res.data) cb(res.data)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> fetchData</span><br><span class="line"><span class="comment">// fetchData.test.js</span></span><br><span class="line"><span class="keyword">import</span> fetchData <span class="keyword">from</span> <span class="string">'./fetchData'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 错误</span></span><br><span class="line">test(<span class="string">'fetch 返回结果为 &#123;success: true&#125;'</span>, () =&gt; &#123;</span><br><span class="line">  fetchData(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    expect(data).toEqual(&#123;</span><br><span class="line">      success: <span class="literal">true</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 回调类型异步函数</span></span><br><span class="line">test(<span class="string">'fetch 返回结果为 &#123;success: true&#125;'</span>, (done) =&gt; &#123;</span><br><span class="line">  fetchData(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    expect(data).toEqual(&#123;</span><br><span class="line">      success: <span class="literal">true</span></span><br><span class="line">    &#125;)</span><br><span class="line">    done();</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Promise</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fetchData.js</span></span><br><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">'@/utils/request'</span>;</span><br><span class="line"><span class="keyword">const</span> fetchData = <span class="function"><span class="params">()</span> =&gt;</span> request(<span class="string">'http://www.dell-lee.com/react/api/demo.json'</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> fetchData</span><br><span class="line"></span><br><span class="line"><span class="comment">//fetchData.test.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> fetchData <span class="keyword">from</span> <span class="string">'./fetchData'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Promise</span></span><br><span class="line">test(<span class="string">'fetch 返回结果为 &#123;success: true&#125;'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> fetchData().then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    expect(res.data).toEqual(&#123; <span class="attr">success</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 测试404</span></span><br><span class="line">test(<span class="string">'fetchData 返回结果为404'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="comment">// 要求至少跑一次 expect</span></span><br><span class="line">  expect.assertions(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">return</span> fetchData().catch(<span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">    expect(e.toString().indexOf(<span class="string">'404'</span>) &gt; <span class="number">-1</span>).toBe(<span class="literal">true</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// .resolves / .rejects</span></span><br><span class="line">test(<span class="string">'fetch 返回结果为 &#123;success: true&#125;'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> expect(fetchData()).resolves.toMatchObject(&#123;</span><br><span class="line">    data: &#123;</span><br><span class="line">      success: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">test(<span class="string">'fetchData 返回结果为404'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> expect(fetchData()).rejects.toThrow()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Async/Await</span></span><br><span class="line">test(<span class="string">'fetch 返回结果为 &#123;success: true&#125;'</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">await</span> expect(fetchData()).resolves.toMatchObject(&#123;</span><br><span class="line">    data: &#123;</span><br><span class="line">      success: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">test(<span class="string">'fetchData 返回结果为404'</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">await</span> expect(fetchData()).rejects.toThrow()</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 另一种 Async/Await</span></span><br><span class="line">test(<span class="string">'fetch 返回结果为 &#123;success: true&#125;'</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> fetchData()</span><br><span class="line">  expect(res.data).toEqual(&#123;</span><br><span class="line">    success: <span class="literal">true</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">test(<span class="string">'fetchData 返回结果为404'</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  expect.assertions(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> fetchData()</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="keyword">await</span> expect(e.toString()).toEqual(<span class="string">'Error: Request failed with status code 404'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="钩子函数"><a href="#钩子函数" class="headerlink" title="钩子函数"></a>钩子函数</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Couter.js</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.number = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  addOne() &#123;</span><br><span class="line">    <span class="keyword">this</span>.number += <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  addTwo() &#123;</span><br><span class="line">    <span class="keyword">this</span>.number += <span class="number">2</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  minusOne() &#123;</span><br><span class="line">    <span class="keyword">this</span>.number -= <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  minusTwo() &#123;</span><br><span class="line">    <span class="keyword">this</span>.number -= <span class="number">2</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Counter;</span><br><span class="line"><span class="comment">// Couter.test.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Counter <span class="keyword">from</span> <span class="string">'./Couter'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">describe(<span class="string">'测试 Counter'</span>,()=&gt;&#123;</span><br><span class="line">  <span class="keyword">let</span> couter;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 所有测试开始之前</span></span><br><span class="line">  beforeAll(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    couter = <span class="keyword">new</span> Counter();</span><br><span class="line">  &#125;)</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 每个测试用例开始之前</span></span><br><span class="line">  beforeEach(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">// 每次测试都会生成一个新的 couter</span></span><br><span class="line">    couter = <span class="keyword">new</span> Counter();</span><br><span class="line">  &#125;)</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 每个测试用例结束之后</span></span><br><span class="line">  afterEach(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">  </span><br><span class="line">  &#125;)</span><br><span class="line">    </span><br><span class="line">  <span class="comment">// 所有测试结束之后</span></span><br><span class="line">  afterAll(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">  </span><br><span class="line">  &#125;)</span><br><span class="line">  </span><br><span class="line">  describe(<span class="string">'测试增加相关代码'</span>,()=&gt;&#123;</span><br><span class="line">    test(<span class="string">'测试 Conter 中的 addOne 方法'</span>, () =&gt; &#123;</span><br><span class="line">      couter.addOne();</span><br><span class="line">      expect(couter.number).toBe(<span class="number">1</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    test(<span class="string">'测试 Conter 中的 addTwo 方法'</span>, () =&gt; &#123;</span><br><span class="line">      couter.addTwo();</span><br><span class="line">      expect(couter.number).toBe(<span class="number">2</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  </span><br><span class="line">  describe(<span class="string">'测试减少相关代码'</span>,()=&gt;&#123;</span><br><span class="line">    test(<span class="string">'测试 Conter 中的 minusOne 方法'</span>, () =&gt; &#123;</span><br><span class="line">      couter.minusOne();</span><br><span class="line">      expect(couter.number).toBe(<span class="number">-1</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  </span><br><span class="line">    test(<span class="string">'测试 Conter 中的 minusTwo 方法'</span>, () =&gt; &#123;</span><br><span class="line">      couter.minusTwo();</span><br><span class="line">      expect(couter.number).toBe(<span class="number">-2</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>describe 里面就是一个作用域，嵌套作用域可以有多个钩子函数，钩子函数执行顺序由外到内</p>
<p><code>test.only</code>，只执行某个测试用例</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">describe(<span class="string">'测试减少相关代码'</span>,()=&gt;&#123;</span><br><span class="line">  test.only(<span class="string">'测试 Conter 中的 minusOne 方法'</span>, () =&gt; &#123;</span><br><span class="line">    couter.minusOne();</span><br><span class="line">    expect(couter.number).toBe(<span class="number">-1</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  test(<span class="string">'测试 Conter 中的 minusTwo 方法'</span>, () =&gt; &#123;</span><br><span class="line">    couter.minusTwo();</span><br><span class="line">    expect(couter.number).toBe(<span class="number">-2</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="Mock"><a href="#Mock" class="headerlink" title="Mock"></a>Mock</h3><ol>
<li>捕获函数的调用，this 指向，调用顺序</li>
<li>自由设置返回结果</li>
<li>改变内部函数的实现</li>
</ol>
<h4 id="基本模拟-导入函数"><a href="#基本模拟-导入函数" class="headerlink" title="基本模拟-导入函数"></a>基本模拟-导入函数</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// demo</span></span><br><span class="line"><span class="keyword">const</span> runCallback = <span class="function">(<span class="params">cb</span>) =&gt;</span> &#123;</span><br><span class="line">  cb();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> runCallback</span><br><span class="line"></span><br><span class="line"><span class="comment">//demo.test.js</span></span><br><span class="line"><span class="keyword">import</span> runCallback <span class="keyword">from</span> <span class="string">'./demo'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">describe(<span class="string">'测试 runCallback 方法'</span>, () =&gt; &#123;</span><br><span class="line">  test(<span class="string">'runCallback被调用,并只调用了一次'</span>,()=&gt;&#123;</span><br><span class="line">    <span class="comment">// mock 函数，捕获函数的调用</span></span><br><span class="line">    <span class="keyword">const</span> func = jest.fn();</span><br><span class="line">    <span class="comment">// 方法返回一次 值 Haha，mockReturnValue则是都返回，也可以在 jest.fn(()=&gt;&#123;return 'Haha'&#125;)定义</span></span><br><span class="line">    func.mockReturnValueOnce(<span class="string">'Haha'</span>)</span><br><span class="line">    runCallback(func)</span><br><span class="line">    expect(func).toBeCalled()</span><br><span class="line">    expect(func.mock.calls.length).toBe(<span class="number">1</span>)</span><br><span class="line">    expect(func.mock.results[<span class="number">0</span>].value).toBe(<span class="string">'Haha'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(func.mock)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  ● Console</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    console.log src/lesson2/demo.test.js:14</span></span><br><span class="line"><span class="comment">      &#123; calls: [ [] ],</span></span><br><span class="line"><span class="comment">        instances: [ undefined ],</span></span><br><span class="line"><span class="comment">        invocationCallOrder: [ 1 ],</span></span><br><span class="line"><span class="comment">        results: [ &#123; type: 'return', value: 'Haha' &#125; ] &#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h4 id="修改原来函数的返回"><a href="#修改原来函数的返回" class="headerlink" title="修改原来函数的返回"></a>修改原来函数的返回</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// xx.js</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fetchData = <span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    axios.get(<span class="string">'/'</span>).then(<span class="function"><span class="params">res</span>=&gt;</span>res.data)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// (function()&#123;return '123' &#125;)()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> fetchData;</span><br><span class="line"><span class="comment">// xx.test.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> fetchData <span class="keyword">from</span> <span class="string">'./xx.js'</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"></span><br><span class="line">ject.mock(<span class="string">'axios'</span>)</span><br><span class="line"></span><br><span class="line">test(<span class="string">'fetchData 测试'</span>,()=&gt;&#123;</span><br><span class="line">    axios.get.mockResolvedValue(&#123;</span><br><span class="line">        data:<span class="string">"(function()&#123;return '123' &#125;)()"</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> fetchData().then(<span class="function"><span class="params">data</span>=&gt;</span>&#123;</span><br><span class="line">        expect(<span class="built_in">eval</span>(data)).toEqual(<span class="string">'123'</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="mocks-文件夹"><a href="#mocks-文件夹" class="headerlink" title="__mocks__文件夹"></a><code>__mocks__</code>文件夹</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// __mock__/xx.js</span></span><br><span class="line"><span class="keyword">const</span> fetchData = <span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolved,reject</span>)=&gt;</span>&#123;</span><br><span class="line">        resolve(<span class="string">"(function()&#123;return '123' &#125;)()"</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接着改测试，模拟函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// xx.test.js</span></span><br><span class="line">jest.mock(<span class="string">'./xx'</span>)</span><br><span class="line"><span class="keyword">import</span> fetchData <span class="keyword">from</span> <span class="string">'./xx.js'</span></span><br><span class="line"></span><br><span class="line">test(<span class="string">'fetchData 测试'</span>,()=&gt;&#123;</span><br><span class="line">    axios.get.mockResolvedValue(&#123;</span><br><span class="line">        data:<span class="string">"(function()&#123;return '123' &#125;)()"</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> fetchData().then(<span class="function"><span class="params">data</span>=&gt;</span>&#123;</span><br><span class="line">        expect(<span class="built_in">eval</span>(data)).toEqual(<span class="string">'123'</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>上述函数顶部那步模拟也可以通过在 jest.config.js 中修改配置 <code>automock：true</code> 改为自动模拟，那么引入对应的函数的时候就会自动去 <code>__mocks__</code>文件夹里面去寻找对应的模拟函数。注意一旦开启这个配置，需要启动才会生效，另外也会导致很多测试需要重新修改。</p>
<h4 id="同时存在-mocks-以及导入函数"><a href="#同时存在-mocks-以及导入函数" class="headerlink" title="同时存在__mocks__以及导入函数"></a>同时存在<code>__mocks__</code>以及导入函数</h4><p>在原来 xx.js 基础上面新增 一个 <code>getNumber</code>函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">xx.js</span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fetchData = <span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    axios.get(<span class="string">'/'</span>).then(<span class="function"><span class="params">res</span>=&gt;</span>res.data)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// (function()&#123;return '123' &#125;)()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getNumber = <span class="function"><span class="params">()</span>=&gt;</span> <span class="number">123</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">	fetchData,</span><br><span class="line">    getNumber</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>接着修改测试用例</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// xx.test.js</span></span><br><span class="line">jest.mock(<span class="string">'./xx'</span>)</span><br><span class="line"><span class="keyword">import</span> fetchData <span class="keyword">from</span> <span class="string">'./xx.js'</span></span><br><span class="line"></span><br><span class="line">test(<span class="string">'fetchData 测试'</span>,()=&gt;&#123;</span><br><span class="line">    axios.get.mockResolvedValue(&#123;</span><br><span class="line">        data:<span class="string">"(function()&#123;return '123' &#125;)()"</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> fetchData().then(<span class="function"><span class="params">data</span>=&gt;</span>&#123;</span><br><span class="line">        expect(<span class="built_in">eval</span>(data)).toEqual(<span class="string">'123'</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">test(<span class="string">'getNumber 测试'</span>,()=&gt;&#123;</span><br><span class="line">	expect(getNumber()).toBe(<span class="number">123</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>上述代码会报错，<code>getNumebr</code> 找不到对应的函数，因为测试用例还是会去<code>__mocks__</code> 文件夹去寻找 <code>getNumber</code>。但是我们只希望模拟异步的函数，对于同步函数希望通过导入的方式来测试，那么就从原来的js文件中导入 <code>getNumber</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// xx.test.js</span></span><br><span class="line">jest.mock(<span class="string">'./xx'</span>)</span><br><span class="line"><span class="keyword">import</span> fetchData <span class="keyword">from</span> <span class="string">'./xx.js'</span></span><br><span class="line"><span class="keyword">const</span> &#123; getNumber &#125; = jest.requireActual(<span class="string">'./xx'</span>)</span><br><span class="line">test(<span class="string">'fetchData 测试'</span>,()=&gt;&#123;</span><br><span class="line">    axios.get.mockResolvedValue(&#123;</span><br><span class="line">        data:<span class="string">"(function()&#123;return '123' &#125;)()"</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> fetchData().then(<span class="function"><span class="params">data</span>=&gt;</span>&#123;</span><br><span class="line">        expect(<span class="built_in">eval</span>(data)).toEqual(<span class="string">'123'</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">test(<span class="string">'getNumber 测试'</span>,()=&gt;&#123;</span><br><span class="line">	expect(getNumber()).toBe(<span class="number">123</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="Mock-Timer"><a href="#Mock-Timer" class="headerlink" title="Mock Timer"></a>Mock Timer</h3><p>写一个 setTimeout 函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// timer.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (cb)=&gt;&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    cb()</span><br><span class="line">  &#125;,<span class="number">3000</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试用例</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// timer.test.js</span></span><br><span class="line"><span class="keyword">import</span> timer <span class="keyword">from</span> <span class="string">'./timer'</span></span><br><span class="line"></span><br><span class="line">test(<span class="string">'timer 测试'</span>,(done)=&gt;&#123;</span><br><span class="line">  timer(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    expect(<span class="number">2</span>).toBe(<span class="number">1</span>)</span><br><span class="line">    done();</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>上面的测试用例会直接通过， <code>timer</code>是一个异步函数，并不会执行函数体内的内容，需要像之前的异步函数一样，加个 done 参数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> timer <span class="keyword">from</span> <span class="string">'./timer'</span></span><br><span class="line"></span><br><span class="line">test(<span class="string">'timer 测试'</span>,(done)=&gt;&#123;</span><br><span class="line">  timer(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    expect(<span class="number">2</span>).toBe(<span class="number">1</span>)</span><br><span class="line">    done();</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>接着测试用例便会运行，并报错</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">FAIL  src/lesson3/timer.test.js (7.997s)</span><br><span class="line"> ● Console</span><br><span class="line"></span><br><span class="line">   console.error node_modules/_jsdom@11.12.0@jsdom/lib/jsdom/virtual-console.js:29</span><br><span class="line">     Error: Uncaught [Error: expect(received).toBe(expected) // Object.is equality</span><br><span class="line">     </span><br><span class="line">     Expected: 1</span><br><span class="line">     Received: 2]</span><br><span class="line">         at reportException (F:\赖彬鸿\git-project\usual\Egret-Project\FontendTest\node_modules\_jsdom@11.12.0@jsdom\lib\jsdom\living\helpers\runtime-script-errors.js:66:24)</span><br><span class="line">         at Timeout.callback [as _onTimeout] (F:\赖彬鸿\git-project\usual\Egret-Project\FontendTest\node_modules\_jsdom@11.12.0@jsdom\lib\jsdom\browser\Window.js:680:7)</span><br><span class="line">         at ontimeout (timers.js:436:11)</span><br><span class="line">         at tryOnTimeout (timers.js:300:5)</span><br><span class="line">         at listOnTimeout (timers.js:263:5)</span><br><span class="line">         at Timer.processTimers (timers.js:223:10) &#123; Error: expect(received).toBe(expected) // Object.is equality</span><br><span class="line">     </span><br><span class="line">     Expected: 1</span><br><span class="line">     Received: 2</span><br><span class="line">         at toBe (F:\赖彬鸿\git-project\usual\Egret-Project\FontendTest\src\lesson3\timer.test.js:5:15)</span><br><span class="line">         at cb (F:\赖彬鸿\git-project\usual\Egret-Project\FontendTest\src\lesson3\timer.js:3:5)</span><br><span class="line">         at Timeout.callback [as _onTimeout] (F:\赖彬鸿\git-project\usual\Egret-Project\FontendTest\node_modules\_jsdom@11.12.0@jsdom\lib\jsdom\browser\Window.js:678:19)</span><br><span class="line">         at ontimeout (timers.js:436:11)</span><br><span class="line">         at tryOnTimeout (timers.js:300:5)</span><br><span class="line">         at listOnTimeout (timers.js:263:5)</span><br><span class="line">         at Timer.processTimers (timers.js:223:10)</span><br><span class="line">       matcherResult:</span><br><span class="line">        &#123; actual: 2,</span><br><span class="line">          expected: 1,</span><br><span class="line">          message: [Function],</span><br><span class="line">          name: 'toBe',</span><br><span class="line">          pass: false &#125; &#125;</span><br></pre></td></tr></table></figure>
<p>也可以通过模拟 timer 这类异步函数，来达到目的</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// timer.test.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> timer <span class="keyword">from</span> <span class="string">'./timer'</span></span><br><span class="line"><span class="comment">// mock timer</span></span><br><span class="line">jest.useFakeTimers()</span><br><span class="line">test(<span class="string">'timer 测试'</span>,()=&gt;&#123;    </span><br><span class="line">  <span class="keyword">const</span> fn = jest.fn();</span><br><span class="line">  timer(fn)</span><br><span class="line">  <span class="comment">// 快速运行所有Timer</span></span><br><span class="line">  jest.runAllTimers();</span><br><span class="line">  expect(fn).toHaveBeenCalledTimes(<span class="number">1</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>对于嵌套 timer 异步函数，<code>jest.runOnlyPendingTimers</code>可以让只最外层的第一个 timer 运行。</p>
<p>另外还有快进时间的api,<code>jest.advanceTimersByTime(n)</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// timer.test.js</span></span><br><span class="line"><span class="keyword">import</span> timer <span class="keyword">from</span> <span class="string">'./timer'</span></span><br><span class="line"></span><br><span class="line">jest.useFakeTimers()</span><br><span class="line">test(<span class="string">'timer 测试'</span>,()=&gt;&#123;</span><br><span class="line">  <span class="keyword">const</span> fn = jest.fn();</span><br><span class="line">  timer(fn)</span><br><span class="line">  jest.advanceTimersByTime(<span class="number">3000</span>)</span><br><span class="line">  expect(fn).toHaveBeenCalledTimes(<span class="number">1</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>嵌套 timer 的测试用例结合 钩子<code>beforeEach</code>以及两个上面讲的api的例子</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// timer.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (cb)=&gt;&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    cb()</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">      cb()</span><br><span class="line">    &#125;,<span class="number">3000</span>)    </span><br><span class="line">  &#125;,<span class="number">3000</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// timer.test.js</span></span><br><span class="line"><span class="keyword">import</span> timer <span class="keyword">from</span> <span class="string">'./timer'</span></span><br><span class="line"></span><br><span class="line">beforeEach(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">  jest.useFakeTimers()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">test(<span class="string">'timer 测试-runAllTimers'</span>,()=&gt;&#123;</span><br><span class="line">  <span class="keyword">const</span> fn = jest.fn();</span><br><span class="line">  timer(fn)</span><br><span class="line">  jest.runAllTimers();</span><br><span class="line">  expect(fn).toHaveBeenCalledTimes(<span class="number">2</span>)</span><br><span class="line">&#125;)</span><br><span class="line">test(<span class="string">'timer 测试-advanceTimersByTime'</span>,()=&gt;&#123;</span><br><span class="line">  <span class="keyword">const</span> fn = jest.fn();</span><br><span class="line">  timer(fn)</span><br><span class="line">  jest.advanceTimersByTime(<span class="number">3000</span>)</span><br><span class="line">  expect(fn).toHaveBeenCalledTimes(<span class="number">1</span>)</span><br><span class="line">  jest.advanceTimersByTime(<span class="number">3000</span>)</span><br><span class="line">  expect(fn).toHaveBeenCalledTimes(<span class="number">2</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="Mock-Funtions"><a href="#Mock-Funtions" class="headerlink" title="Mock Funtions"></a>Mock Funtions</h3><p>Mock 函数可以轻松测试代码之间的连接——实现方式包括：擦除函数实际实现、捕获对函数的调用（以及在这些调用中传递的参数）、在使用 <code>new</code> 实例化时捕获构造函数的实例，允许测试时配置返回值</p>
<h4 id="模拟函数"><a href="#模拟函数" class="headerlink" title="模拟函数"></a>模拟函数</h4><p>测试函数 <code>forEach</code>的内部实现，这个函数为传入的数组中的每个元素调用一次回调函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">forEach</span>(<span class="params">items,callback</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> index=<span class="number">0</span>;index&lt;items.length;index+=<span class="number">1</span>)&#123;</span><br><span class="line">        callback(item[index])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>为了测试此函数，可以使用一个 mock 函数，然后检查 mock 函数的状态来确保回调函数如期调用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mockCallback = jest.fn(<span class="function"><span class="params">x</span> =&gt;</span> <span class="number">42</span> + x);</span><br><span class="line">forEach([<span class="number">0</span>, <span class="number">1</span>], mockCallback)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 此mock函数被调用了两次</span></span><br><span class="line">expect(mockCallback.mock.calls.length).toBe(<span class="number">2</span>)</span><br><span class="line"><span class="built_in">console</span>.log(mockCallback)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">      &#123; </span></span><br><span class="line"><span class="comment">      	[Function: mockConstructor]</span></span><br><span class="line"><span class="comment">        _isMockFunction: true,</span></span><br><span class="line"><span class="comment">        getMockImplementation: [Function],</span></span><br><span class="line"><span class="comment">        mock: [Getter/Setter],</span></span><br><span class="line"><span class="comment">        mockClear: [Function],</span></span><br><span class="line"><span class="comment">        mockReset: [Function],</span></span><br><span class="line"><span class="comment">        mockRestore: [Function],</span></span><br><span class="line"><span class="comment">        mockReturnValueOnce: [Function],</span></span><br><span class="line"><span class="comment">        mockResolvedValueOnce: [Function],</span></span><br><span class="line"><span class="comment">        mockRejectedValueOnce: [Function],</span></span><br><span class="line"><span class="comment">        mockReturnValue: [Function],</span></span><br><span class="line"><span class="comment">        mockResolvedValue: [Function],</span></span><br><span class="line"><span class="comment">        mockRejectedValue: [Function],</span></span><br><span class="line"><span class="comment">        mockImplementationOnce: [Function],</span></span><br><span class="line"><span class="comment">        mockImplementation: [Function],</span></span><br><span class="line"><span class="comment">        mockReturnThis: [Function],</span></span><br><span class="line"><span class="comment">        mockName: [Function],</span></span><br><span class="line"><span class="comment">        getMockName: [Function] </span></span><br><span class="line"><span class="comment">       &#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第一次调用函数时的第一个参数是 0</span></span><br><span class="line">expect(mockCallback.mock.calls[<span class="number">0</span>][<span class="number">0</span>]).toBe(<span class="number">0</span>)</span><br><span class="line"><span class="built_in">console</span>.log(mockCallback.mock)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">      &#123; </span></span><br><span class="line"><span class="comment">      	calls: [ [ 0 ], [ 1 ] ],</span></span><br><span class="line"><span class="comment">        instances: [ undefined, undefined ],</span></span><br><span class="line"><span class="comment">        invocationCallOrder: [ 1, 2 ],</span></span><br><span class="line"><span class="comment">        results:</span></span><br><span class="line"><span class="comment">         [ &#123; type: 'return', value: 42 &#125;, &#123; type: 'return', value: 43 &#125; ] </span></span><br><span class="line"><span class="comment">       &#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// 第二次调用函数时的第一个参数是1</span></span><br><span class="line">expect(mockCallback.mock.calls[<span class="number">1</span>][<span class="number">0</span>]).toBe(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第一次函数调用的返回值是 42</span></span><br><span class="line">expect(mockCallback.mock.results[<span class="number">0</span>].value).toBe(<span class="number">42</span>)</span><br></pre></td></tr></table></figure>
<h4 id="mock属性"><a href="#mock属性" class="headerlink" title=".mock属性"></a><code>.mock</code>属性</h4><p>所有 mock 函数都有这个特殊的 <code>.mock</code>属性，它保存了关于此函数如何调用、调用时的返回值的信息。<code>.mock</code>属性还追踪每次调用时 <code>this</code>的值，所以我们同样也可以检视（inspect）<code>this</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> myMock = jest.fn();</span><br><span class="line"><span class="keyword">const</span> a = <span class="keyword">new</span> myMock();</span><br><span class="line"><span class="keyword">const</span> b = &#123;&#125;;</span><br><span class="line"><span class="keyword">const</span> bound = myMock.bind(b)</span><br><span class="line">bound();</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(myMock.mock.instances)</span><br><span class="line"><span class="comment">// [ mockConstructor &#123;&#125;, &#123;&#125; ]</span></span><br></pre></td></tr></table></figure>
<h4 id="模拟返回值"><a href="#模拟返回值" class="headerlink" title="模拟返回值"></a>模拟返回值</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> myMock = jest.fn();</span><br><span class="line"><span class="built_in">console</span>.log(myMock())</span><br><span class="line"><span class="comment">// undefined</span></span><br><span class="line"></span><br><span class="line">myMock</span><br><span class="line">    .mockReturnValueOnce(<span class="number">10</span>)</span><br><span class="line">	.mockReturnValueOnce(<span class="string">'x'</span>)</span><br><span class="line">	.mockReturnValue(<span class="literal">true</span>)</span><br><span class="line"><span class="built_in">console</span>.log(myMock(), myMock(), myMock(), myMock());</span><br><span class="line"><span class="comment">// 10, 'x', true, true</span></span><br></pre></td></tr></table></figure>
<p>结合一些函数灵活模拟</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> filterTestFn = jest.fn();</span><br><span class="line"></span><br><span class="line">filterTestFn.mockReturnValueOnce(<span class="literal">true</span>).mockReturnValueOnce(<span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> result = [<span class="number">11</span>,<span class="number">12</span>].filter(filterTestFn)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(result)</span><br><span class="line"><span class="comment">// [11]</span></span><br><span class="line"><span class="built_in">console</span>.log(filterTestFn.mock.calls)</span><br><span class="line"><span class="comment">// [[11],[12]]</span></span><br></pre></td></tr></table></figure>
<h4 id="模拟模块"><a href="#模拟模块" class="headerlink" title="模拟模块"></a>模拟模块</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// users.js</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Users</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> call()&#123;</span><br><span class="line">        <span class="keyword">return</span> axios.get(<span class="string">'/user.json'</span>).then(<span class="function"><span class="params">res</span>=&gt;</span>res.data)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Users</span><br></pre></td></tr></table></figure>
<p>模拟 axios.get 返回一个假的 response</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// users.test.js</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span>;</span><br><span class="line"><span class="keyword">import</span> Users <span class="keyword">from</span> <span class="string">'./users'</span>;</span><br><span class="line"></span><br><span class="line">jest.mock(axios);</span><br><span class="line">test(<span class="string">'should fetch users'</span>,()=&gt;&#123;</span><br><span class="line">    <span class="keyword">const</span> users = [&#123;<span class="attr">name</span>:<span class="string">'Bob'</span>&#125;]</span><br><span class="line">    <span class="keyword">const</span> res = &#123;<span class="attr">data</span>:users&#125;</span><br><span class="line">    axios.get.mockResolvedValue(res)</span><br><span class="line">    <span class="keyword">return</span> Users.all().then(<span class="function"><span class="params">data</span>=&gt;</span>expect(data).toEqual(users))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="模拟实现"><a href="#模拟实现" class="headerlink" title="模拟实现"></a>模拟实现</h4><p>通过模拟函数 <code>jest.fn</code>或者<code>mockImplementationOnce</code>方法来完成</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> myMockFn = jest.fn(<span class="function"><span class="params">cb</span>=&gt;</span> cb(<span class="literal">null</span>,<span class="literal">true</span>))</span><br><span class="line"></span><br><span class="line">myMockFn(<span class="function">(<span class="params">err,val</span>)=&gt;</span><span class="built_in">console</span>.log(val))</span><br><span class="line"><span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p><code>mockImplementation</code>当您需要定义从另一个模块创建的模拟函数的默认实现时，该方法很有用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// foo.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// some implementation</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// test.js</span></span><br><span class="line"></span><br><span class="line">jest.mock(<span class="string">'../foo'</span>) <span class="comment">//  这个会自动模拟</span></span><br><span class="line"><span class="keyword">const</span> foo = <span class="built_in">require</span>(<span class="string">'../foo'</span>)</span><br><span class="line"></span><br><span class="line">foo.mockImplementation(<span class="function"><span class="params">()</span>=&gt;</span><span class="number">42</span>)</span><br><span class="line">foo();</span><br><span class="line"><span class="comment">// 42</span></span><br></pre></td></tr></table></figure>
<p>当需要重新创建模拟函数的复杂行为，以便多个函数调用产生不同的结果时，可以使用 <code>mockImplementationOnce</code>方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> myMockFn = jest</span><br><span class="line">	.fn()</span><br><span class="line">	.mockImplementationOnce(<span class="function"><span class="params">cb</span> =&gt;</span> cb(<span class="literal">null</span>,<span class="literal">true</span>))</span><br><span class="line">	.mockImplementationOnce(<span class="function"><span class="params">cb</span> =&gt;</span> cb(<span class="literal">null</span>,fase))</span><br><span class="line">myMockFn(<span class="function">(<span class="params">err, val</span>) =&gt;</span> <span class="built_in">console</span>.log(val));</span><br><span class="line"><span class="comment">// true</span></span><br><span class="line">myMockFn(<span class="function">(<span class="params">err, val</span>) =&gt;</span> <span class="built_in">console</span>.log(val));</span><br><span class="line"><span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<p><code>.mockReturnThis()</code>返回 this</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> myObj = &#123;</span><br><span class="line">    myMethod: jest.fn().mockReturnThis(),</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 与下面实现相同</span></span><br><span class="line"><span class="keyword">const</span> otherObj = &#123;</span><br><span class="line">    myMethod: jest.fn(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="模拟函数名称"><a href="#模拟函数名称" class="headerlink" title="模拟函数名称"></a>模拟函数名称</h4><p>选择为模拟函数提供一个名称，改名称将在测试错误输出中显示，而不是 <code>jest.fn()</code>，使用这个可以快速识别在测试输出中报告错误的模拟函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> myMockFn = jest</span><br><span class="line">.fn()</span><br><span class="line">.mockReturnValue(<span class="string">'default'</span>)</span><br><span class="line">.mockImplementation(<span class="function"><span class="params">x</span> =&gt;</span> x + <span class="number">42</span>)</span><br><span class="line">.mockName(<span class="string">'add42'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Snapshot快照"><a href="#Snapshot快照" class="headerlink" title="Snapshot快照"></a>Snapshot快照</h3><p>适合测试配置文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// xx.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> generateConfig = <span class="function"><span class="params">()</span> =&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    server:<span class="string">'http://localhost'</span>,</span><br><span class="line">    port:<span class="number">8080</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//xx.test.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; generateConfig &#125; <span class="keyword">from</span> <span class="string">'./snopshot'</span>;</span><br><span class="line"></span><br><span class="line">test(<span class="string">'测试 generateConfig 函数'</span>,()=&gt;&#123;</span><br><span class="line">  expect(generateConfig()).toMatchSnapshot();</span><br><span class="line">  expect(generateConfig()).toEqual(&#123;</span><br><span class="line">    server:<span class="string">'http://localhost'</span>,</span><br><span class="line">    port:<span class="number">8080</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><code>jest --watchAll</code>里面出现了 <code>u</code>、<code>i</code>模式分别对应 更新所有的快照跟更新单个快照</p>
<p>安装 <code>prettier</code>,运行 <code>toMatchInlineSnapshot</code>，会将 快照自动存到代码下面</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">test(<span class="string">'测试 generateConfig 函数'</span>, () =&gt; &#123;</span><br><span class="line">  expect(generateConfig()).toMatchInlineSnapshot(</span><br><span class="line">    &#123;</span><br><span class="line">      time: expect.any(<span class="built_in">Date</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 下面是自动生成的</span></span><br><span class="line">    <span class="string">`</span></span><br><span class="line"><span class="string">    Object &#123;</span></span><br><span class="line"><span class="string">      "port": 8080,</span></span><br><span class="line"><span class="string">      "server": "http://localhost",</span></span><br><span class="line"><span class="string">      "time": Any&lt;Date&gt;,</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  `</span></span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="ES6-类"><a href="#ES6-类" class="headerlink" title="ES6 类"></a>ES6 类</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// util.js</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Util</span> </span>&#123;</span><br><span class="line">  init()&#123;&#125;</span><br><span class="line">  a()&#123;</span><br><span class="line">    <span class="comment">// 异常复杂</span></span><br><span class="line">  &#125;</span><br><span class="line">  b()&#123;</span><br><span class="line">    <span class="comment">// 异常复杂</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Util;</span><br></pre></td></tr></table></figure>
<p>在别的函数里面使用这个类</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// useUtil.js</span></span><br><span class="line"><span class="keyword">import</span> Util <span class="keyword">from</span> <span class="string">'./util'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useUtil = <span class="function">(<span class="params">a,b</span>) =&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> util = <span class="keyword">new</span> Util()</span><br><span class="line">  util.a(a)</span><br><span class="line">  util.b(b)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useUtil;</span><br></pre></td></tr></table></figure>
<p>写这个使用类的函数的测试用例的时候，我们会发现这个函数因为使用到了类里面的函数，而函数又很复杂，直接调用会损耗性能。所以这里我们用几种方法来模拟</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// useUtil.test.js</span></span><br><span class="line">jest.mock(<span class="string">'./util'</span>)</span><br><span class="line"><span class="comment">// jest.mock 发现 util 是一个类，会自动把类的构造函数方法变成 jest.fn()</span></span><br><span class="line"><span class="comment">// const Util = jest.fn();</span></span><br><span class="line"><span class="comment">// Util.a = jest.fn()</span></span><br><span class="line"><span class="comment">// Util.b = jest.fn()</span></span><br><span class="line"><span class="keyword">import</span> Util <span class="keyword">from</span> <span class="string">'./util'</span></span><br><span class="line"><span class="keyword">import</span> useUtil <span class="keyword">from</span> <span class="string">'./useUtil'</span></span><br><span class="line"></span><br><span class="line">test(<span class="string">'测试 useUtil'</span>,()=&gt;&#123;</span><br><span class="line">  useUtil();</span><br><span class="line">  expect(Util).toHaveBeenCalled();</span><br><span class="line">  <span class="built_in">console</span>.log(Util.mock)</span><br><span class="line">  expect(Util.mock.instances[<span class="number">0</span>].a).toHaveBeenCalled()</span><br><span class="line">  expect(Util.mock.instances[<span class="number">0</span>].b).toHaveBeenCalled()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  ● Console</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    console.log src/lesson3/useUtil.test.js:12</span></span><br><span class="line"><span class="comment">      &#123; calls: [ [] ],</span></span><br><span class="line"><span class="comment">        instances: [ Util &#123; init: [Function], a: [Function], b: [Function] &#125; ],</span></span><br><span class="line"><span class="comment">        invocationCallOrder: [ 1 ],</span></span><br><span class="line"><span class="comment">        results: [ &#123; type: 'return', value: undefined &#125; ] &#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>另一种方法就是通过在 <code>__mocks__</code>文件夹中模拟</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// __mocks__/util.js</span></span><br><span class="line"><span class="keyword">const</span> Util = jest.fn();</span><br><span class="line">Util.prototype = jest.fn();</span><br><span class="line">Util.prototype = jest.fn();</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Util</span><br></pre></td></tr></table></figure>
<p>还有一种写法，是在原来的测试用例修改</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// useUtil.test.js</span></span><br><span class="line">jest.mock(<span class="string">'./util'</span>,()=&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> Util = jest.fn();</span><br><span class="line">    Util.prototype = jest.fn();</span><br><span class="line">    Util.prototype = jest.fn();</span><br><span class="line">    <span class="keyword">return</span> Util;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="DOM操作"><a href="#DOM操作" class="headerlink" title="DOM操作"></a>DOM操作</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// dom.js</span></span><br><span class="line"><span class="keyword">import</span> $ <span class="keyword">from</span> <span class="string">'jquery'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> addDivToBody = <span class="function"><span class="params">()</span> =&gt;</span>&#123;</span><br><span class="line">    $(<span class="string">'body'</span>).append(<span class="string">'&lt;div/&gt;'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> addDivToBody</span><br><span class="line"></span><br><span class="line"><span class="comment">// dom.test.js</span></span><br><span class="line"><span class="comment">// node 本身不具备 dom</span></span><br><span class="line"><span class="comment">// jest 在 node 环境下模拟了一套 dom 的 api,jsDom</span></span><br><span class="line"><span class="keyword">import</span> $ <span class="keyword">from</span> <span class="string">'jquery'</span></span><br><span class="line"><span class="keyword">import</span> addDivToBody <span class="keyword">from</span> addDivToBody;</span><br><span class="line"></span><br><span class="line">test(<span class="string">'测试 addDivToBody'</span>,()=&gt;&#123;</span><br><span class="line">    addDivToBody();</span><br><span class="line">    expect($(<span class="string">'body'</span>).find(<span class="string">'div'</span>).length).toBe(<span class="number">1</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="TDD（测试驱动开发）"><a href="#TDD（测试驱动开发）" class="headerlink" title="TDD（测试驱动开发）"></a>TDD（测试驱动开发）</h2><p>全称：Test Driven Development</p>
<h3 id="开发流程（Red-Green-Development）"><a href="#开发流程（Red-Green-Development）" class="headerlink" title="开发流程（Red-Green Development）"></a>开发流程（Red-Green Development）</h3><ol>
<li>编写测试用例</li>
<li>运行测试，测试用例无法通过测试</li>
<li>编写代码，使测试用例通过测试</li>
<li>优化代码，完成开发</li>
<li>重复上述步骤</li>
</ol>
<h3 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h3><ol>
<li>长期减少回归 bug</li>
<li>代码质量更好（组织、可维护性）</li>
<li>测试覆盖率高</li>
<li>错误测试代码不容易出现</li>
</ol>
<h3 id="Vue-TDD"><a href="#Vue-TDD" class="headerlink" title="Vue TDD"></a>Vue TDD</h3><p>开始</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装脚手架</span></span><br><span class="line">npm i @vue/cli@3.8.4 -g</span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装vue,可以选择默认配置，也可以自定义配置</span></span><br><span class="line">vue create vue-jest</span><br></pre></td></tr></table></figure>
<h4 id="vue-test-utils"><a href="#vue-test-utils" class="headerlink" title="@vue/test-utils"></a>@vue/test-utils</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// HelloWorld.test.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; shallowMount &#125; <span class="keyword">from</span> <span class="string">'@vue/test-utils'</span></span><br><span class="line"><span class="keyword">import</span> HelloWorld <span class="keyword">from</span> <span class="string">'@/components/HelloWorld.vue'</span></span><br><span class="line"></span><br><span class="line">describe(<span class="string">'HelloWorld.vue'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="comment">/** 如果不使用 @vue/test-utils</span></span><br><span class="line"><span class="comment">   * import Vue from 'vue'</span></span><br><span class="line"><span class="comment">   *   it('renders props.msg when passed', () =&gt; &#123;</span></span><br><span class="line"><span class="comment">  const root = document.createElement('div')</span></span><br><span class="line"><span class="comment">  root.className = 'root'</span></span><br><span class="line"><span class="comment">  document.body.appendChild(root)</span></span><br><span class="line"><span class="comment">  new Vue(&#123;</span></span><br><span class="line"><span class="comment">    render: h =&gt; h(HelloWorld, &#123;</span></span><br><span class="line"><span class="comment">      props: &#123;</span></span><br><span class="line"><span class="comment">        msg: 'laibh'</span></span><br><span class="line"><span class="comment">      &#125;</span></span><br><span class="line"><span class="comment">    &#125;)</span></span><br><span class="line"><span class="comment">  &#125;).$mount('.root')</span></span><br><span class="line"><span class="comment">  expect(document.getElementsByClassName('hello').length).toBe(1)</span></span><br><span class="line"><span class="comment">  &#125;)</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">const</span> msg = <span class="string">'new message'</span></span><br><span class="line">  <span class="keyword">const</span> wrapper = shallowMount(HelloWorld, &#123;</span><br><span class="line">    propsData: &#123; msg &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  expect(wrapper.text()).toMatch(msg)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><code>shallowMount</code>浅层渲染，只渲染第一层，不渲染子组件，适合单元测试</p>
<p><code>mount</code>则会渲染子组件，适合集成测试</p>
<h4 id="开发-Header-组件"><a href="#开发-Header-组件" class="headerlink" title="开发 Header 组件"></a>开发 Header 组件</h4><p>测试用例先行</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Header.test.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; shallowMount &#125; <span class="keyword">from</span> <span class="string">'@vue/test-utils'</span></span><br><span class="line"><span class="keyword">import</span> Header <span class="keyword">from</span> <span class="string">'@/components/Header/Header.vue'</span></span><br><span class="line"></span><br><span class="line">describe(<span class="string">'测试 Header 组件'</span>, () =&gt; &#123;</span><br><span class="line">  it(<span class="string">'Header 包含 Input 框'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = shallowMount(Header)</span><br><span class="line">    <span class="keyword">const</span> input = wrapper.find(<span class="string">'[data-test="input"]'</span>)</span><br><span class="line">    expect(input.exists()).toBe(<span class="literal">true</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  it(<span class="string">'Header 中 Input 初始内容为空'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = shallowMount(Header)</span><br><span class="line">    <span class="keyword">const</span> inputValue = wrapper.vm.$data.inputValue</span><br><span class="line">    expect(inputValue).toBe(<span class="string">''</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  it(<span class="string">'Header 中 Input 框值发生变化，值应该也跟着改变'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = shallowMount(Header)</span><br><span class="line">    <span class="keyword">const</span> input = wrapper.find(<span class="string">'[data-test="input"]'</span>)</span><br><span class="line">    input.setValue(<span class="string">'laibh'</span>)</span><br><span class="line">    <span class="keyword">const</span> inputValue = wrapper.vm.$data.inputValue</span><br><span class="line">    expect(inputValue).toBe(<span class="string">'laibh'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  it(<span class="string">'Header 中 Input 框输入回车，无内容时无反应'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = shallowMount(Header)</span><br><span class="line">    <span class="keyword">const</span> input = wrapper.find(<span class="string">'[data-test="input"]'</span>)</span><br><span class="line">    input.setValue(<span class="string">''</span>)</span><br><span class="line">    input.trigger(<span class="string">'keyup.enter'</span>)</span><br><span class="line">    expect(wrapper.emitted().add).toBeFalsy()</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  it(<span class="string">'Header 中 Input 框输入回车，有内容时向外触发事件,同时清空 inputValue'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = shallowMount(Header)</span><br><span class="line">    <span class="keyword">const</span> input = wrapper.find(<span class="string">'[data-test="input"]'</span>)</span><br><span class="line">    input.setValue(<span class="string">'laibh'</span>)</span><br><span class="line">    input.trigger(<span class="string">'keyup.enter'</span>)</span><br><span class="line">    expect(wrapper.emitted().add).toBeTruthy()</span><br><span class="line">    expect(wrapper.vm.$data.inputValue).toBe(<span class="string">''</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>根据测试用例写代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">// Header.vue</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;input data-test=&quot;input&quot; v-model=&quot;inputValue&quot; @keyup.enter=&quot;addTodoItem&quot; /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;Header&quot;,</span><br><span class="line">  props: &#123;&#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      inputValue: &quot;&quot;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    addTodoItem() &#123;</span><br><span class="line">      if (this.inputValue) &#123;</span><br><span class="line">        this.$emit(&quot;add&quot;, this.inputValue);</span><br><span class="line">        this.inputValue = &quot;&quot;;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped lang=&quot;less&quot;&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h4 id="测试覆盖率"><a href="#测试覆盖率" class="headerlink" title="测试覆盖率"></a>测试覆盖率</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// jest.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    collectCoverageFrom: [<span class="string">'**/*.&#123;js,vue&#125;'</span>, <span class="string">'!**/node_modules/**'</span>],</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// package.json</span></span><br><span class="line">  <span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"test:cov"</span>: <span class="string">"vue-cli-service test:unit --coverage"</span></span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<h3 id="React-TDD"><a href="#React-TDD" class="headerlink" title="React TDD"></a>React TDD</h3><h4 id="Enzyme"><a href="#Enzyme" class="headerlink" title="Enzyme"></a>Enzyme</h4><p><a href="https://github.com/airbnb/enzyme">github</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装 </span></span><br><span class="line">npm i --save-dev enzyme enzyme-adapter-react-16</span><br></pre></td></tr></table></figure>
<p>同样，<code>shallow</code>适合单元测试，<code>mount</code>则是集成测试</p>
<p>例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// App.je</span></span><br><span class="line"><span class="keyword">import</span> React from <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function">function <span class="title">App</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">     <span class="comment">// 使用的data-test=xxx 等属性可以做到解耦，不会因为改变样式名而发生改变，另外也不会被hash掉</span></span><br><span class="line">    &lt;div className=<span class="string">"app-container"</span> title=<span class="string">"laibh"</span> data-test=<span class="string">"container"</span>&gt;</span><br><span class="line">      hello world</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export <span class="keyword">default</span> App;</span><br><span class="line"><span class="comment">// App.test.js</span></span><br><span class="line"><span class="keyword">import</span> React from <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> App from <span class="string">'./App'</span>;</span><br><span class="line"><span class="keyword">import</span> Enzyme, &#123; shallow &#125; from <span class="string">'enzyme'</span>;</span><br><span class="line"><span class="keyword">import</span> Adapter from <span class="string">'enzyme-adapter-react-16'</span>;</span><br><span class="line">Enzyme.configure(&#123; adapter: <span class="keyword">new</span> Adapter() &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">it(<span class="string">'renders without crashing'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> wrapper = shallow(&lt;App /&gt;)</span><br><span class="line">  <span class="comment">// 输出整个内容字符串</span></span><br><span class="line">  console.log(wrapper.debug())</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">    &lt;div className="app-container" title="laibh" data-test="container"&gt;</span></span><br><span class="line"><span class="comment">      hello world</span></span><br><span class="line"><span class="comment">    &lt;/div&gt;  </span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  expect(wrapper.find(<span class="string">'[data-test="container"]'</span>).length).toBe(<span class="number">1</span>)</span><br><span class="line">  expect(wrapper.find(<span class="string">'[data-test="container"]'</span>).prop(<span class="string">'title'</span>)).toBe(<span class="string">'laibh'</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>另外它海域一些扩展 API，例如 <a href="https://github.com/FormidableLabs/enzyme-matchers/tree/master/packages/jest-enzyme">jest-enzyme</a>，让语法易懂简洁</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// App.test.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App'</span>;</span><br><span class="line"><span class="keyword">import</span> Enzyme, &#123; shallow &#125; <span class="keyword">from</span> <span class="string">'enzyme'</span>;</span><br><span class="line"><span class="keyword">import</span> Adapter <span class="keyword">from</span> <span class="string">'enzyme-adapter-react-16'</span>;</span><br><span class="line">Enzyme.configure(&#123; <span class="attr">adapter</span>: <span class="keyword">new</span> Adapter() &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">it(<span class="string">'renders without crashing'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> wrapper = shallow(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span>)</span></span><br><span class="line"><span class="xml">  console.log(wrapper.debug())</span></span><br><span class="line"><span class="xml">  const container = wrapper.find('[data-test="container"]')</span></span><br><span class="line"><span class="xml">  expect(container.length).toBe(1)</span></span><br><span class="line"><span class="xml">  expect(container.prop('title')).toBe('laibh')</span></span><br><span class="line"><span class="xml">  // 等同上面两句</span></span><br><span class="line"><span class="xml">  expect(container).toExist()</span></span><br><span class="line"><span class="xml">  expect(container).toHaveProp('title', 'laibh')</span></span><br><span class="line"><span class="xml">&#125;);</span></span><br></pre></td></tr></table></figure>
<p>别忘记在 <code>jest.config.js</code>里面进行配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    setupFilesAfterEnv: [<span class="string">'./node_modules/jest-enzyme/lib/index.js'</span>],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="开发-Header-组件-1"><a href="#开发-Header-组件-1" class="headerlink" title="开发 Header 组件"></a>开发 Header 组件</h4><p>同样测试先行</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> Header <span class="keyword">from</span> <span class="string">'../../index'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; shallow &#125; <span class="keyword">from</span> <span class="string">'enzyme'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> wrapper;</span><br><span class="line"><span class="keyword">let</span> inputElem;</span><br><span class="line">describe(<span class="string">'测试 Header 组件'</span>, () =&gt; &#123;</span><br><span class="line">  beforeEach(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    wrapper = shallow(<span class="xml"><span class="tag">&lt;<span class="name">Header</span> /&gt;</span>)</span></span><br><span class="line"><span class="xml">    inputElem = wrapper.find('[data-test="input"]')</span></span><br><span class="line"><span class="xml">  &#125;)</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">  it('正常渲染', () =&gt; &#123;</span></span><br><span class="line"><span class="xml">    expect(wrapper).toMatchSnapshot()</span></span><br><span class="line"><span class="xml">  &#125;);</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">  it('包含一个 input', () =&gt; &#123;</span></span><br><span class="line"><span class="xml">    expect(inputElem).toExist()</span></span><br><span class="line"><span class="xml">  &#125;);</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">  it('input初始化内容应该为空', () =&gt; &#123;</span></span><br><span class="line"><span class="xml">    expect(inputElem.prop('value')).toBe('')</span></span><br><span class="line"><span class="xml">  &#125;);</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">  it('当用户输入时，input内容会跟着变化', () =&gt; &#123;</span></span><br><span class="line"><span class="xml">    const value = '哈哈哈'</span></span><br><span class="line"><span class="xml">    inputElem.simulate('change', &#123;</span></span><br><span class="line"><span class="xml">      target: &#123;</span></span><br><span class="line"><span class="xml">        value</span></span><br><span class="line"><span class="xml">      &#125;</span></span><br><span class="line"><span class="xml">    &#125;)</span></span><br><span class="line"><span class="xml">    expect(wrapper.state('value')).toBe(value)</span></span><br><span class="line"><span class="xml">  &#125;);</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">  it('当用户输入后，键入回车，如果 input 没有内容，则不操作', () =&gt; &#123;</span></span><br><span class="line"><span class="xml">    const fn = jest.fn();</span></span><br><span class="line">    const wrapper = shallow(&lt;Header addUndoItem=&#123;fn&#125; /&gt;)</span><br><span class="line">    wrapper.setState(&#123; value: '' &#125;)</span><br><span class="line">    const inputElem = wrapper.find('[data-test="input"]')</span><br><span class="line">    inputElem.simulate('keyUp', &#123;</span><br><span class="line">      keyCode: 13</span><br><span class="line">    &#125;)</span><br><span class="line">    expect(fn).not.toBeCalled()</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it('当用户输入后，键入回车，如果 input 有内容，addUndoItem应该被调用,然后input被清空', () =&gt; &#123;</span><br><span class="line">    const fn = jest.fn();</span><br><span class="line">    const wrapper = shallow(&lt;Header addUndoItem=&#123;fn&#125; /&gt;)</span><br><span class="line">    const value = 'haha';</span><br><span class="line">    wrapper.setState(&#123; value &#125;)</span><br><span class="line">    const inputElem = wrapper.find('[data-test="input"]')</span><br><span class="line">    inputElem.simulate('keyUp', &#123;</span><br><span class="line">      keyCode: 13</span><br><span class="line">    &#125;)</span><br><span class="line">    expect(fn).toBeCalled()</span><br><span class="line">    expect(fn).toBeCalledWith(value)</span><br><span class="line">    const newInputElem = wrapper.find('[data-test="input"]')</span><br><span class="line">    expect(newInputElem.prop('value')).toBe('')</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>根据测试写代码</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">'./index.less'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Header</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props)</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      value: <span class="string">''</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleInputKeyUp = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; value &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">    <span class="keyword">const</span> &#123; addUndoItem &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">if</span> (e.keyCode === <span class="number">13</span> &amp;&amp; value) &#123;</span><br><span class="line">      addUndoItem(value)</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123; <span class="attr">value</span>: <span class="string">''</span> &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleInputChange = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; <span class="attr">value</span>: e.target.value &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; value &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div className=&#123;styles.header&#125;&gt;</span><br><span class="line">        &lt;div className=&#123;styles.headerContent&#125;&gt;</span><br><span class="line">          TodoList</span><br><span class="line">        &lt;input</span><br><span class="line">            className=&#123;styles.headerInput&#125;</span><br><span class="line">            data-test=<span class="string">'input'</span></span><br><span class="line">            value=&#123;value&#125;</span><br><span class="line">            onChange=&#123;<span class="keyword">this</span>.handleInputChange&#125;</span><br><span class="line">            onKeyUp=&#123;<span class="keyword">this</span>.handleInputKeyUp&#125;</span><br><span class="line">            placeholder=<span class="string">'Add Todo'</span></span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Header;</span><br></pre></td></tr></table></figure>
<h3 id="TDD-小结"><a href="#TDD-小结" class="headerlink" title="TDD 小结"></a>TDD 小结</h3><p>优势：代码质量提高</p>
<p><code>单元测试</code></p>
<p>测试覆盖率高，业务耦合度高，代码量大，过于独立</p>
<h2 id="BDD（行为驱动开发）"><a href="#BDD（行为驱动开发）" class="headerlink" title="BDD（行为驱动开发）"></a>BDD（行为驱动开发）</h2><p>全称：Behavior Driven Development</p>
<h3 id="集成测试"><a href="#集成测试" class="headerlink" title="集成测试"></a>集成测试</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vue integration/todoList </span></span><br><span class="line"><span class="keyword">import</span> &#123; mount &#125; <span class="keyword">from</span> <span class="string">'@vue/test-utils'</span></span><br><span class="line"><span class="keyword">import</span> TodoList <span class="keyword">from</span> <span class="string">'../../TodoList'</span></span><br><span class="line"></span><br><span class="line">  it(<span class="string">`</span></span><br><span class="line"><span class="string">    1.用户会在 header输入框输入内容</span></span><br><span class="line"><span class="string">    2.用户会点击回车按钮</span></span><br><span class="line"><span class="string">    3.列表项应该增加用户输入内容的列表项</span></span><br><span class="line"><span class="string">  `</span>, () =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> wrapper = mount(<span class="xml"><span class="tag">&lt;<span class="name">TodoList</span> /&gt;</span>);</span></span><br><span class="line"><span class="xml">      const inputElem = wrapper.findAll('[data-test="header-input"]').at(0)</span></span><br><span class="line"><span class="xml">      const content = 'haha'</span></span><br><span class="line"><span class="xml">      inputElem.setValue(content)</span></span><br><span class="line"><span class="xml">      inputElem.trigger('change')</span></span><br><span class="line"><span class="xml">      inputElem.trigger('keyup.enter')</span></span><br><span class="line"><span class="xml">      const listItems = wrapper.findAll('[data-test="list-item"]').at(0)</span></span><br><span class="line"><span class="xml">      expect(listItems.length).toBe(1)</span></span><br><span class="line"><span class="xml">      expect(listItems.at(0).text()).toContain(content)</span></span><br><span class="line"><span class="xml">    &#125;)</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">// react integration/todoList </span></span><br><span class="line"><span class="xml">import React from 'react';</span></span><br><span class="line"><span class="xml">import &#123; mount &#125; from 'enzyme';</span></span><br><span class="line"><span class="xml">import TodoList from './../../index';</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">describe('集成测试：TodoList', () =&gt; &#123;</span></span><br><span class="line"><span class="xml">  let wrapper;</span></span><br><span class="line"><span class="xml">  beforeEach(() =&gt; &#123;</span></span><br><span class="line"><span class="xml">    wrapper = mount(<span class="tag">&lt;<span class="name">TodoList</span> /&gt;</span>)</span></span><br><span class="line"><span class="xml">  &#125;)</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">  it(`</span></span><br><span class="line"><span class="xml">  1.用户会在 header输入框输入内容</span></span><br><span class="line"><span class="xml">  2.用户会点击回车按钮</span></span><br><span class="line"><span class="xml">  3.列表项应该增加用户输入内容的列表项</span></span><br><span class="line"><span class="xml">  `, () =&gt; &#123;</span></span><br><span class="line"><span class="xml">      const value = 'haha'</span></span><br><span class="line"><span class="xml">      const headerInput = wrapper.find('[data-test="header-input"]')</span></span><br><span class="line"><span class="xml">      headerInput.simulate('change', &#123;</span></span><br><span class="line"><span class="xml">        target: &#123;</span></span><br><span class="line"><span class="xml">          value</span></span><br><span class="line"><span class="xml">        &#125;</span></span><br><span class="line"><span class="xml">      &#125;)</span></span><br><span class="line"><span class="xml">      // 按下回车键，keyCode为13</span></span><br><span class="line"><span class="xml">      headerInput.simulate('keyUp', &#123;</span></span><br><span class="line"><span class="xml">        keyCode: 13</span></span><br><span class="line"><span class="xml">      &#125;)</span></span><br><span class="line"><span class="xml">      // undoListItem</span></span><br><span class="line"><span class="xml">      const listItems = wrapper.find('[data-test="list-item"]')</span></span><br><span class="line"><span class="xml">      expect(listItems.length).toBe(1)</span></span><br><span class="line"><span class="xml">      expect(listItems.at(0).text()).toContain(value)</span></span><br><span class="line"><span class="xml">    &#125;)</span></span><br><span class="line"><span class="xml">&#125;)</span></span><br></pre></td></tr></table></figure>
<h3 id="TDD-与-BDD-比较"><a href="#TDD-与-BDD-比较" class="headerlink" title="TDD 与 BDD 比较"></a>TDD 与 BDD 比较</h3><p><strong>TDD</strong></p>
<ol>
<li>先写测试再写代码</li>
<li>一般结合单元测试使用，是白盒测试</li>
<li>测试重点在代码</li>
<li>安全感低</li>
<li>速度快</li>
</ol>
<p><strong>BDD</strong></p>
<ol>
<li>先写代码再写测试</li>
<li>一般结合集成测试使用，是黑盒测试</li>
<li>测试重点在 UI (DOM)</li>
<li>安全感高</li>
<li>速度慢</li>
</ol>
<h3 id="Redux相关测试"><a href="#Redux相关测试" class="headerlink" title="Redux相关测试"></a>Redux相关测试</h3><p>增加 redux 在项目</p>
<p><code>createStore</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/store/createStore</span></span><br><span class="line"><span class="keyword">import</span> &#123; createStore, combineReducers &#125; <span class="keyword">from</span> <span class="string">'redux'</span></span><br><span class="line"><span class="keyword">import</span> &#123; reducer <span class="keyword">as</span> todoReducer &#125; <span class="keyword">from</span> <span class="string">'../containers/TodoList/store'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> reducer = combineReducers(&#123;</span><br><span class="line">  todo: todoReducer</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = createStore(reducer, <span class="built_in">window</span>.__REDUX_DEVTOOLS_EXTENSION__ &amp;&amp; <span class="built_in">window</span>.__REDUX_DEVTOOLS_EXTENSION__());</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br></pre></td></tr></table></figure>
<p><code>store/actions.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; CHANGE_INPUT_VALUE &#125; <span class="keyword">from</span> <span class="string">'./constants'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> changeInputValue = <span class="function"><span class="params">value</span> =&gt;</span> (&#123;</span><br><span class="line">  type: CHANGE_INPUT_VALUE,</span><br><span class="line">  value</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><code>store/constants.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> CHANGE_INPUT_VALUE = <span class="string">'CHANGE_INPUT_VALUE'</span></span><br></pre></td></tr></table></figure>
<p><code>store/reducer.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; CHANGE_INPUT_VALUE &#125; <span class="keyword">from</span> <span class="string">'./constants'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initialState = &#123;</span><br><span class="line">  inputValue: <span class="string">''</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (state = initialState, action) =&gt; &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> CHANGE_INPUT_VALUE:</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        inputValue: action.value</span><br><span class="line">      &#125;;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>store/index.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">'./reducer'</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> actions <span class="keyword">from</span> <span class="string">'./actions'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; reducer, actions &#125;</span><br></pre></td></tr></table></figure>
<p><code>TodoList/index.js</code></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> Header <span class="keyword">from</span> <span class="string">'./../../components/Header/index'</span>;</span><br><span class="line"><span class="keyword">import</span> UndoList <span class="keyword">from</span> <span class="string">'./../../components/UndoList/index'</span>;</span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">'./index.less'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TodoList</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props)</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      undoList: []</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handledeleteItem = <span class="function">(<span class="params">index</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; undoList &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">    <span class="keyword">const</span> newList = undoList.filter(<span class="function">(<span class="params">item, itemIndex</span>) =&gt;</span> itemIndex !== index)</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; <span class="attr">undoList</span>: newList &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleStatusChange = <span class="function">(<span class="params">index</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; undoList &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">    <span class="comment">// undoList.forEach((item, itemIndex) =&gt; &#123;</span></span><br><span class="line">    <span class="comment">//   if (itemIndex === index) &#123;</span></span><br><span class="line">    <span class="comment">//     Object.assign(item, &#123; status: 'input' &#125;)</span></span><br><span class="line">    <span class="comment">//     return;</span></span><br><span class="line">    <span class="comment">//   &#125; Object.assign(item, &#123; status: 'div' &#125;)</span></span><br><span class="line">    <span class="comment">// &#125;)</span></span><br><span class="line">    <span class="keyword">const</span> newList = undoList.map(<span class="function">(<span class="params">item, itemIndex</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (itemIndex === index) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">          ...item,</span><br><span class="line">          status: <span class="string">'input'</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">return</span> &#123;</span><br><span class="line">        ...item,</span><br><span class="line">        status: <span class="string">'div'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; <span class="attr">undoList</span>: newList &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleBlur = <span class="function">(<span class="params">index</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; undoList &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">    <span class="keyword">const</span> newList = undoList.map(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...item,</span><br><span class="line">        status: <span class="string">'div'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; <span class="attr">undoList</span>: newList &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleInputValue = <span class="function">(<span class="params">index, value</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; undoList &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">    <span class="keyword">const</span> newList = undoList.map(<span class="function">(<span class="params">item, itemIndex</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (itemIndex === index) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">          ...item,</span><br><span class="line">          value</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">return</span> &#123;</span><br><span class="line">        ...item,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; <span class="attr">undoList</span>: newList &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  addUndoItem = <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; undoList &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      undoList: [...undoList, &#123;</span><br><span class="line">        status: <span class="string">'div'</span>,</span><br><span class="line">        value</span><br><span class="line">      &#125;]</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; undoList &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div className=&#123;styles.todoList&#125;&gt;</span><br><span class="line">        &lt;Header addUndoItem=&#123;<span class="keyword">this</span>.addUndoItem&#125; /&gt;</span><br><span class="line">        &lt;UndoList</span><br><span class="line">          list=&#123;undoList&#125;</span><br><span class="line">          deleteItem=&#123;<span class="keyword">this</span>.handledeleteItem&#125;</span><br><span class="line">          changeStatus=&#123;<span class="keyword">this</span>.handleStatusChange&#125;</span><br><span class="line">          changeBlur=&#123;<span class="keyword">this</span>.handleBlur&#125;</span><br><span class="line">          valueChange=&#123;<span class="keyword">this</span>.handleInputValue&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default TodoList;</span></span><br></pre></td></tr></table></figure>
<p><code>src/index.js</code></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App'</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'./store/createStore'</span></span><br><span class="line"></span><br><span class="line">ReactDOM.render((</span><br><span class="line">  &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">    &lt;App /&gt;</span><br><span class="line">  &lt;<span class="regexp">/Provider&gt;</span></span><br><span class="line"><span class="regexp">), document.getElementById('root'));</span></span><br></pre></td></tr></table></figure>
<p>然后修改集成测试的测试用例</p>
<p><code>src/containers/TodoList/__test__/integration/TodoList.test.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; mount &#125; <span class="keyword">from</span> <span class="string">'enzyme'</span>;</span><br><span class="line"><span class="keyword">import</span> TodoList <span class="keyword">from</span> <span class="string">'./../../index'</span>;</span><br><span class="line"><span class="comment">// 增加的内容</span></span><br><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'./../../../../store/createStore'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">describe(<span class="string">'集成测试：TodoList'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> wrapper;</span><br><span class="line">  beforeEach(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    wrapper = mount(</span><br><span class="line">      &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">        &lt;TodoList /&gt;</span><br><span class="line">      &lt;<span class="regexp">/Provider&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;)</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  it(`</span></span><br><span class="line"><span class="regexp">  1.用户会在 header输入框输入内容</span></span><br><span class="line"><span class="regexp">  2.用户会点击回车按钮</span></span><br><span class="line"><span class="regexp">  3.列表项应该增加用户输入内容的列表项</span></span><br><span class="line"><span class="regexp">  `, () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">      const value = 'haha'</span></span><br><span class="line"><span class="regexp">      const headerInput = wrapper.find('[data-test="header-input"]')</span></span><br><span class="line"><span class="regexp">      headerInput.simulate('change', &#123;</span></span><br><span class="line"><span class="regexp">        target: &#123;</span></span><br><span class="line"><span class="regexp">          value</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">      &#125;)</span></span><br><span class="line"><span class="regexp">      /</span><span class="regexp">/ 按下回车键，keyCode为13</span></span><br><span class="line"><span class="regexp">      headerInput.simulate('keyUp', &#123;</span></span><br><span class="line"><span class="regexp">        keyCode: 13</span></span><br><span class="line"><span class="regexp">      &#125;)</span></span><br><span class="line"><span class="regexp">      /</span><span class="regexp">/ undoListItem</span></span><br><span class="line"><span class="regexp">      const listItems = wrapper.find('[data-test="list-item"]')</span></span><br><span class="line"><span class="regexp">      expect(listItems.length).toBe(1)</span></span><br><span class="line"><span class="regexp">      expect(listItems.at(0).text()).toContain(value)</span></span><br><span class="line"><span class="regexp">    &#125;)</span></span><br><span class="line"><span class="regexp">&#125;)</span></span><br></pre></td></tr></table></figure>
<h3 id="异步代码"><a href="#异步代码" class="headerlink" title="异步代码"></a>异步代码</h3><h4 id="compontDidMount"><a href="#compontDidMount" class="headerlink" title="compontDidMount"></a>compontDidMount</h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">componentDidMount()&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    &#123;</span></span><br><span class="line"><span class="comment">        data:[</span></span><br><span class="line"><span class="comment">            &#123;status:'div',value:'haha'&#125;,</span></span><br><span class="line"><span class="comment">        ],</span></span><br><span class="line"><span class="comment">        success:true</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    axios.get(<span class="string">'/undoList.json'</span>).then(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            undoList:res.data</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;).catch(<span class="function"><span class="params">e</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(e)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 模拟函数</p>
<p><code>src/__mock__/axios.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mockUndoList = &#123;</span><br><span class="line">    data:[&#123;</span><br><span class="line">        status:<span class="string">'div'</span>,<span class="attr">value</span>:<span class="string">'haha'</span></span><br><span class="line">    &#125;],</span><br><span class="line">    success:<span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    get(url)&#123;</span><br><span class="line">        <span class="keyword">if</span>(url === <span class="string">'/undoList.json'</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">                resolve(mockUndoList)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试用例</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">`</span></span><br><span class="line"><span class="string">	1.用户打开页面</span></span><br><span class="line"><span class="string">	2.应该展示接口返回的数据</span></span><br><span class="line"><span class="string">`</span>,(done)=&gt;&#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = mount(</span><br><span class="line">        &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">            &lt;TodoList /&gt;</span><br><span class="line">        &lt;<span class="regexp">/Provider&gt;</span></span><br><span class="line"><span class="regexp">      /</span><span class="regexp">/ 解决数据异步问题</span></span><br><span class="line"><span class="regexp">      setTimeout(()=&gt;&#123;</span></span><br><span class="line"><span class="regexp">          wrapper.update();</span></span><br><span class="line"><span class="regexp">          const listItems = wrapper.find('[data-test="list-item"]')</span></span><br><span class="line"><span class="regexp">          expect(listItems.length).toBe(1)   </span></span><br><span class="line"><span class="regexp">          done()</span></span><br><span class="line"><span class="regexp">      &#125;,0)  </span></span><br><span class="line"><span class="regexp">        </span></span><br><span class="line"><span class="regexp">      /</span><span class="regexp">/ node的语法</span></span><br><span class="line"><span class="regexp">      process.nextTick(()=&gt;&#123;</span></span><br><span class="line"><span class="regexp">          wrapper.update();</span></span><br><span class="line"><span class="regexp">          const listItems = wrapper.find('[data-test="list-item"]')</span></span><br><span class="line"><span class="regexp">          expect(listItems.length).toBe(1)   </span></span><br><span class="line"><span class="regexp">          done()        </span></span><br><span class="line"><span class="regexp">      &#125;)</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">&#125;)</span></span><br></pre></td></tr></table></figure>
<h4 id="setTimeout"><a href="#setTimeout" class="headerlink" title="setTimeout"></a>setTimeout</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">componentDidMount()&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    &#123;</span></span><br><span class="line"><span class="comment">        data:[</span></span><br><span class="line"><span class="comment">            &#123;status:'div',value:'haha'&#125;,</span></span><br><span class="line"><span class="comment">        ],</span></span><br><span class="line"><span class="comment">        success:true</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">        axios.get(<span class="string">'/undoList.json'</span>).then(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">                undoList:res.data</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;).catch(<span class="function"><span class="params">e</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(e)</span><br><span class="line">        &#125;)        </span><br><span class="line">    &#125;,<span class="number">5000</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试用例</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">jest.useFakeTimers();</span><br><span class="line"></span><br><span class="line">it(<span class="string">`</span></span><br><span class="line"><span class="string">	1.用户打开页面</span></span><br><span class="line"><span class="string">	2.应该展示接口返回的数据</span></span><br><span class="line"><span class="string">`</span>,(done)=&gt;&#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = mount(</span><br><span class="line">        &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">            &lt;TodoList /&gt;</span><br><span class="line">        &lt;<span class="regexp">/Provider&gt;</span></span><br><span class="line"><span class="regexp">        </span></span><br><span class="line"><span class="regexp">      expect(setTimeout).toHaveBeenCalledTimes(1);</span></span><br><span class="line"><span class="regexp">      /</span><span class="regexp">/ 跑完所有 setTimeout 的时间</span></span><br><span class="line"><span class="regexp">      jest.runAllTimers();</span></span><br><span class="line"><span class="regexp">      /</span><span class="regexp">/ 解决数据异步问题</span></span><br><span class="line"><span class="regexp">      setTimeout(()=&gt;&#123;</span></span><br><span class="line"><span class="regexp">          wrapper.update();</span></span><br><span class="line"><span class="regexp">          const listItems = wrapper.find('[data-test="list-item"]')</span></span><br><span class="line"><span class="regexp">          expect(listItems.length).toBe(1)   </span></span><br><span class="line"><span class="regexp">          done()</span></span><br><span class="line"><span class="regexp">      &#125;,0)  </span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">&#125;)</span></span><br></pre></td></tr></table></figure>
<h2 id="前端自动化测试的优势"><a href="#前端自动化测试的优势" class="headerlink" title="前端自动化测试的优势"></a>前端自动化测试的优势</h2><ol>
<li>更好的代码组织，项目的可维护性增强</li>
<li>更小的bug 出现概率，尤其是回归测试中的 Bug</li>
<li>修改工程质量差的项目，更加安全</li>
<li>项目具备潜在的文档特性</li>
<li>扩广前端的知识面</li>
</ol>
<h2 id="Enzyme-1"><a href="#Enzyme-1" class="headerlink" title="Enzyme"></a>Enzyme</h2><p>Enzyme 是 React 的 JavaScript 测试应用程序，可以轻松测试 React Components 的输出。还可以在给定输出的情况下，遍历以某种方式模拟运行。</p>
<p>主要通过模仿 Jq 用于 DOM 操作和遍历</p>
<h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3><h4 id="at-index"><a href="#at-index" class="headerlink" title="at(index)"></a>at(index)</h4><p><code>.at(index) =&gt; shallowWrapper</code></p>
<p>返回当前 wrapper 中指定索引的节点</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wrapper = shallow(<span class="xml"><span class="tag">&lt;<span class="name">MyComponent</span> /&gt;</span>)</span></span><br><span class="line"><span class="xml">expect(wrapper.find(foo).at(0).props().foo).toEqual('bar')</span></span><br></pre></td></tr></table></figure>
<h4 id="first"><a href="#first" class="headerlink" title="first()"></a>first()</h4><p><code>.first() =&gt; ShallowWrapper</code></p>
<p>将匹配节点集合减少到集合中的第一个，就像<code>.at(0)</code>。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect(wrapper.find(Foo).first().props().foo).to.equal(<span class="string">'bar'</span>);</span><br></pre></td></tr></table></figure>
<h4 id="last"><a href="#last" class="headerlink" title="last()"></a>last()</h4><p><code>.last() =&gt; ShallowWrapper</code></p>
<p>将匹配节点集减少到集合中的最后一个，就像<code>.at(length - 1)</code>。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wrapper = shallow(<span class="xml"><span class="tag">&lt;<span class="name">MyComponent</span> /&gt;</span>);</span></span><br><span class="line"><span class="xml">expect(wrapper.find(Foo).last().props().foo).to.equal('bar');</span></span><br></pre></td></tr></table></figure>
<h4 id="childAt-index"><a href="#childAt-index" class="headerlink" title="childAt(index)"></a>childAt(index)</h4><p><code>.childAt(index) =&gt; ShallowWrapper</code></p>
<p>返回指定索引的子节点</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wrapper = shallow(<span class="xml"><span class="tag">&lt;<span class="name">TodoList</span> <span class="attr">items</span>=<span class="string">&#123;items&#125;/</span>&gt;</span>);</span></span><br><span class="line"><span class="xml">expect(wrapper.find('ul').childAt(0).type).toEqual('li')</span></span><br></pre></td></tr></table></figure>
<h4 id="children-selector"><a href="#children-selector" class="headerlink" title="children([selector])"></a>children([selector])</h4><p><code>.children([selector]) =&gt; ShallowWrapper</code></p>
<p>返回父节点某个元素的所有子节点</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wrapper = shallow(<span class="xml"><span class="tag">&lt;<span class="name">TodoList</span> <span class="attr">items</span>=<span class="string">&#123;items&#125;/</span>&gt;</span>);</span></span><br><span class="line"><span class="xml">expect(wrapper.find('ul').children.length).toEqual(items.length)</span></span><br></pre></td></tr></table></figure>
<h4 id="closest-selector"><a href="#closest-selector" class="headerlink" title="closest(selector)"></a>closest(selector)</h4><p><code>.closest(selector) =&gt; shallowWrapper</code></p>
<p>通过遍历节点祖先，返回第一个相匹配的节点</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wrapper = shallow(<span class="xml"><span class="tag">&lt;<span class="name">MyComponent</span> /&gt;</span>);</span></span><br><span class="line"><span class="xml">expect(wrapper.find(Foo).closest('.bar')).to.have.lengthOf(1);</span></span><br></pre></td></tr></table></figure>
<h4 id="contains-nodeOrNodes"><a href="#contains-nodeOrNodes" class="headerlink" title="contains(nodeOrNodes)"></a>contains(nodeOrNodes)</h4><p><code>.contains(nodeOrNodes) =&gt; Boolean</code></p>
<p>返回所有给定的react元素是否与渲染树中的元素匹配。它将通过检查期望元素是否与包装器元素具有相同的 props 并共享相同的值来确定包装器中的元素是否与预期元素匹配。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> wrapper;</span><br><span class="line">wrapper = shallow((</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;div data-foo=<span class="string">"foo"</span> data-bar=<span class="string">"bar"</span>&gt;Hello&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">));</span><br><span class="line"></span><br><span class="line">expect(wrapper.contains(<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">data-foo</span>=<span class="string">"foo"</span> <span class="attr">data-bar</span>=<span class="string">"bar"</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)).to.equal(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">expect(wrapper.contains(<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">data-foo</span>=<span class="string">"foo"</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)).to.equal(<span class="literal">false</span>);</span><br><span class="line">expect(wrapper.contains(<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">data-foo</span>=<span class="string">"foo"</span> <span class="attr">data-bar</span>=<span class="string">"bar"</span> <span class="attr">data-baz</span>=<span class="string">"baz"</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)).to.equal(<span class="literal">false</span>);</span><br><span class="line">expect(wrapper.contains(<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">data-foo</span>=<span class="string">"foo"</span> <span class="attr">data-bar</span>=<span class="string">"Hello"</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)).to.equal(<span class="literal">false</span>);</span><br><span class="line">expect(wrapper.contains(<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">data-foo</span>=<span class="string">"foo"</span> <span class="attr">data-bar</span>=<span class="string">"bar"</span> /&gt;</span>)).to.equal(false);</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">wrapper = shallow((</span></span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;span&gt;Hello&lt;/span&gt;</span><br><span class="line">    &lt;div&gt;Goodbye&lt;/div&gt;</span><br><span class="line">    &lt;span&gt;Again&lt;/span&gt;</span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">));</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">expect(wrapper.contains([</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">span</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">span</span>&gt;</span>,</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>Goodbye<span class="tag">&lt;/<span class="name">div</span>&gt;</span>,</span></span><br><span class="line"><span class="xml">])).to.equal(true);</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">expect(wrapper.contains([</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">span</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">span</span>&gt;</span>,</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>World<span class="tag">&lt;/<span class="name">div</span>&gt;</span>,</span></span><br><span class="line"><span class="xml">])).to.equal(false);</span></span><br></pre></td></tr></table></figure>
<h4 id="containsAllMatchingElements-patternNodes"><a href="#containsAllMatchingElements-patternNodes" class="headerlink" title="containsAllMatchingElements(patternNodes)"></a>containsAllMatchingElements(patternNodes)</h4><p><code>.containsAllMatchingElements(patternNodes) =&gt; Boolean</code></p>
<p>返回所有给定的react元素是否<code>patternNodes</code>与包装器的渲染树中的元素匹配。每个元素<code>patternNodes</code>必须匹配一次或多次。匹配遵循规则<code>containsMatchingElement</code>。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> style = &#123; <span class="attr">fontSize</span>: <span class="number">13</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> wrapper = shallow((</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;span className=<span class="string">"foo"</span>&gt;Hello&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">    &lt;div style=&#123;style&#125;&gt;Goodbye&lt;/</span>div&gt;</span><br><span class="line">    &lt;span&gt;Again&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">));</span><br><span class="line"></span><br><span class="line">expect(wrapper.containsAllMatchingElements([</span><br><span class="line">  &lt;span&gt;Hello&lt;<span class="regexp">/span&gt;,</span></span><br><span class="line"><span class="regexp">  &lt;div&gt;Goodbye&lt;/</span>div&gt;,</span><br><span class="line">])).to.equal(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>
<h4 id="containsAnyMatchingElements-patternNodes"><a href="#containsAnyMatchingElements-patternNodes" class="headerlink" title="containsAnyMatchingElements(patternNodes)"></a>containsAnyMatchingElements(patternNodes)</h4><p><code>.containsAnyMatchingElements(patternNodes) =&gt; Boolean</code></p>
<p>返回至少一个给定的react元素是否<code>patternNodes</code>与包装器的渲染树中的元素匹配。一个或多个元素<code>patternNodes</code>必须匹配一次或多次。匹配遵循规则<code>containsMatchingElement</code>。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> style = &#123; <span class="attr">fontSize</span>: <span class="number">13</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> wrapper = shallow((</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;span className=<span class="string">"foo"</span>&gt;Hello&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">    &lt;div style=&#123;style&#125;&gt;Goodbye&lt;/</span>div&gt;</span><br><span class="line">    &lt;span&gt;Again&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">));</span><br><span class="line"></span><br><span class="line">expect(wrapper.containsAnyMatchingElements([</span><br><span class="line">  &lt;span&gt;Bonjour&lt;<span class="regexp">/span&gt;,</span></span><br><span class="line"><span class="regexp">  &lt;div&gt;Goodbye&lt;/</span>div&gt;,</span><br><span class="line">])).to.equal(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>
<h4 id="containsMatchingElement-patternNode"><a href="#containsMatchingElement-patternNode" class="headerlink" title="containsMatchingElement(patternNode)"></a>containsMatchingElement(patternNode)</h4><p><code>.containsMatchingElement(patternNode) =&gt; Boolean</code></p>
<p>返回<code>patternNode</code>react元素是否与渲染树中的任何元素匹配。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wrapper = shallow((</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;div data-foo=<span class="string">"foo"</span> data-bar=<span class="string">"bar"</span>&gt;Hello&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">));</span><br><span class="line"></span><br><span class="line">expect(wrapper.containsMatchingElement(<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">data-foo</span>=<span class="string">"foo"</span> <span class="attr">data-bar</span>=<span class="string">"bar"</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)).to.equal(<span class="literal">true</span>);</span><br><span class="line">expect(wrapper.containsMatchingElement(<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">data-foo</span>=<span class="string">"foo"</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)).to.equal(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">expect(wrapper.containsMatchingElement(<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">data-foo</span>=<span class="string">"foo"</span> <span class="attr">data-bar</span>=<span class="string">"bar"</span> <span class="attr">data-baz</span>=<span class="string">"baz"</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)).to.equal(<span class="literal">false</span>);</span><br><span class="line">expect(wrapper.containsMatchingElement(<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">data-foo</span>=<span class="string">"foo"</span> <span class="attr">data-bar</span>=<span class="string">"Hello"</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)).to.equal(<span class="literal">false</span>);</span><br><span class="line">expect(wrapper.containsMatchingElement(<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">data-foo</span>=<span class="string">"foo"</span> <span class="attr">data-bar</span>=<span class="string">"bar"</span> /&gt;</span>)).to.equal(false);</span></span><br></pre></td></tr></table></figure>
<h4 id="context-key"><a href="#context-key" class="headerlink" title="context([key])"></a>context([key])</h4><p>返回包装器根节点的上下文哈希。可选地传入一个props，它将只返回该值。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wrapper = shallow(</span><br><span class="line">  &lt;MyComponent /&gt;,</span><br><span class="line">  &#123; <span class="attr">context</span>: &#123; <span class="attr">foo</span>: <span class="number">10</span> &#125; &#125;,</span><br><span class="line">);</span><br><span class="line">expect(wrapper.context().foo).to.equal(<span class="number">10</span>);</span><br><span class="line">expect(wrapper.context(<span class="string">'foo'</span>)).to.equal(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>
<h4 id="debug-options"><a href="#debug-options" class="headerlink" title="debug([options])"></a>debug([options])</h4><p><code>.debug([options]) =&gt; String</code></p>
<p>返回包装器的类似HTML的字符串，以便进行调试。当测试没有通过时，打印到控制台很有用。</p>
<p><code>options</code>（<code>Object</code>[可选]）：</p>
<ul>
<li><code>options.ignoreProps</code>：（<code>Boolean</code>[可选]）：是否应在结果字符串中省略props。默认情况下包含道具。</li>
<li><code>options.verbose</code>：（<code>Boolean</code>[可选]）：是否应该详细打印作为道具传递的数组和对象。</li>
</ul>
<h4 id="dive-options"><a href="#dive-options" class="headerlink" title="dive([options])"></a>dive([options])</h4><p><code>.dive([options]) =&gt; ShallowWrapper</code></p>
<p>浅呈现当前包装器的一个非DOM子项，并返回结果周围的包装器。它必须是单节点包装器，并且该节点必须是React组件。</p>
<p>注意：只能在单个非DOM组件元素节点的包装上调用，否则会引发错误。如果必须使用多个子节点对包装器进行浅包装，请使用<code>.shallow（）</code></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div className=<span class="string">"in-bar"</span> /&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">function Foo() &#123;</span></span><br><span class="line"><span class="regexp">  return (</span></span><br><span class="line"><span class="regexp">    &lt;div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;Bar /</span>&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">const wrapper = shallow(&lt;Foo /</span>&gt;);</span><br><span class="line">expect(wrapper.find(<span class="string">'.in-bar'</span>)).to.have.lengthOf(<span class="number">0</span>);</span><br><span class="line">expect(wrapper.find(Bar)).to.have.lengthOf(<span class="number">1</span>);</span><br><span class="line">expect(wrapper.find(Bar).dive().find(<span class="string">'.in-bar'</span>)).to.have.lengthOf(<span class="number">1</span>);</span><br></pre></td></tr></table></figure>
<h4 id="equals-node"><a href="#equals-node" class="headerlink" title="equals(node)"></a>equals(node)</h4><p><code>.equals(node) =&gt; Boolean</code></p>
<p>返回当前包装器根节点呈现树是否与传入的树相似</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wrapper = shallow(<span class="xml"><span class="tag">&lt;<span class="name">MyComponent</span> /&gt;</span>);</span></span><br><span class="line">expect(wrapper.equals(&lt;div className="foo bar" /&gt;)).to.equal(true);</span><br></pre></td></tr></table></figure>
<h4 id="every-selector"><a href="#every-selector" class="headerlink" title="every(selector)"></a>every(selector)</h4><p><code>.every(selector) =&gt; Boolean</code></p>
<p>返回包装器中的所有节点是否与提供的选择器匹配。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wrapper = shallow((</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;div className=<span class="string">"foo qoo"</span> /&gt;</span><br><span class="line">    &lt;div className=<span class="string">"foo boo"</span> /&gt;</span><br><span class="line">    &lt;div className=<span class="string">"foo hoo"</span> /&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">));</span></span><br><span class="line"><span class="regexp">expect(wrapper.find('.foo').every('.foo')).to.equal(true);</span></span><br><span class="line"><span class="regexp">expect(wrapper.find('.foo').every('.qoo')).to.equal(false);</span></span><br><span class="line"><span class="regexp">expect(wrapper.find('.foo').every('.bar')).to.equal(false);</span></span><br></pre></td></tr></table></figure>
<h4 id="everyWhere-fn"><a href="#everyWhere-fn" class="headerlink" title="everyWhere(fn)"></a>everyWhere(fn)</h4><p><code>.everyWhere(fn) =&gt; Boolean</code></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wrapper = shallow((</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;div className=<span class="string">"foo qoo"</span> /&gt;</span><br><span class="line">    &lt;div className=<span class="string">"foo boo"</span> /&gt;</span><br><span class="line">    &lt;div className=<span class="string">"foo hoo"</span> /&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">));</span></span><br><span class="line"><span class="regexp">expect(wrapper.find('.foo').everyWhere(n =&gt; n.hasClass('foo'))).to.equal(true);</span></span><br><span class="line"><span class="regexp">expect(wrapper.find('.foo').everyWhere(n =&gt; n.hasClass('qoo'))).to.equal(false);</span></span><br><span class="line"><span class="regexp">expect(wrapper.find('.foo').everyWhere(n =&gt; n.hasClass('bar'))).to.equal(false);</span></span><br></pre></td></tr></table></figure>
<h4 id="exists-selector"><a href="#exists-selector" class="headerlink" title="exists([selector])"></a>exists([selector])</h4><p><code>.exists([selector]) =&gt; Boolean</code></p>
<p>返回包装器中是否存在任何节点。或者，如果传入选择器，则该选择器是否在包装器中具有任何匹配项。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wrapper = mount(<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"some-class"</span> /&gt;</span>);</span></span><br><span class="line"><span class="xml">expect(wrapper.exists('.some-class')).to.equal(true);</span></span><br><span class="line"><span class="xml">expect(wrapper.find('.other-class').exists()).to.equal(false);</span></span><br></pre></td></tr></table></figure>
<h4 id="filter-selector"><a href="#filter-selector" class="headerlink" title="filter(selector)"></a>filter(selector)</h4><p><code>.filter(selector) =&gt; ShallowWrapper</code></p>
<p>返回一个新的包装器，其中只包含与提供的选择器匹配的当前包装器的节点。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wrapper = shallow(<span class="xml"><span class="tag">&lt;<span class="name">MyComponent</span> /&gt;</span>);</span></span><br><span class="line"><span class="xml">expect(wrapper.find('.foo').filter('.bar')).to.have.lengthOf(1);</span></span><br></pre></td></tr></table></figure>
<h4 id="filterWhere-fn"><a href="#filterWhere-fn" class="headerlink" title="filterWhere(fn)"></a>filterWhere(fn)</h4><p><code>.filterWhere(fn) =&gt; ShallowWrapper</code></p>
<p>返回一个新的包装器，它只包含当前包装器的节点，当传递给提供的谓词函数时，返回true</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wrapper = shallow(<span class="xml"><span class="tag">&lt;<span class="name">MyComponent</span> /&gt;</span>);</span></span><br><span class="line"><span class="xml">const complexFoo = wrapper.find('.foo').filterWhere(n =&gt; typeof n.type() !== 'string');</span></span><br><span class="line"><span class="xml">expect(complexFoo).to.have.lengthOf(4);</span></span><br></pre></td></tr></table></figure>
<h4 id="find-selector"><a href="#find-selector" class="headerlink" title="find(selector)"></a>find(selector)</h4><p><code>.find(selector) =&gt; ShallowWrapper</code></p>
<p>查找当前包装器的呈现树中与提供的选择器匹配的每个节点。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Foo <span class="keyword">from</span> <span class="string">'../components/Foo'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> wrapper = shallow(<span class="xml"><span class="tag">&lt;<span class="name">MyComponent</span> /&gt;</span>);</span></span><br><span class="line"><span class="xml">expect(wrapper.find('.foo')).to.have.lengthOf(1);</span></span><br><span class="line"><span class="xml">expect(wrapper.find('.bar')).to.have.lengthOf(3);</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">// compound selector</span></span><br><span class="line"><span class="xml">expect(wrapper.find('div.some-class')).to.have.lengthOf(3);</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">// CSS id selector</span></span><br><span class="line"><span class="xml">expect(wrapper.find('#foo')).to.have.lengthOf(1);</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">// 组件</span></span><br><span class="line"><span class="xml">expect(wrapper.find(Foo)).to.have.lengthOf(1);</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">// 组件显示名称</span></span><br><span class="line"><span class="xml">expect(wrapper.find('Foo')).to.have.lengthOf(1);</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">// 对象属性选择器</span></span><br><span class="line"><span class="xml">expect(wrapper.find(&#123; prop: 'value' &#125;)).to.have.lengthOf(1);</span></span><br></pre></td></tr></table></figure>
<h4 id="findWhere-fn"><a href="#findWhere-fn" class="headerlink" title="findWhere(fn)"></a>findWhere(fn)</h4><p><code>.findWhere(fn) =&gt; ShallowWrapper</code></p>
<p>查找渲染树中为提供的谓词函数返回true的每个节点。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wrapper = shallow(<span class="xml"><span class="tag">&lt;<span class="name">MyComponent</span> /&gt;</span>);</span></span><br><span class="line"><span class="xml">const complexComponents = wrapper.findWhere(n =&gt; n.type() !== 'string');</span></span><br><span class="line"><span class="xml">expect(complexComponents).to.have.lengthOf(8);</span></span><br></pre></td></tr></table></figure>
<h4 id="forEach-fn"><a href="#forEach-fn" class="headerlink" title="forEach(fn)"></a>forEach(fn)</h4><p><code>.forEach(fn) =&gt; Self</code></p>
<p>迭代当前包装器的每个节点，并使用围绕作为第一个参数传入的相应节点的包装器执行提供的函数。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wrapper = shallow((</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;div className=<span class="string">"foo bax"</span> /&gt;</span><br><span class="line">    &lt;div className=<span class="string">"foo bar"</span> /&gt;</span><br><span class="line">    &lt;div className=<span class="string">"foo baz"</span> /&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">));</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">wrapper.find('.foo').forEach((node) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  expect(node.hasClass('foo')).to.equal(true);</span></span><br><span class="line"><span class="regexp">&#125;);</span></span><br></pre></td></tr></table></figure>
<h4 id="get-index"><a href="#get-index" class="headerlink" title="get(index)"></a>get(index)</h4><p><code>.get(index) =&gt; ReactElement</code></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wrapper = shallow(<span class="xml"><span class="tag">&lt;<span class="name">MyComponent</span> /&gt;</span>);</span></span><br><span class="line"><span class="xml">expect(wrapper.find(Foo).get(0).props.foo).to.equal('bar');</span></span><br></pre></td></tr></table></figure>
<h4 id="getWrappingComponent"><a href="#getWrappingComponent" class="headerlink" title="getWrappingComponent()"></a>getWrappingComponent()</h4><p><code>.getWrappingComponent() =&gt; ShallowWrapper</code></p>
<p>如果<code>wrappingComponent</code>传入了a <code>options</code>，则此方法返回<code>ShallowWrapper</code>渲染的周围<code>wrappingComponent</code>。这<code>ShallowWrapper</code>可以用来更新<code>wrappingComponent</code> props，state等。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Router &#125; <span class="keyword">from</span> <span class="string">'react-router'</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'./my/app/store'</span>;</span><br><span class="line"><span class="keyword">import</span> mockStore <span class="keyword">from</span> <span class="string">'./my/app/mockStore'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyProvider</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; children, customStore &#125; = props;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Provider store=&#123;customStore || store&#125;&gt;</span><br><span class="line">      &lt;Router&gt;</span><br><span class="line">        &#123;children&#125;</span><br><span class="line">      &lt;<span class="regexp">/Router&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>Provider&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line">MyProvider.propTypes = &#123;</span><br><span class="line">  children: PropTypes.node,</span><br><span class="line">  customStore: PropTypes.shape(&#123;&#125;),</span><br><span class="line">&#125;;</span><br><span class="line">MyProvider.defaultProps = &#123;</span><br><span class="line">  children: <span class="literal">null</span>,</span><br><span class="line">  customStore: <span class="literal">null</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> wrapper = shallow(<span class="xml"><span class="tag">&lt;<span class="name">MyComponent</span> /&gt;</span>, &#123;</span></span><br><span class="line"><span class="xml">  wrappingComponent: MyProvider,</span></span><br><span class="line"><span class="xml">&#125;);</span></span><br><span class="line"><span class="xml">const provider = wrapper.getWrappingComponent();</span></span><br><span class="line"><span class="xml">provider.setProps(&#123; customStore: mockStore &#125;);</span></span><br></pre></td></tr></table></figure>
<h4 id="getElement"><a href="#getElement" class="headerlink" title="getElement()"></a>getElement()</h4><p><code>.getElement() =&gt; ReactElement</code></p>
<p>返回包装的ReactElement。如果当前包装器正在包装根组件，则返回根组件的最新呈现输出。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> element = (</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;span /&gt;</span><br><span class="line">    &lt;span /&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">);</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">function MyComponent() &#123;</span></span><br><span class="line"><span class="regexp">  return element;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const wrapper = shallow(&lt;MyComponent /</span>&gt;);</span><br><span class="line">expect(wrapper.getElement()).to.equal(element);</span><br></pre></td></tr></table></figure>
<h4 id="getElements"><a href="#getElements" class="headerlink" title="getElements()"></a>getElements()</h4><p><code>.getElements() =&gt; Array&lt;ReactElement&gt;</code></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> one = <span class="xml"><span class="tag">&lt;<span class="name">span</span> /&gt;</span>;</span></span><br><span class="line"><span class="xml">const two = <span class="tag">&lt;<span class="name">span</span> /&gt;</span>;</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">function Test() &#123;</span></span><br><span class="line"><span class="xml">  return (</span></span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &#123;one&#125;</span><br><span class="line">      &#123;two&#125;</span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">  );</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">const wrapper = shallow(<span class="tag">&lt;<span class="name">Test</span> /&gt;</span>);</span></span><br><span class="line"><span class="xml">expect(wrapper.find('span').getElements()).to.deep.equal([one, two]);</span></span><br></pre></td></tr></table></figure>
<h4 id="hasClass-className"><a href="#hasClass-className" class="headerlink" title="hasClass(className)"></a>hasClass(className)</h4><p><code>.hasClass(className) =&gt; Boolean</code></p>
<p>返回包装节点是否具有<code>className</code>包含传入的类名称的prop。它必须是单节点包装器。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wrapper = shallow(<span class="xml"><span class="tag">&lt;<span class="name">MyComponent</span> /&gt;</span>);</span></span><br><span class="line"><span class="xml">expect(wrapper.find('.my-button').hasClass('disabled')).to.equal(true);</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">// 正则</span></span><br><span class="line"><span class="xml">expect(wrapper.find('.my-button').hasClass(/(ComponentName)-(other)-(\d+)/)).to.equal(true);</span></span><br></pre></td></tr></table></figure>
<h4 id="hostNodes"><a href="#hostNodes" class="headerlink" title="hostNodes()"></a>hostNodes()</h4><p><code>.hostNodes() =&gt; ShallowWrapper</code></p>
<p>返回仅包含主机节点的新包装器。当使用<code>react-dom</code>，主机节点是HTML元素，而不是定制反应的组分</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wrapper = shallow((</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;MyComponent className=<span class="string">"foo"</span> /&gt;</span><br><span class="line">    &lt;span className=<span class="string">"foo"</span> /&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">));</span></span><br><span class="line"><span class="regexp">const twoNodes = wrapper.find('.foo');</span></span><br><span class="line"><span class="regexp">expect(twoNodes.hostNodes()).to.have.lengthOf(1);</span></span><br></pre></td></tr></table></figure>
<h4 id="html"><a href="#html" class="headerlink" title="html()"></a>html()</h4><p><code>.html() =&gt; String</code></p>
<p>返回整个当前渲染树（不仅仅是浅渲染部分）的渲染HTML标记的字符串。只能在单个节点的包装器上调用</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"in-foo"</span> /&gt;</span>);</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">function Bar() &#123;</span></span><br><span class="line"><span class="xml">  return (</span></span><br><span class="line">    &lt;div className="in-bar"&gt;</span><br><span class="line">      &lt;Foo /&gt;</span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">  );</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">const wrapper = shallow(<span class="tag">&lt;<span class="name">Bar</span> /&gt;</span>);</span></span><br><span class="line"><span class="xml">expect(wrapper.html()).to.equal('<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"in-bar"</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"in-foo"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span>');</span></span><br><span class="line"><span class="xml">expect(wrapper.find(Foo).html()).to.equal('<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"in-foo"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span>');</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">const wrapper = shallow(<span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>important<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span>);</span></span><br><span class="line"><span class="xml">expect(wrapper.html()).to.equal('<span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>important<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span>');</span></span><br></pre></td></tr></table></figure>
<h4 id="instance"><a href="#instance" class="headerlink" title="instance()"></a>instance()</h4><p><code>.instance() =&gt; ReactComponent</code></p>
<p>返回单节点包装器节点的底层类实例; <code>this</code>在它的方法。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Stateless</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Stateless<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Stateful</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Stateful<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test(<span class="string">'shallow wrapper instance should be null'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> wrapper = shallow(<span class="xml"><span class="tag">&lt;<span class="name">Stateless</span> /&gt;</span>);</span></span><br><span class="line"><span class="xml">  const instance = wrapper.instance();</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">  expect(instance).to.equal(null);</span></span><br><span class="line"><span class="xml">&#125;);</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">test('shallow wrapper instance should not be null', () =&gt; &#123;</span></span><br><span class="line"><span class="xml">  const wrapper = shallow(<span class="tag">&lt;<span class="name">Stateful</span> /&gt;</span>);</span></span><br><span class="line"><span class="xml">  const instance = wrapper.instance();</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">  expect(instance).to.be.instanceOf(Stateful);</span></span><br><span class="line"><span class="xml">&#125;);</span></span><br></pre></td></tr></table></figure>
<h4 id="is-selector"><a href="#is-selector" class="headerlink" title="is(selector)"></a>is(selector)</h4><p><code>.is(selector) =&gt; Boolean</code></p>
<p>返回单个包装节点是否与提供的选择器匹配。它必须是单节点包装器。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wrapper = shallow(<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"some-class other-class"</span> /&gt;</span>);</span></span><br><span class="line"><span class="xml">expect(wrapper.is('.some-class')).to.equal(true);</span></span><br></pre></td></tr></table></figure>
<h4 id="isEmptyRender"><a href="#isEmptyRender" class="headerlink" title="isEmptyRender()"></a>isEmptyRender()</h4><p><code>.isEmptyRender() =&gt; Boolean</code></p>
<p>返回包装器是否最终只呈现允许的假值：<code>false</code>或<code>null</code>。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> wrapper = shallow(<span class="xml"><span class="tag">&lt;<span class="name">Foo</span> /&gt;</span>);</span></span><br><span class="line"><span class="xml">expect(wrapper.isEmptyRender()).to.equal(true);</span></span><br></pre></td></tr></table></figure>
<h4 id="key"><a href="#key" class="headerlink" title="key()"></a>key()</h4><p><code>.key() =&gt; String</code></p>
<p>返回当前包装器节点的键值。它必须是单节点包装器。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wrapper = shallow((</span><br><span class="line">  &lt;ul&gt;</span><br><span class="line">    &#123;[<span class="string">'foo'</span>, <span class="string">'bar'</span>].map(<span class="function"><span class="params">s</span> =&gt;</span> &lt;li key=&#123;s&#125;&gt;&#123;s&#125;&lt;<span class="regexp">/li&gt;)&#125;</span></span><br><span class="line"><span class="regexp">  &lt;/u</span>l&gt;</span><br><span class="line">)).find(<span class="string">'li'</span>);</span><br><span class="line">expect(wrapper.at(<span class="number">0</span>).key()).to.equal(<span class="string">'foo'</span>);</span><br><span class="line">expect(wrapper.at(<span class="number">1</span>).key()).to.equal(<span class="string">'bar'</span>);</span><br></pre></td></tr></table></figure>
<h4 id="map-fn"><a href="#map-fn" class="headerlink" title="map(fn)"></a>map(fn)</h4><p><code>.map(fn) =&gt; Array&lt;Any&gt;</code></p>
<p>将当前节点数组映射到另一个数组。每个节点作为a传递<code>ShallowWrapper</code> 给map函数。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wrapper = shallow((</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;div className=<span class="string">"foo"</span>&gt;bax&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;div className="foo"&gt;bar&lt;/</span>div&gt;</span><br><span class="line">    &lt;div className=<span class="string">"foo"</span>&gt;baz&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">));</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> texts = wrapper.find(<span class="string">'.foo'</span>).map(<span class="function"><span class="params">node</span> =&gt;</span> node.text());</span><br><span class="line">expect(texts).to.eql([<span class="string">'bax'</span>, <span class="string">'bar'</span>, <span class="string">'baz'</span>]);</span><br></pre></td></tr></table></figure>
<h4 id="matchesElement-patternNode"><a href="#matchesElement-patternNode" class="headerlink" title="matchesElement(patternNode)"></a>matchesElement(patternNode)</h4><p><code>.matchesElement(patternNode) =&gt; Boolean</code></p>
<p>回给定的react元素是否<code>patternNode</code>与包装器的渲染树匹配。它必须是单节点包装器，并且仅检查根节点。</p>
<p>这些<code>patternNode</code>行为就像一张通配符。为了匹配包装器中的节点：</p>
<ul>
<li>标签名称必须匹配</li>
<li>内容必须匹配：在文本节点中，前导和尾随空格被忽略，但中间空间不被忽略。子元素必须根据这些规则以递归方式匹配。</li>
<li><code>patternNode</code>props（attributes）必须出现在包装器的节点中，而不是相反。如果它们出现，它们的值必须匹配。</li>
<li><code>patternNode</code>样式CSS属性必须出现在包装器节点的样式中，而不是相反。如果它们出现，它们的值必须匹配。</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.handleClick = <span class="keyword">this</span>.handleClick.bind(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleClick() &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;button type=<span class="string">"button"</span> onClick=&#123;<span class="keyword">this</span>.handleClick&#125; className=<span class="string">"foo bar"</span>&gt;Hello&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const wrapper = shallow(&lt;MyComponent /</span>&gt;);</span><br><span class="line">expect(wrapper.matchesElement(<span class="xml"><span class="tag">&lt;<span class="name">button</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>)).to.equal(<span class="literal">true</span>);</span><br><span class="line">expect(wrapper.matchesElement(<span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">"foo bar"</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>)).to.equal(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>
<h4 id="name"><a href="#name" class="headerlink" title="name()"></a>name()</h4><p><code>.name() =&gt; String|null</code></p>
<p>返回此包装器的当前节点的名称。如果它是复合组件，则这将是最顶层渲染组件的名称。如果它是本机DOM节点，则它将是标记名称的字符串。如果是的话<code>null</code>，那就是<code>null</code>。</p>
<p>返回名称的优先顺序是：<code>type.displayName</code>- &gt; <code>type.name</code>- &gt; <code>type</code>。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wrapper = shallow(<span class="xml"><span class="tag">&lt;<span class="name">div</span> /&gt;</span>);</span></span><br><span class="line"><span class="xml">expect(wrapper.name()).to.equal('div');</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">function SomeWrappingComponent() &#123;</span></span><br><span class="line"><span class="xml">  return <span class="tag">&lt;<span class="name">Foo</span> /&gt;</span>;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"><span class="xml">const wrapper = shallow(<span class="tag">&lt;<span class="name">SomeWrappingComponent</span> /&gt;</span>);</span></span><br><span class="line"><span class="xml">expect(wrapper.name()).to.equal('Foo');</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">Foo.displayName = 'A cool custom name';</span></span><br><span class="line"><span class="xml">function SomeWrappingComponent() &#123;</span></span><br><span class="line"><span class="xml">  return <span class="tag">&lt;<span class="name">Foo</span> /&gt;</span>;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"><span class="xml">const wrapper = shallow(<span class="tag">&lt;<span class="name">SomeWrappingComponent</span> /&gt;</span>);</span></span><br><span class="line"><span class="xml">expect(wrapper.name()).to.equal('A cool custom name');</span></span><br></pre></td></tr></table></figure>
<h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><ol>
<li><a href="https://coding.imooc.com/class/372.html">前端要学的测试课 从Jest入门到TDD/BDD双实战</a></li>
<li><a href="https://jestjs.io/en/">jest 官方文档</a></li>
<li><a href="https://airbnb.io/enzyme/">enzyme官方文档</a></li>
</ol>

      
    </div>
    
    
    

    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    赖彬鸿
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://laibh.top/2019-08-19-前端必备的测试学习.html" title="前端必备的测试">http://laibh.top/2019-08-19-前端必备的测试学习.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/测试/" <i class="fa fa-tag"></i> 测试</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019-08-08-工欲善其事，必先利其器(eslint+prettier).html" rel="next" title="工欲善其事，必先利其器(eslint+prettier)">
                <i class="fa fa-chevron-left"></i> 工欲善其事，必先利其器(eslint+prettier)
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019-09-03-基于ts重构axios.html" rel="prev" title="基于ts重构axios">
                基于ts重构axios <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
        
  <script>
    window._bd_share_config = {
      "common": {
        "bdText": "",
        "bdMini": "1",
        "bdMiniList": false,
        "bdPic": ""
      },
      "image": {
        "viewList": ["tsina", "douban", "sqq", "qzone", "weixin", "twi", "fbook"],
        "viewText": "分享到：",
        "viewSize": "16"
      },
      "slide": {
        "bdImg": "5",
        "bdPos": "left",
        "bdTop": "100"
      }
    }
  </script>

<script>
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/static/api/js/share.js?v=89860593.js?'+~(-new Date()/36e5)];;
</script>

      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC8zOTcwMy8xNjIzMA"></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/myPhoto.jpg"
                alt="赖彬鸿" />
            
              <p class="site-author-name" itemprop="name">赖彬鸿</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">135</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">32</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">40</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          
          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/LbhFront-end" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.cnblogs.com/lbh2018/" target="_blank" title="博客园">
                      
                        <i class="fa fa-fw fa-globe"></i>博客园</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://yq.aliyun.com/users/1802204154913774?spm=a2c4e.11153940.blogcont662526.4.6c0a34f6E2lR5o" target="_blank" title="云栖">
                      
                        <i class="fa fa-fw fa-globe"></i>云栖</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:544289495@qq.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=544289495&website=www.oicqzone.com" target="_blank" title="QQ">
                      
                        <i class="fa fa-fw fa-qq"></i>QQ</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.google.com.hk/search?safe=strict&source=hp&ei=JtLCXIriJ8G4-gS_-4qABQ&q=site%3Alaibh.top&btnK=Google+%E6%90%9C%E7%B4%A2&oq=site%3Alaibh.top&gs_l=psy-ab.3...1158.6834..7051...5.0..1.246.3720.2-17......0....1..gws-wiz.....0..0j0i10.rJMUHvdrbds" target="_blank" title="Google">
                      
                        <i class="fa fa-fw fa-google"></i>Google</a>
                  </span>
                
            </div>
          
         <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=90  src="//music.163.com/outchain/player?type=0&id=2353471182&auto=0&height=90"></iframe>
          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                友情链接
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.chjtx.com/JRoll/" title="醉萝卜" target="_blank">醉萝卜</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://hzd.plus/" title="Zhendong" target="_blank">Zhendong</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.cnblogs.com/cnyball" title="cnyballk" target="_blank">cnyballk</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://johnzz.top/" title="John" target="_blank">John</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://xiaojun1994.top/" title="xiaojun1994" target="_blank">xiaojun1994</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://me.ursb.me" title="Airing" target="_blank">Airing</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.iyouhun.com" title="游魂" target="_blank">游魂</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://icoty.github.io/" title="荒野之萍" target="_blank">荒野之萍</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://im-one.github.io/" title="imOne" target="_blank">imOne</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://blog.hourxu.com/" title="Ambre" target="_blank">Ambre</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.huyujs.com" title="胡雨" target="_blank">胡雨</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.andou.live" title="安逗" target="_blank">安逗</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.jianshu.com/u/701a8bbf4f7e" title="陈健斌" target="_blank">陈健斌</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://itobys.github.io/" title="汤姆Tom酱" target="_blank">汤姆Tom酱</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://breeze2.github.io/blog/" title="林毅锋" target="_blank">林毅锋</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.qzroc.com/" title="大鹏博客" target="_blank">大鹏博客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://lyreal666.com/" title="余腾靖的博客" target="_blank">余腾靖的博客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://buzuosheng.com/" title="不作声" target="_blank">不作声</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.baidu.com/s?ie=UTF-8&wd=site%3Alaibh.top" title="百度" target="_blank">百度</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.google.com.hk/search?safe=strict&source=hp&ei=zXdWXfemLJbO0PEP8qyXyA0&q=site%3Alaibh.top&oq=site%3Alaibh.top&gs_l=psy-ab.3...580.8501..8767...0.0..0.397.934.2-1j2......0....2j1..gws-wiz.QESXfWGadT0&ved=0ahUKEwi3wbusiofkAhUWJzQIHXLWBdkQ4dUDCAU&uact=5" title="谷歌" target="_blank">谷歌</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#前端必备的测试"><span class="nav-number">1.</span> <span class="nav-text">前端必备的测试</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#初识测试"><span class="nav-number">1.1.</span> <span class="nav-text">初识测试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#自动化框架：Jest"><span class="nav-number">1.2.</span> <span class="nav-text">自动化框架：Jest</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#简单配置"><span class="nav-number">1.2.1.</span> <span class="nav-text">简单配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#babelrc"><span class="nav-number">1.2.2.</span> <span class="nav-text">babelrc</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#常用匹配器（Matchers）"><span class="nav-number">1.3.</span> <span class="nav-text">常用匹配器（Matchers）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#数字"><span class="nav-number">1.3.1.</span> <span class="nav-text">数字</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#toBe"><span class="nav-number">1.3.1.1.</span> <span class="nav-text">.toBe()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#toEqual-value"><span class="nav-number">1.3.1.2.</span> <span class="nav-text">.toEqual(value)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#toBeGreaterThan-number"><span class="nav-number">1.3.1.3.</span> <span class="nav-text">.toBeGreaterThan(number)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#toBeGreaterThanOrEqual-number"><span class="nav-number">1.3.1.4.</span> <span class="nav-text">.toBeGreaterThanOrEqual(number)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#toBeLessThan-number"><span class="nav-number">1.3.1.5.</span> <span class="nav-text">.toBeLessThan(number)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#toBeLessThanOrEqual-number"><span class="nav-number">1.3.1.6.</span> <span class="nav-text">.toBeLessThanOrEqual(number)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#toBeCloseTo-number-numDigits"><span class="nav-number">1.3.1.7.</span> <span class="nav-text">.toBeCloseTo(number,numDigits?)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#toBeNaN"><span class="nav-number">1.3.1.8.</span> <span class="nav-text">.toBeNaN()</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#真假"><span class="nav-number">1.3.2.</span> <span class="nav-text">真假</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#toBeNull"><span class="nav-number">1.3.2.1.</span> <span class="nav-text">.toBeNull()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#toBeUndefined"><span class="nav-number">1.3.2.2.</span> <span class="nav-text">.toBeUndefined()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#toBeDefined"><span class="nav-number">1.3.2.3.</span> <span class="nav-text">.toBeDefined()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#toBeTruthy"><span class="nav-number">1.3.2.4.</span> <span class="nav-text">.toBeTruthy()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#toBeFalsy"><span class="nav-number">1.3.2.5.</span> <span class="nav-text">.toBeFalsy()</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#否定"><span class="nav-number">1.3.3.</span> <span class="nav-text">否定</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#not"><span class="nav-number">1.3.3.1.</span> <span class="nav-text">.not</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#expect-not-arrayContaining-array"><span class="nav-number">1.3.3.2.</span> <span class="nav-text">expect.not.arrayContaining(array)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#expect-not-objectContaining-object"><span class="nav-number">1.3.3.3.</span> <span class="nav-text">expect.not.objectContaining(object)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#expect-not-stringContaining-string"><span class="nav-number">1.3.3.4.</span> <span class="nav-text">expect.not.stringContaining(string)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#expect-not-stringMatching-string-regexp"><span class="nav-number">1.3.3.5.</span> <span class="nav-text">expect.not.stringMatching(string|regexp)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#字符串"><span class="nav-number">1.3.4.</span> <span class="nav-text">字符串</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#toMatch-regexpOrString"><span class="nav-number">1.3.4.1.</span> <span class="nav-text">.toMatch(regexpOrString)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#expect-stringContaining-string"><span class="nav-number">1.3.4.2.</span> <span class="nav-text">expect.stringContaining(string)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#expect-stringMatching-string-regexp"><span class="nav-number">1.3.4.3.</span> <span class="nav-text">expect.stringMatching(string|regexp)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数组"><span class="nav-number">1.3.5.</span> <span class="nav-text">数组</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#expect-toContain"><span class="nav-number">1.3.5.1.</span> <span class="nav-text">expect.toContain()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#expect-arrayContaining-array"><span class="nav-number">1.3.5.2.</span> <span class="nav-text">expect.arrayContaining(array)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#对象"><span class="nav-number">1.3.6.</span> <span class="nav-text">对象</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#objectContaining-object"><span class="nav-number">1.3.6.1.</span> <span class="nav-text">objectContaining(object)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#toHaveProperty-keyPath-value"><span class="nav-number">1.3.6.2.</span> <span class="nav-text">.toHaveProperty(keyPath,value?)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#toMatchObject-object"><span class="nav-number">1.3.6.3.</span> <span class="nav-text">.toMatchObject(object)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#类"><span class="nav-number">1.3.7.</span> <span class="nav-text">类</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#toBeInstanceOf-Class"><span class="nav-number">1.3.7.1.</span> <span class="nav-text">.toBeInstanceOf(Class)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#异常"><span class="nav-number">1.3.8.</span> <span class="nav-text">异常</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#toThrow-error"><span class="nav-number">1.3.8.1.</span> <span class="nav-text">.toThrow(error?)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#任意"><span class="nav-number">1.3.9.</span> <span class="nav-text">任意</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#expect-anything"><span class="nav-number">1.3.9.1.</span> <span class="nav-text">expect.anything()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#expect-any-constructor"><span class="nav-number">1.3.9.2.</span> <span class="nav-text">expect.any(constructor)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#toHaveLength-number"><span class="nav-number">1.3.9.3.</span> <span class="nav-text">.toHaveLength(number)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#toContain-item"><span class="nav-number">1.3.9.4.</span> <span class="nav-text">.toContain(item)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#toContainEqual-item"><span class="nav-number">1.3.9.5.</span> <span class="nav-text">.toContainEqual(item)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#异步相关"><span class="nav-number">1.3.10.</span> <span class="nav-text">异步相关</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#expect-assertions"><span class="nav-number">1.3.10.1.</span> <span class="nav-text">expect.assertions()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#expect-hasAssertions"><span class="nav-number">1.3.10.2.</span> <span class="nav-text">expect.hasAssertions()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#resolves"><span class="nav-number">1.3.10.3.</span> <span class="nav-text">.resolves</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#rejects"><span class="nav-number">1.3.10.4.</span> <span class="nav-text">.rejects</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#函数调用"><span class="nav-number">1.3.11.</span> <span class="nav-text">函数调用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#toHaveBeenCalled-toBeCalled"><span class="nav-number">1.3.11.1.</span> <span class="nav-text">.toHaveBeenCalled()|.toBeCalled()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#toHaveBeenCallTimes-number-toBeCalledTimes-number"><span class="nav-number">1.3.11.2.</span> <span class="nav-text">.toHaveBeenCallTimes(number)|.toBeCalledTimes(number)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#toHaveBeenCalledWith-arg1-arg2-…-toBeCalledWith-arg1-arg2-…"><span class="nav-number">1.3.11.3.</span> <span class="nav-text">.toHaveBeenCalledWith(arg1,arg2,…)|.toBeCalledWith(arg1,arg2,…)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#toHaveBeenLastCalledWith-arg1-arg2-…-lastCalledWith-arg1-arg2-…"><span class="nav-number">1.3.11.4.</span> <span class="nav-text">.toHaveBeenLastCalledWith(arg1,arg2,…)|.lastCalledWith(arg1, arg2, …)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#toHaveBeenNthCalledWith-nthCall-arg1-arg2-…-nthCalledWith-nthCall-arg1-arg2-…"><span class="nav-number">1.3.11.5.</span> <span class="nav-text">.toHaveBeenNthCalledWith(nthCall, arg1, arg2, ….)|.nthCalledWith(nthCall, arg1, arg2, ….)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#toHaveReturned-toReturn"><span class="nav-number">1.3.11.6.</span> <span class="nav-text">.toHaveReturned()|.toReturn()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#toHaveReturnedTimes-number-toReturnTimes-number"><span class="nav-number">1.3.11.7.</span> <span class="nav-text">.toHaveReturnedTimes(number)|.toReturnTimes(number)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#toHaveReturnedWith-value-toReturnWith-value"><span class="nav-number">1.3.11.8.</span> <span class="nav-text">.toHaveReturnedWith(value)|.toReturnWith(value)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#toHaveLastReturnedWith-value-lastReturnedWith-value"><span class="nav-number">1.3.11.9.</span> <span class="nav-text">.toHaveLastReturnedWith(value)|.lastReturnedWith(value)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#toHaveNthReturnedWith-nthCall-value-nthReturnedWith-nthCall-value"><span class="nav-number">1.3.11.10.</span> <span class="nav-text">.toHaveNthReturnedWith(nthCall, value)|.nthReturnedWith(nthCall, value)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#自定义扩展"><span class="nav-number">1.3.12.</span> <span class="nav-text">自定义扩展</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#expect-extend"><span class="nav-number">1.3.12.1.</span> <span class="nav-text">expect.extend()</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#测试异步代码"><span class="nav-number">1.3.13.</span> <span class="nav-text">测试异步代码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#钩子函数"><span class="nav-number">1.3.14.</span> <span class="nav-text">钩子函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Mock"><span class="nav-number">1.3.15.</span> <span class="nav-text">Mock</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#基本模拟-导入函数"><span class="nav-number">1.3.15.1.</span> <span class="nav-text">基本模拟-导入函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#修改原来函数的返回"><span class="nav-number">1.3.15.2.</span> <span class="nav-text">修改原来函数的返回</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#mocks-文件夹"><span class="nav-number">1.3.15.3.</span> <span class="nav-text">__mocks__文件夹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#同时存在-mocks-以及导入函数"><span class="nav-number">1.3.15.4.</span> <span class="nav-text">同时存在__mocks__以及导入函数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Mock-Timer"><span class="nav-number">1.3.16.</span> <span class="nav-text">Mock Timer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Mock-Funtions"><span class="nav-number">1.3.17.</span> <span class="nav-text">Mock Funtions</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#模拟函数"><span class="nav-number">1.3.17.1.</span> <span class="nav-text">模拟函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#mock属性"><span class="nav-number">1.3.17.2.</span> <span class="nav-text">.mock属性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#模拟返回值"><span class="nav-number">1.3.17.3.</span> <span class="nav-text">模拟返回值</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#模拟模块"><span class="nav-number">1.3.17.4.</span> <span class="nav-text">模拟模块</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#模拟实现"><span class="nav-number">1.3.17.5.</span> <span class="nav-text">模拟实现</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#模拟函数名称"><span class="nav-number">1.3.17.6.</span> <span class="nav-text">模拟函数名称</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Snapshot快照"><span class="nav-number">1.3.18.</span> <span class="nav-text">Snapshot快照</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ES6-类"><span class="nav-number">1.3.19.</span> <span class="nav-text">ES6 类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DOM操作"><span class="nav-number">1.3.20.</span> <span class="nav-text">DOM操作</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#TDD（测试驱动开发）"><span class="nav-number">1.4.</span> <span class="nav-text">TDD（测试驱动开发）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#开发流程（Red-Green-Development）"><span class="nav-number">1.4.1.</span> <span class="nav-text">开发流程（Red-Green Development）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#优势"><span class="nav-number">1.4.2.</span> <span class="nav-text">优势</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Vue-TDD"><span class="nav-number">1.4.3.</span> <span class="nav-text">Vue TDD</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#vue-test-utils"><span class="nav-number">1.4.3.1.</span> <span class="nav-text">@vue/test-utils</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#开发-Header-组件"><span class="nav-number">1.4.3.2.</span> <span class="nav-text">开发 Header 组件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#测试覆盖率"><span class="nav-number">1.4.3.3.</span> <span class="nav-text">测试覆盖率</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#React-TDD"><span class="nav-number">1.4.4.</span> <span class="nav-text">React TDD</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Enzyme"><span class="nav-number">1.4.4.1.</span> <span class="nav-text">Enzyme</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#开发-Header-组件-1"><span class="nav-number">1.4.4.2.</span> <span class="nav-text">开发 Header 组件</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TDD-小结"><span class="nav-number">1.4.5.</span> <span class="nav-text">TDD 小结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#BDD（行为驱动开发）"><span class="nav-number">1.5.</span> <span class="nav-text">BDD（行为驱动开发）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#集成测试"><span class="nav-number">1.5.1.</span> <span class="nav-text">集成测试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TDD-与-BDD-比较"><span class="nav-number">1.5.2.</span> <span class="nav-text">TDD 与 BDD 比较</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Redux相关测试"><span class="nav-number">1.5.3.</span> <span class="nav-text">Redux相关测试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#异步代码"><span class="nav-number">1.5.4.</span> <span class="nav-text">异步代码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#compontDidMount"><span class="nav-number">1.5.4.1.</span> <span class="nav-text">compontDidMount</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#setTimeout"><span class="nav-number">1.5.4.2.</span> <span class="nav-text">setTimeout</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#前端自动化测试的优势"><span class="nav-number">1.6.</span> <span class="nav-text">前端自动化测试的优势</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Enzyme-1"><span class="nav-number">1.7.</span> <span class="nav-text">Enzyme</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#API"><span class="nav-number">1.7.1.</span> <span class="nav-text">API</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#at-index"><span class="nav-number">1.7.1.1.</span> <span class="nav-text">at(index)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#first"><span class="nav-number">1.7.1.2.</span> <span class="nav-text">first()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#last"><span class="nav-number">1.7.1.3.</span> <span class="nav-text">last()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#childAt-index"><span class="nav-number">1.7.1.4.</span> <span class="nav-text">childAt(index)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#children-selector"><span class="nav-number">1.7.1.5.</span> <span class="nav-text">children([selector])</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#closest-selector"><span class="nav-number">1.7.1.6.</span> <span class="nav-text">closest(selector)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#contains-nodeOrNodes"><span class="nav-number">1.7.1.7.</span> <span class="nav-text">contains(nodeOrNodes)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#containsAllMatchingElements-patternNodes"><span class="nav-number">1.7.1.8.</span> <span class="nav-text">containsAllMatchingElements(patternNodes)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#containsAnyMatchingElements-patternNodes"><span class="nav-number">1.7.1.9.</span> <span class="nav-text">containsAnyMatchingElements(patternNodes)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#containsMatchingElement-patternNode"><span class="nav-number">1.7.1.10.</span> <span class="nav-text">containsMatchingElement(patternNode)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#context-key"><span class="nav-number">1.7.1.11.</span> <span class="nav-text">context([key])</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#debug-options"><span class="nav-number">1.7.1.12.</span> <span class="nav-text">debug([options])</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#dive-options"><span class="nav-number">1.7.1.13.</span> <span class="nav-text">dive([options])</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#equals-node"><span class="nav-number">1.7.1.14.</span> <span class="nav-text">equals(node)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#every-selector"><span class="nav-number">1.7.1.15.</span> <span class="nav-text">every(selector)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#everyWhere-fn"><span class="nav-number">1.7.1.16.</span> <span class="nav-text">everyWhere(fn)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#exists-selector"><span class="nav-number">1.7.1.17.</span> <span class="nav-text">exists([selector])</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#filter-selector"><span class="nav-number">1.7.1.18.</span> <span class="nav-text">filter(selector)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#filterWhere-fn"><span class="nav-number">1.7.1.19.</span> <span class="nav-text">filterWhere(fn)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#find-selector"><span class="nav-number">1.7.1.20.</span> <span class="nav-text">find(selector)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#findWhere-fn"><span class="nav-number">1.7.1.21.</span> <span class="nav-text">findWhere(fn)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#forEach-fn"><span class="nav-number">1.7.1.22.</span> <span class="nav-text">forEach(fn)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#get-index"><span class="nav-number">1.7.1.23.</span> <span class="nav-text">get(index)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#getWrappingComponent"><span class="nav-number">1.7.1.24.</span> <span class="nav-text">getWrappingComponent()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#getElement"><span class="nav-number">1.7.1.25.</span> <span class="nav-text">getElement()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#getElements"><span class="nav-number">1.7.1.26.</span> <span class="nav-text">getElements()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#hasClass-className"><span class="nav-number">1.7.1.27.</span> <span class="nav-text">hasClass(className)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#hostNodes"><span class="nav-number">1.7.1.28.</span> <span class="nav-text">hostNodes()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#html"><span class="nav-number">1.7.1.29.</span> <span class="nav-text">html()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#instance"><span class="nav-number">1.7.1.30.</span> <span class="nav-text">instance()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#is-selector"><span class="nav-number">1.7.1.31.</span> <span class="nav-text">is(selector)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#isEmptyRender"><span class="nav-number">1.7.1.32.</span> <span class="nav-text">isEmptyRender()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#key"><span class="nav-number">1.7.1.33.</span> <span class="nav-text">key()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#map-fn"><span class="nav-number">1.7.1.34.</span> <span class="nav-text">map(fn)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#matchesElement-patternNode"><span class="nav-number">1.7.1.35.</span> <span class="nav-text">matchesElement(patternNode)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#name"><span class="nav-number">1.7.1.36.</span> <span class="nav-text">name()</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参考链接"><span class="nav-number">1.7.2.</span> <span class="nav-text">参考链接</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart throb" style="color: #d43f57;"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">赖彬鸿</span>

  
</div>

  <script src='https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js'></script>
  <script>
    if (window.mermaid) {
      mermaid.initialize("");
    }
  </script>

<!--

  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>



-->
<div>
<span id="busuanzi_container_site_pv" title="访问量">
    <i class="fa fa fa-eye"></i> <span id="busuanzi_value_site_pv"></span>
</span>
<span id="busuanzi_container_site_uv" title="访问人数">
  <i class="fa fa-user"></i> <span id="busuanzi_value_site_uv"></span>
</span>
<span class="post-count" title="博客总字数"><i class="fa fa-pagelines" aria-hidden="true"></i>745.9k</span>
</div>
<i class="fa fa-shield" aria-hidden="true" title="本站安全运行时间"></i> <span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span>
<script>
    var now = new Date();
    function createtime() {
        var grt= new Date("01/29/2018 09:47:04");//此处修改你的建站时间或者网站上线时间
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds);
        if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = dnum+" 天 ";
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒";
    }
setInterval("createtime()",250);
</script>

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>
  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="//cdn.bootcss.com/jquery/2.1.3/jquery.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  












  




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=5.1.4"></script>



  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("JcDzlAxx8A0MJDQ9xpJTOBUe-gzGzoHsz", "hih724suAgjSWQnvOuIEvxza");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  
  <script type="text/javascript" src="/js/src/js.cookie.js?v=5.1.4"></script>
  <script type="text/javascript" src="/js/src/scroll-cookie.js?v=5.1.4"></script>


  

  <!-- 代码块复制功能 -->
  <script type="text/javascript" src="/js/src/clipboard.js"></script>  
  <script type="text/javascript" src="/js/src/clipboard-use.js"></script>
<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/tororo.model.json"},"display":{"position":"right","width":200,"height":400},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
