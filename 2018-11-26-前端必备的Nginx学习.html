<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Nginx," />





  <link rel="alternate" href="/atom.xml" title="赖同学" type="application/atom+xml" />






<meta name="description" content="由于机缘巧合，认识了一些朋友，给我介绍了搬瓦工的网站。买了一个国外的服务器，既可以翻墙又拥有了一个搭载 Centos 6 的服务器。一年19.99美元，折合人民币也就130左右，一键搭建。有兴趣可以点击了解详情。 很久之前就看到胖哥，出了关于nginx 的教程，今天来根据他的教程在买的 linux 服务器上面搭建 nginx。 胖哥的视频教程  连接 linux 服务器在这里我是用了 xshell">
<meta name="keywords" content="Nginx">
<meta property="og:type" content="article">
<meta property="og:title" content="前端必备的Nginx学习">
<meta property="og:url" content="http://laibh.top/2018-11-26-前端必备的Nginx学习.html">
<meta property="og:site_name" content="赖同学">
<meta property="og:description" content="由于机缘巧合，认识了一些朋友，给我介绍了搬瓦工的网站。买了一个国外的服务器，既可以翻墙又拥有了一个搭载 Centos 6 的服务器。一年19.99美元，折合人民币也就130左右，一键搭建。有兴趣可以点击了解详情。 很久之前就看到胖哥，出了关于nginx 的教程，今天来根据他的教程在买的 linux 服务器上面搭建 nginx。 胖哥的视频教程  连接 linux 服务器在这里我是用了 xshell">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://laibh.top/images/2018-11-26-前端必备的Nginx学习-建立目录.png">
<meta property="og:image" content="http://laibh.top/images/2018-11-26-前端必备的Nginx学习-nginx安装目录.png">
<meta property="og:image" content="http://laibh.top/images/2018-11-26-前端必备的Nginx学习-启动服务.png">
<meta property="og:image" content="http://laibh.top/images/2018-11-26-前端必备的Nginx学习-错误页面.png">
<meta property="og:image" content="http://laibh.top/images/2018-11-26-前端必备的Nginx学习-基于端口号配置虚拟主机.png">
<meta property="og:image" content="http://laibh.top/images/2018-11-26-前端必备的Nginx学习-pc.png">
<meta property="og:image" content="http://laibh.top/images/2018-11-26-前端必备的Nginx学习-mobile.png">
<meta property="og:image" content="http://laibh.top/images/2018-11-26-前端必备的Nginx学习-gzipoff.png">
<meta property="og:image" content="http://laibh.top/images/2018-11-26-前端必备的Nginx学习-gzipon.png">
<meta property="og:image" content="http://laibh.top/images/2018-11-26-前端必备的Nginx学习-gzipon-network.png">
<meta property="og:updated_time" content="2022-03-04T10:00:38.456Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="前端必备的Nginx学习">
<meta name="twitter:description" content="由于机缘巧合，认识了一些朋友，给我介绍了搬瓦工的网站。买了一个国外的服务器，既可以翻墙又拥有了一个搭载 Centos 6 的服务器。一年19.99美元，折合人民币也就130左右，一键搭建。有兴趣可以点击了解详情。 很久之前就看到胖哥，出了关于nginx 的教程，今天来根据他的教程在买的 linux 服务器上面搭建 nginx。 胖哥的视频教程  连接 linux 服务器在这里我是用了 xshell">
<meta name="twitter:image" content="http://laibh.top/images/2018-11-26-前端必备的Nginx学习-建立目录.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '1YNH8Y3MP9',
      apiKey: '61c189facf700193dfcbb902369ce227',
      indexName: 'MyBlog',
      hits: {"per_page":10},
      labels: {"input_placeholder":"想要找些什么呢","hits_empty":"${query} 没有被找到，再试试","hits_stats":"在 ${time} ms 查找了${hits}个结果"}
    }
  };
</script>



  <link rel="canonical" href="http://laibh.top/2018-11-26-前端必备的Nginx学习.html"/>





  <title>前端必备的Nginx学习 | 赖同学</title>
  








</head>
<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">赖同学</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description"></h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            站点地图
          </a>
        </li>
      
        
        <li class="menu-item menu-item-guestbook">
          <a href="/guestbook" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-comment"></i> <br />
            
            留言
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://laibh.top/2018-11-26-前端必备的Nginx学习.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="赖彬鸿">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/myPhoto.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="赖同学">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">前端必备的Nginx学习</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-26T17:13:41+08:00">
                2018-11-26
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2022-03-04T18:00:38+08:00">
                2022-03-04
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Nginx/" itemprop="url" rel="index">
                    <span itemprop="name">Nginx</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018-11-26-前端必备的Nginx学习.html" class="leancloud_visitors" data-flag-title="前端必备的Nginx学习">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  6,830
                </span>
              

              

              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>由于机缘巧合，认识了一些朋友，给我介绍了搬瓦工的网站。买了一个国外的服务器，既可以翻墙又拥有了一个搭载 <code>Centos 6</code> 的服务器。一年19.99美元，折合人民币也就130左右，一键搭建。有兴趣可以点击<a href="https://bwh1.net/">了解详情</a>。</p>
<p>很久之前就看到<a href="http://jspang.com">胖哥</a>，出了关于nginx 的教程，今天来根据他的教程在买的 linux 服务器上面搭建 nginx。</p>
<p><a href="http://jspang.com/post/nginx.html">胖哥的视频教程</a></p>
<p> 连接 linux 服务器在这里我是用了 <code>xshell6</code> 和 <code>xftp6</code>。可以直接到官网填个邮箱，然后官方会发给你邮箱分别的下载地址。或者你觉得懒的，可以直接点击我的<a href="https://pan.baidu.com/s/1Ka7vOAqU71R3iiq_wylS4A">百度云盘下载</a></p>
<h2 id="了解Nginx和环境准备"><a href="#了解Nginx和环境准备" class="headerlink" title="了解Nginx和环境准备"></a>了解Nginx和环境准备</h2><h3 id="Nginx是什么？"><a href="#Nginx是什么？" class="headerlink" title="Nginx是什么？"></a><strong>Nginx是什么？</strong></h3><p><em>Nginx</em> (engine x) 是一个高性能的<a href="https://baike.baidu.com/item/HTTP">HTTP</a>和<a href="https://baike.baidu.com/item/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/7793488">反向代理</a>服务，也是一个IMAP/POP3/SMTP服务。Nginx是由伊戈尔·赛索耶夫为<a href="https://baike.baidu.com/item/%E4%BF%84%E7%BD%97%E6%96%AF/125568">俄罗斯</a>访问量第二的Rambler.ru站点（俄文：Рамблер）开发的，第一个公开版本0.1.0发布于2004年10月4日。</p>
<p>Nginx是一款<a href="https://baike.baidu.com/item/%E8%BD%BB%E9%87%8F%E7%BA%A7/10002835">轻量级</a>的<a href="https://baike.baidu.com/item/Web/150564">Web</a> 服务器/<a href="https://baike.baidu.com/item/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/7793488">反向代理</a>服务器及<a href="https://baike.baidu.com/item/%E7%94%B5%E5%AD%90%E9%82%AE%E4%BB%B6/111106">电子邮件</a>（IMAP/POP3）代理服务器，并在一个BSD-like 协议下发行。其特点是占有内存少，<a href="https://baike.baidu.com/item/%E5%B9%B6%E5%8F%91/11024806">并发</a>能力强，事实上nginx的并发能力确实在同类型的网页服务器中表现较好，中国大陆使用nginx网站用户有：百度、<a href="https://baike.baidu.com/item/%E4%BA%AC%E4%B8%9C/210931">京东</a>、<a href="https://baike.baidu.com/item/%E6%96%B0%E6%B5%AA/125692">新浪</a>、<a href="https://baike.baidu.com/item/%E7%BD%91%E6%98%93/185754">网易</a>、<a href="https://baike.baidu.com/item/%E8%85%BE%E8%AE%AF/112204">腾讯</a>、<a href="https://baike.baidu.com/item/%E6%B7%98%E5%AE%9D/145661">淘宝</a>等。（以上内容来自<a href="https://baike.baidu.com/item/nginx/3817705?fr=aladdin">百度百科</a>）</p>
<h3 id="Nginx的优点"><a href="#Nginx的优点" class="headerlink" title="Nginx的优点"></a><strong>Nginx的优点</strong></h3><ul>
<li>支持海量高并发：采用IO多路复用epoll。官方测试Nginx能够支持5万并发链接，实际生产环境中可以支撑2-4万并发连接数。</li>
<li>内存消耗少：在主流的服务器中Nginx目前是内存消耗最小的了，比如我们用Nginx+PHP，在3万并发链接下，开启10个Nginx进程消耗150M内存。</li>
<li>免费使用可以商业化：Nginx为开源软件，采用的是2-clause BSD-like协议，可以免费使用，并且可以用于商业。</li>
<li>配置文件简单：网络和程序配置通俗易懂，即使非专业运维也能看懂。</li>
</ul>
<h3 id="使用yum安装"><a href="#使用yum安装" class="headerlink" title="使用yum安装"></a><strong>使用yum安装</strong></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y install gcc gcc-c++ autoconf pcre-devel make automake</span><br><span class="line">yum -y install wget httpd-tools vim</span><br></pre></td></tr></table></figure>
<p>分别使用上面的指令安装，安装完成后会显示安装了什么依赖，大概下面的样子</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Installed:</span><br><span class="line">  httpd-tools.x86_64 0:2.2.15-69.el6.centos             vim-enhanced.x86_64 2:7.4.629-5.el6_8.1            </span><br><span class="line">  wget.x86_64 0:1.12-10.el6                            </span><br><span class="line"></span><br><span class="line">Dependency Installed:</span><br><span class="line">  apr.x86_64 0:1.3.9-5.el6_9.1                           apr-util.x86_64 0:1.3.9-3.el6_0.1                 </span><br><span class="line">  gpm-libs.x86_64 0:1.20.6-12.el6                        vim-common.x86_64 2:7.4.629-5.el6_8.1             </span><br><span class="line">  vim-filesystem.x86_64 2:7.4.629-5.el6_8.1</span><br></pre></td></tr></table></figure>
<p>上面的过程主要安装了一些linux系统下面的编译器以及一些服务或者是相关便于linux使用的内容。有兴趣的可以一个一个百度了解</p>
<h3 id="建立目录"><a href="#建立目录" class="headerlink" title="建立目录"></a><strong>建立目录</strong></h3><p>根据个人喜好，喜欢整理的就建立一下，自己为例</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cd / # 进去 '/' 文件夹</span><br><span class="line">cd root # 进去 'root' 文件夹</span><br><span class="line">ls # 显示 root 文件夹里面的文件</span><br><span class="line">mkdir lbh # 创建lbh文件夹</span><br><span class="line">cd lbh # 进去 'lbh' 文件夹</span><br><span class="line">mkdir app # 创建app文件夹</span><br><span class="line">mkdir backup # 创建backup文件夹</span><br><span class="line">mkdir download # 创建download文件夹</span><br><span class="line">mkdir logs # 创建logs文件夹</span><br><span class="line">mkdir work # 创建work文件夹</span><br><span class="line">ls # 显示 lbh 文件夹里面的文件</span><br><span class="line"><span class="meta">#</span><span class="bash"> app backup download logs work</span></span><br></pre></td></tr></table></figure>
<p>也可以使用<code>xftp</code>进去可视的创建和查看</p>
<p><img src="/images/2018-11-26-前端必备的Nginx学习-建立目录.png" alt="建立目录"></p>
<h2 id="Nginx的快速搭建"><a href="#Nginx的快速搭建" class="headerlink" title="Nginx的快速搭建"></a>Nginx的快速搭建</h2><h3 id="Nginx版本说明"><a href="#Nginx版本说明" class="headerlink" title="Nginx版本说明"></a><strong>Nginx版本说明</strong></h3><p>打开nginx官网的<a href="http://nginx.org/en/download.html">下载页面</a>，可以看到以下几个版本</p>
<ul>
<li>Mainline version ：开发版,主要是给广大Nginx爱好者，测试、研究和学习的，但是不建议使用于生产环境。</li>
<li>Stable version : 稳定版,也就是我们说的长期更新版本。这种版本一般比较成熟，经过长时间的更新测试，所以这种版本也是主流版本。</li>
<li>legacy version : 历史版本，如果你需要以前的版本，Nginx也是有提供的。</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum list | grep nginx # 查看yum中是否已经有 nginx</span><br></pre></td></tr></table></figure>
<p>如果不存在，或者不是需要的版本，可以自行配置。从官网的 <a href="http://nginx.org/en/linux_packages.html#stable">stable</a> 版本可以得下以下代码</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[nginx]</span><br><span class="line">name=nginx repo</span><br><span class="line">baseurl=http://nginx.org/packages/OS/OSRELEASE/$basearch/</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br></pre></td></tr></table></figure>
<h3 id="创建-yum源"><a href="#创建-yum源" class="headerlink" title="创建 yum源"></a><strong>创建 yum源</strong></h3><p>先用vim 编辑器建立一个 yum 源，关于 yum源的解释，可以简单理解为：repo文件即是Linux中常说的源文件(repositry)，在使用yum命令的时候系统会自动读取repo文件，然后去repositry获取软件。每一个repo文件代表不同的软件源，其中的baseurl，表明了repositry的地址，支持ftp协议，http协议和file协议。其他具体的请自行百度。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/yum.repos.d/nginx.repo</span><br></pre></td></tr></table></figure>
<p>接着会弹出一个界面，按 <code>i</code>(insert)，复制粘贴刚刚的代码。修改其中的一些代码</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">baseurl=http://nginx.org/packages/OS/OSRELEASE/$basearch/</span><br></pre></td></tr></table></figure>
<p><code>OS</code>对应你系统，我的是 <code>centos</code>,<code>OSRELEASE</code>是版本号，改为 <code>6</code>。完整改完</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[nginx]</span><br><span class="line">name=nginx repo</span><br><span class="line">baseurl=http://nginx.org/packages/centos/6/$basearch/</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br></pre></td></tr></table></figure>
<p>接着按<code>esc</code>退出编辑状态，并输入 <code>:wq</code>进行保存。yum源就创建好了。接着重新输入</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">yum list | grep nginx # 查看yum中是否已经有 nginx</span><br><span class="line"><span class="meta">#</span><span class="bash">可以得到</span></span><br><span class="line">nginx.x86_64                               1.14.1-1.el6.ngx              nginx  </span><br><span class="line">nginx-debug.x86_64                         1.8.0-1.el6.ngx               nginx  </span><br><span class="line">nginx-debuginfo.x86_64                     1.14.1-1.el6.ngx              nginx  </span><br><span class="line">nginx-module-geoip.x86_64                  1.14.1-1.el6.ngx              nginx  </span><br><span class="line">nginx-module-geoip-debuginfo.x86_64        1.14.1-1.el6.ngx              nginx  </span><br><span class="line">nginx-module-image-filter.x86_64           1.14.1-1.el6.ngx              nginx  </span><br><span class="line">nginx-module-image-filter-debuginfo.x86_64 1.14.1-1.el6.ngx              nginx  </span><br><span class="line">nginx-module-njs.x86_64                    1.14.1.0.2.5-1.el6.ngx        nginx  </span><br><span class="line">nginx-module-njs-debuginfo.x86_64          1.14.1.0.2.5-1.el6.ngx        nginx  </span><br><span class="line">nginx-module-perl.x86_64                   1.14.1-1.el6.ngx              nginx  </span><br><span class="line">nginx-module-perl-debuginfo.x86_64         1.14.1-1.el6.ngx              nginx  </span><br><span class="line">nginx-module-xslt.x86_64                   1.14.1-1.el6.ngx              nginx  </span><br><span class="line">nginx-module-xslt-debuginfo.x86_64         1.14.1-1.el6.ngx              nginx  </span><br><span class="line">nginx-nr-agent.noarch                      2.0.0-12.el6.ngx              nginx  </span><br><span class="line">pcp-pmda-nginx.x86_64                      3.10.9-9.el6                  base</span><br></pre></td></tr></table></figure>
<p>可以看到1.14.1的nginx，接着安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install nginx</span><br></pre></td></tr></table></figure>
<p>安装完成后，输入</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -v # nginx version: nginx/1.14.1</span><br></pre></td></tr></table></figure>
<p>有版本号就是已经安装完成了。</p>
<h2 id="Nginx基本配置文件详解"><a href="#Nginx基本配置文件详解" class="headerlink" title="Nginx基本配置文件详解"></a>Nginx基本配置文件详解</h2><p>在使用<code>yum</code>安装完Nginx后，需要知道系统中多了那些文件，它们都安装到了那里。可以使用下面的命令进行查看：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -ql nginx</span><br></pre></td></tr></table></figure>
<p>rpm 是linux的rpm包管理工具，-q 代表询问模式，-l 代表返回列表，这样我们就可以找到nginx的所有安装位置了。可以看到以下的内容</p>
<p><img src="/images/2018-11-26-前端必备的Nginx学习-nginx安装目录.png" alt="nginx安装目录"></p>
<h3 id="nginx-conf"><a href="#nginx-conf" class="headerlink" title="nginx.conf"></a><strong>nginx.conf</strong></h3><p>nginx.conf文件是Nginx的总配置文件，在我们搭建服务器的时候需要经常调整的文件。</p>
<p>进入 <code>etc/nginx</code>目录下，用vim打开</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/nginx</span><br><span class="line">vim nginx.conf</span><br></pre></td></tr></table></figure>
<p>下面是文件的注释</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">user  nginx; # 运行用户，默认是nginx,可以不进行设置</span><br><span class="line">worker_processes  1; # nginx 进程，一般设置为和CPU核数一样</span><br><span class="line">error_log  /var/log/nginx/error.log warn; # 错误日志存放目录</span><br><span class="line">pid        /var/run/nginx.pid; # 进程 pid 存放位置</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024; # 单个后台进程的最大并发数</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       /etc/nginx/mime.types; #文件扩展名与类型映射表</span><br><span class="line">    default_type  application/octet-stream; #默认文件类型</span><br><span class="line">    # 设置日志模式</span><br><span class="line">    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '</span><br><span class="line">                      '$status $body_bytes_sent "$http_referer" '</span><br><span class="line">                      '"$http_user_agent" "$http_x_forwarded_for"';</span><br><span class="line"></span><br><span class="line">    access_log  /var/log/nginx/access.log  main; # nginx 访问日志存放位置</span><br><span class="line"></span><br><span class="line">    sendfile        on; # 开启高效传输模式</span><br><span class="line">    #tcp_nopush     on; # 减少网络报文段的数量</span><br><span class="line"></span><br><span class="line">    keepalive_timeout  65; # 保持连接的时间，也叫做超时是啊金</span><br><span class="line"></span><br><span class="line">    #gzip  on; # 开始 gzip压缩</span><br><span class="line"></span><br><span class="line">    include /etc/nginx/conf.d/*.conf; # 包含的子配置项位置和文件</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="default-conf"><a href="#default-conf" class="headerlink" title="default.conf"></a><strong>default.conf</strong></h3><p>可以看到最后有一个子文件的配置项，那我们打开这个include子文件配置项看一下里边都有些什么内容。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@host ~]# cd /etc/nginx</span><br><span class="line">[root@host nginx]# vim nginx.conf</span><br><span class="line">[root@host nginx]# vim default.conf</span><br><span class="line">[root@host nginx]# ls</span><br><span class="line">conf.d          koi-utf  mime.types  nginx.conf   uwsgi_params</span><br><span class="line">fastcgi_params  koi-win  modules     scgi_params  win-utf</span><br><span class="line">[root@host nginx]# cd conf.d</span><br><span class="line">[root@host conf.d]# ls</span><br><span class="line">default.conf</span><br><span class="line">[root@host conf.d]# vim default.conf</span><br></pre></td></tr></table></figure>
<p>通过以上指令进入 <code>conf.d</code>文件夹，然后用 <code>vim</code> 编辑器打开  <code>default.conf</code>，得到以下文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen       80; # 配置监听端口</span><br><span class="line">    server_name  localhost; # 配置域名</span><br><span class="line"></span><br><span class="line">    #charset koi8-r;</span><br><span class="line">    #access_log  /var/log/nginx/host.access.log  main;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        root   /usr/share/nginx/html; # 服务默认启动目录</span><br><span class="line">        index  index.html index.htm; # 默认访问文件</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #error_page  404              /404.html; # 配置404页面</span><br><span class="line"></span><br><span class="line">    # redirect server error pages to the static page /50x.html</span><br><span class="line">    #</span><br><span class="line">    error_page   500 502 503 504  /50x.html; # 错误状态码的显示页面，配置后需要重新启动</span><br><span class="line">    location = /50x.html &#123;</span><br><span class="line">        root   /usr/share/nginx/html;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # proxy the PHP scripts to Apache listening on 127.0.0.1:80</span><br><span class="line">    #</span><br><span class="line">    #location ~ \.php$ &#123;</span><br><span class="line">    #    proxy_pass   http://127.0.0.1;</span><br><span class="line">    #&#125;</span><br><span class="line"></span><br><span class="line">    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span><br><span class="line">    #</span><br><span class="line">    #location ~ \.php$ &#123;</span><br><span class="line">    #    root           html;</span><br><span class="line">    #    fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">    #    fastcgi_index  index.php;</span><br><span class="line">    #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span><br><span class="line">    #    include        fastcgi_params;</span><br><span class="line">    #&#125;</span><br><span class="line"></span><br><span class="line">    # deny access to .htaccess files, if Apache's document root</span><br><span class="line">    # concurs with nginx's one</span><br><span class="line">    #</span><br><span class="line">    #location ~ /\.ht &#123;</span><br><span class="line">    #    deny  all;</span><br><span class="line">    #&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>按 <code>:q</code>退出。 明白了这些配置项，可以知道我们的服务目录放在了<code>/usr/share/nginx/html</code>下，可以使用命令进入看一下目录下的文件。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/share/nginx/html</span><br><span class="line">ls</span><br><span class="line"><span class="meta">#</span><span class="bash"> 50x.html index.html</span></span><br></pre></td></tr></table></figure>
<p>可以用编辑器分别打开这两个html文件</p>
<p>50.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Error<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">    body &#123;</span></span><br><span class="line"><span class="undefined">        width: 35em;</span></span><br><span class="line"><span class="undefined">        margin: 0 auto;</span></span><br><span class="line"><span class="undefined">        font-family: Tahoma, Verdana, Arial, sans-serif;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>An error occurred.<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Sorry, the page you are looking for is currently unavailable.<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">Please try again later.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>If you are the system administrator of this resource then you should check</span><br><span class="line">the <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://nginx.org/r/error_log"</span>&gt;</span>error log<span class="tag">&lt;/<span class="name">a</span>&gt;</span> for details.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">em</span>&gt;</span>Faithfully yours, nginx.<span class="tag">&lt;/<span class="name">em</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Welcome to nginx!<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">    body &#123;</span></span><br><span class="line"><span class="undefined">        width: 35em;</span></span><br><span class="line"><span class="undefined">        margin: 0 auto;</span></span><br><span class="line"><span class="undefined">        font-family: Tahoma, Verdana, Arial, sans-serif;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Welcome to nginx!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>If you see this page, the nginx web server is successfully installed and</span><br><span class="line">working. Further configuration is required.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>For online documentation and support please refer to</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://nginx.org/"</span>&gt;</span>nginx.org<span class="tag">&lt;/<span class="name">a</span>&gt;</span>.<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">Commercial support is available at</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://nginx.com/"</span>&gt;</span>nginx.com<span class="tag">&lt;/<span class="name">a</span>&gt;</span>.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">em</span>&gt;</span>Thank you for using nginx.<span class="tag">&lt;/<span class="name">em</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a><strong>启动服务</strong></h3><p>在 nginx 默认启动目录下，输入</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">nginx -t # 测试配置</span><br><span class="line"><span class="meta">#</span><span class="bash"> 得到</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> nginx: configuration file /etc/nginx/nginx.conf <span class="built_in">test</span> is successful</span></span><br><span class="line"></span><br><span class="line">nginx # 接着启动服务</span><br><span class="line">ps -ef | grep nginx # 查看进程</span><br><span class="line"><span class="meta">#</span><span class="bash"> root     24574     1  0 02:22 ?        00:00:00 nginx: master process nginx</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> nginx    24575 24574  0 02:22 ?        00:00:00 nginx: worker process</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> root     24577 24278  0 02:23 pts/0    00:00:00 grep nginx</span></span><br></pre></td></tr></table></figure>
<p>接着打开你的服务器的所在的ip地址，看到以下的画面，就说明配置成功了</p>
<p><img src="/images/2018-11-26-前端必备的Nginx学习-启动服务.png" alt="启动服务"></p>
<h2 id="Nginx服务启动、停止、重启"><a href="#Nginx服务启动、停止、重启" class="headerlink" title="Nginx服务启动、停止、重启"></a>Nginx服务启动、停止、重启</h2><h3 id="服务启动"><a href="#服务启动" class="headerlink" title="服务启动"></a><strong>服务启动</strong></h3><p>默认情况下，nginx 是不会自动开启的，需要手动启动。有多种方法</p>
<p><strong>nginx直接启动</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx</span><br></pre></td></tr></table></figure>
<p><strong>systemctl命令启动</strong></p>
<p>使用Linux 的命令进行启动，这种方法无论是启动什么服务都是一样的，只是更改了服务的名字</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start nginx.service</span><br></pre></td></tr></table></figure>
<p>输入命令后，没有任何的提示，然后使用下面的命令进行查询服务的运行状态</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps aux | grep nginx</span><br></pre></td></tr></table></figure>
<p>可以得到下面的结果</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root     24574  0.0  0.1  47384   948 ?        Ss   02:22   0:00 nginx: master process nginx</span><br><span class="line">nginx    24575  0.0  0.7  47788  3680 ?        S    02:22   0:00 nginx: worker process</span><br><span class="line">root     24584  0.0  0.4 103380  2168 pts/0    S+   02:45   0:00 grep nginx</span><br></pre></td></tr></table></figure>
<p>有了这三条记录，说明Nginx 服务被正常开启了。</p>
<h3 id="服务停止"><a href="#服务停止" class="headerlink" title="服务停止"></a><strong>服务停止</strong></h3><p><strong>立即停止服务</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -s stop</span><br></pre></td></tr></table></figure>
<p>强制停止方法，无论是否在工作</p>
<p><strong>从容停止服务</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -s quit</span><br></pre></td></tr></table></figure>
<p>这种方法需要进程完成当前工作后再停止</p>
<p><strong>killadd 停止服务</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">killall nginx</span><br></pre></td></tr></table></figure>
<p><strong>systemctl停止服务</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop nginx.service</span><br></pre></td></tr></table></figure>
<h3 id="服务重启"><a href="#服务重启" class="headerlink" title="服务重启"></a><strong>服务重启</strong></h3><p><strong>systemctl重启服务</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart nginx.service</span><br></pre></td></tr></table></figure>
<p><strong>重载配置文件</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure>
<p><strong>查看端口号</strong></p>
<p>在默认情况下，Nginx启动后会监听80端口，从而提供HTTP访问，如果80端口已经被占用则会启动失败。我么可以使用<code>netstat -tlnp</code>命令查看端口号的占用情况。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">netstat -tlnp</span><br><span class="line"><span class="meta">#</span><span class="bash"> 可以看到</span></span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address               Foreign Address             State       PID/Program name   </span><br><span class="line">tcp        0      0 0.0.0.0:80                  0.0.0.0:*                   LISTEN      24574/nginx         </span><br><span class="line">tcp        0      0 127.0.0.1:25                0.0.0.0:*                   LISTEN      1465/master         </span><br><span class="line">tcp        0      0 0.0.0.0:27652               0.0.0.0:*                   LISTEN      24426/sshd          </span><br><span class="line">tcp        0      0 ::1:25                      :::*                        LISTEN      1465/master         </span><br><span class="line">tcp        0      0 :::443                      :::*                        LISTEN      1906/python         </span><br><span class="line">tcp        0      0 :::27652                    :::*                        LISTEN      24426/sshd</span><br></pre></td></tr></table></figure>
<h2 id="自定义错误页和访问设置"><a href="#自定义错误页和访问设置" class="headerlink" title="自定义错误页和访问设置"></a>自定义错误页和访问设置</h2><h3 id="多错误指向一个页面"><a href="#多错误指向一个页面" class="headerlink" title="多错误指向一个页面"></a><strong>多错误指向一个页面</strong></h3><p>在<code>/etc/nginx/conf.d/default.conf</code> 是可以看到下面这句话的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error_page   500 502 503 504  /50x.html;</span><br></pre></td></tr></table></figure>
<p>error_page指令用于自定义错误页面，500，502，503，504 这些就是HTTP中最常见的错误码，/50.html用于表示当发生上述指定的任意一个错误的时候，都是用网站根目录下的/50.html文件进行处理。</p>
<h3 id="单独为错误置顶处理方式"><a href="#单独为错误置顶处理方式" class="headerlink" title="单独为错误置顶处理方式"></a><strong>单独为错误置顶处理方式</strong></h3><p>在<code>default.conf</code> 文件中添加以下设置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error_page 404 /404x.html;</span><br></pre></td></tr></table></figure>
<p>接着输入 <code>:wq</code>保存退出。进入网站的目录 <code>usr/share/nginx/html</code>新建一个404x.html文件，并写入一些信息</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>错误:404!页面没有找到!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p> 重启服务,得到的错误页面</p>
<p><img src="/images/2018-11-26-前端必备的Nginx学习-错误页面.png" alt="错误页面"></p>
<h3 id="把错误码换成一个地址"><a href="#把错误码换成一个地址" class="headerlink" title="把错误码换成一个地址"></a><strong>把错误码换成一个地址</strong></h3><p>处理错误的时候，不仅可以只使用本服务器的资源，还可以使用外部的资源。比如我们将配置文件设置成这样。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error_page 404 http://laibh.top</span><br></pre></td></tr></table></figure>
<p>这样子，当报404错误的时候就会链接到我的博客的网址去了。、</p>
<h3 id="简单实现访问控制"><a href="#简单实现访问控制" class="headerlink" title="简单实现访问控制"></a><strong>简单实现访问控制</strong></h3><p>有时候我们的服务器只允许特定主机访问，比如内部OA系统，或者应用的管理后台系统，更或者是某些应用接口，这时候我们就需要控制一些IP访问，我们可以直接在<code>location</code>里进行配置。</p>
<p>可以直接在default.conf里进行配置。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">       deny   123.9.51.42;</span><br><span class="line">       allow  45.76.202.231;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>配置完成后，重启一下服务器就可以实现限制(deny)和允许(allow)访问了。这在工作中非常常用，一定要好好记得。</p>
<h2 id="Nginx访问权限"><a href="#Nginx访问权限" class="headerlink" title="Nginx访问权限"></a>Nginx访问权限</h2><p>deny是禁止访问，allow是允许访问。但Nginx的访问控制还是比较复杂的</p>
<h3 id="指令优先级"><a href="#指令优先级" class="headerlink" title="指令优先级"></a><strong>指令优先级</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">        allow  45.76.202.231;</span><br><span class="line">        deny   all;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>上面的配置，表示只允许 <code>45.76.202.231</code>访问，禁止ip地址访问。而如果将 <code>deny</code>语句提前，则会发现所有的ip都不可以访问了。这说明了：<strong>在同一个块中的两个权限指令，先出现的设置为覆盖后出现的设置</strong></p>
<h3 id="复杂访问控制权限匹配"><a href="#复杂访问控制权限匹配" class="headerlink" title="复杂访问控制权限匹配"></a><strong>复杂访问控制权限匹配</strong></h3><p>在工作中，访问权限的控制需求更加复杂，例如，对于网站下的img（图片目录）是运行所有用户访问，但对于网站下的admin目录则只允许公司内部固定IP访问。这时候仅靠deny和allow这两个指令，是无法实现的。我们需要location块来完成相关的需求匹配。</p>
<p><code>=</code>：精确匹配</p>
<p>上面的需求，配置代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">location =/img&#123;</span><br><span class="line">    allow all;</span><br><span class="line">&#125;</span><br><span class="line">location =/admin&#123;</span><br><span class="line">    deny all;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="使用正则表达式设置访问权限"><a href="#使用正则表达式设置访问权限" class="headerlink" title="使用正则表达式设置访问权限"></a><strong>使用正则表达式设置访问权限</strong></h3><p>只有精确匹配有时是完不成我们的工作任务的，比如现在我们要禁止访问所有php的页面，php的页面大多是后台的管理或者接口代码，所以为了安全我们经常要禁止所有用户访问，而只开放公司内部访问的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location ~\.php$&#123;</span><br><span class="line">    deny all;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Nginx设置虚拟主机"><a href="#Nginx设置虚拟主机" class="headerlink" title="Nginx设置虚拟主机"></a>Nginx设置虚拟主机</h2><p>虚拟主机是指在一台物理主机服务器上划分出多个磁盘空间，每个磁盘空间都是一个虚拟主机，每台虚拟主机都可以对外提供Web服务，并且互不干扰。在外界看来，虚拟铸就是一台独立的服务器主机，这意味着用户能够利用虚拟主机把多个不同域名的网站部署在同一台服务器上，即解决了维护服务器技术的难题，同时有节省了服务器硬件成本和相关的维护费用。</p>
<p>配置虚拟主机可以基于端口号、基于IP和基于域名。</p>
<h3 id="基于端口号配置虚拟主机"><a href="#基于端口号配置虚拟主机" class="headerlink" title="基于端口号配置虚拟主机"></a><strong>基于端口号配置虚拟主机</strong></h3><p>基于端口号来配置虚拟主机，是Nginx 中最简单的一种方式，原理就是Nginx监听多个端口，根据不同的端口号，来区分不同的网站。</p>
<p>首先，我们先进入主文件 <code>etc/nginx/conf.d/default.conf</code>,编辑器打开。可以选择新建一个文件，在文件夹 <code>conf.d</code>下面就可以，也可以还是配置在原来的子文件里。</p>
<p><code>vim 8001.conf</code> 新建一个文件，命名为 <code>8001.conf</code>, 按<code>i</code>键后进入编辑模式，新增配置文件的server选项。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">        listen 8001; # 监听的端口号</span><br><span class="line">        server_name localhost; # 访问本机</span><br><span class="line">        root /usr/share/nginx/html/html8001; # 文件路径</span><br><span class="line">        index index.html;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>esc</code>退出编辑模式，<code>:wq</code>保存文件。</p>
<p>进入到原来上一个服务文件路径</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/share/nginx/html</span><br></pre></td></tr></table></figure>
<p>新增 <code>html</code>文件夹,并进入该文件夹，新增 <code>index.html</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir html8001</span><br><span class="line">cd html8001</span><br><span class="line">vim index.html</span><br></pre></td></tr></table></figure>
<p><code>index.html</code>里面的内容</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Welcome to port 8001<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后重启一下 <code>nginx</code>服务器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure>
<p>接着在浏览器打开，你的ip地址后面加上端口号 <code>:8001</code>，就可以访问到一下的画面了。</p>
<p><img src="/images/2018-11-26-前端必备的Nginx学习-基于端口号配置虚拟主机.png" alt="基于端口号配置虚拟主机"></p>
<h3 id="基于IP配置虚拟主机"><a href="#基于IP配置虚拟主机" class="headerlink" title="基于IP配置虚拟主机"></a>基于IP配置虚拟主机</h3><p>基于ip和基于端口的配置几乎是一样的，只是把 <code>server_name</code>选项，配置成IP就可以了。</p>
<p>按照上面的配置可以修改为：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">        listen 8001; # 监听的端口号</span><br><span class="line">        server_name 147.124.12.32; </span><br><span class="line">        root /usr/share/nginx/html/html8001; # 文件路径</span><br><span class="line">        index index.html;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于我这个服务器也没有多个ip,所以也无法进行实践。</p>
<h3 id="使用域名设置虚拟主机"><a href="#使用域名设置虚拟主机" class="headerlink" title="使用域名设置虚拟主机"></a><strong>使用域名设置虚拟主机</strong></h3><p>这个主要在于域名解析这块，首先你需要购买一个域名，接着在购买处的后台管理设置域名解析，解析到你的服务器ip跟ip地址8001端口的位置。</p>
<p>接着我们修改之前的两个文件，</p>
<p><code>defalut.conf</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">        listen 80; # 监听的端口号</span><br><span class="line">        server_name 域名1; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>8001.conf</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">        listen 8001; # 监听的端口号</span><br><span class="line">        server_name 域名2; </span><br><span class="line">        root /usr/share/nginx/html/html8001; # 文件路径</span><br><span class="line">        index index.html;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>配置好了之后，就进行重启，然后在浏览器输入你的两个域名，就可以访问这两个网页了。</p>
<h2 id="Nginx反向代理的设置"><a href="#Nginx反向代理的设置" class="headerlink" title="Nginx反向代理的设置"></a>Nginx反向代理的设置</h2><p>web模式基本的都是标准的CS结构，即Client端到Server端。代理就是在Client端和Server端之间增加一个提供特定功能的服务器，这个服务器就是我们所说的代理服务器。</p>
<p>这里我百度了具体的概念，以下的内容可以参考下</p>
<p><a href="https://www.cnblogs.com/Anker/p/6056540.html">正向代理与反向代理</a></p>
<p>借鉴上面原文的话就是：</p>
<p>总结来说，正向代理 是一个位于客户端和原始服务器(origin server)之间的服务器，为了从原始服务器取得内容，客户端向代理发送一个请求并指定目标(原始服务器)，然后代理向原始服务器转交请求并将获得的内容返回给客户端。客户端必须要进行一些特别的设置才能使用正向代理。</p>
<p><strong>正向代理的用途：</strong></p>
<ul>
<li>访问原来无法访问的资源，如google</li>
<li>可以做缓存，加速访问资源</li>
<li>对客户端访问授权，上网进行认证</li>
<li>代理可以记录用户访问记录（上网行为管理），对外隐藏用户信息</li>
</ul>
<p>反向代理（Reverse Proxy）实际运行方式是指以代理服务器来接受internet上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给internet上请求连接的客户端，此时代理服务器对外就表现为一个服务器。</p>
<p><strong>反向代理的作用：</strong></p>
<ul>
<li>保证内网的安全，可以使用反向代理提供WAF功能，阻止web攻击大型网站，通常将反向代理作为公网访问地址，Web服务器是内网。</li>
<li>负载均衡，通过反向代理服务器来优化网站的负载</li>
</ul>
<h3 id="最简单的反向代理"><a href="#最简单的反向代理" class="headerlink" title="最简单的反向代理"></a><strong>最简单的反向代理</strong></h3><p>假如我们要访问 <code>域名1</code>然后反向代理到 <code>域名2</code>这个网站。我们直接修改 <code>defalut.conf</code>配置文件。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">        listen 80; # 监听的端口号</span><br><span class="line">        server_name 域名1; </span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_pass 域名2；</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一般我们反向代理的都是一个ip，但是代理域名也是可以的。</p>
<p><strong>其他反向代理指令</strong></p>
<ul>
<li>proxy_set_header:在将客户端请求发送给后端服务器之前，更改来自客户端的请求头信息</li>
<li>proxy_connect_timeout:配置Nginx 与后端代理服务器尝试建立连接的超时时间</li>
<li>proxy_read_timeout:配置Nginx 向后端务器组发出read请求后，等待相应的超时时间</li>
<li>proxy_send_timeout:配置Nginx 向后端务器组发出write请求后，等待相应的超时时间</li>
<li>proxy_redirect:用于修改后端服务器返回的响应头中的Location和Refresh</li>
</ul>
<h2 id="Nginx适配PC或移动设备"><a href="#Nginx适配PC或移动设备" class="headerlink" title="Nginx适配PC或移动设备"></a>Nginx适配PC或移动设备</h2><p>通过配置Nginx来识别移动端和pc端来展示不同的页面。</p>
<h3 id="http-user-agent的使用"><a href="#http-user-agent的使用" class="headerlink" title="$http_user_agent的使用"></a><strong>$http_user_agent的使用</strong></h3><p>Nginx通过内置变量 <code>$http_user_agent</code>，可以获取到请求客户端的 userAgent ，就可以判断用户目前处于移动端还是pc端，进而展示不同的页面给用户。</p>
<p>首先，先在 <code>/usr/share/nginx</code>目录下新建两个文件夹，分别是pc和mobile目录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/share/nginx</span><br><span class="line">mkdir pc</span><br><span class="line">mkdir mobile</span><br></pre></td></tr></table></figure>
<p>接着分别在两个目录文件夹下面建立 index.html</p>
<p><code>mobile/index.html</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>I am mobile<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>pc/index.html</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>I am pc<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>回到 <code>etc/nginx/conf.d</code>文件夹，打开 <code>default.conf</code>,修改 <code>8001.conf</code>文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">     listen 8001;</span><br><span class="line">     server_name localhost;</span><br><span class="line">     location / &#123;</span><br><span class="line">      root /usr/share/nginx/pc;</span><br><span class="line">      if ($http_user_agent ~* '(Android|webOS|iPhone|iPod|BlackBerry)') &#123;</span><br><span class="line">         root /usr/share/nginx/mobile;</span><br><span class="line">      &#125;</span><br><span class="line">      index index.html;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里要注意 <code>if</code> 与后面的括号要有至少一个空格的距离，如果紧贴的话会报错。</p>
<p>接着重启服务器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure>
<p>接着在浏览器打开ip地址的8001端口，可以看到</p>
<p><img src="/images/2018-11-26-前端必备的Nginx学习-pc.png" alt="pc"></p>
<p>接着 <code>f12</code>，切换移动端模式，进行刷新，可以看到</p>
<p><img src="/images/2018-11-26-前端必备的Nginx学习-mobile.png" alt="mobile"></p>
<p>上面的适配是没有写完整的，具体的可以点击<a href="http://detectmobilebrowsers.com/">这里</a>，里面会有不同服务器完整的判断端。</p>
<h2 id="Nginx的Gzip压缩配置"><a href="#Nginx的Gzip压缩配置" class="headerlink" title="Nginx的Gzip压缩配置"></a>Nginx的Gzip压缩配置</h2><p>Gzip是网页的一种网页压缩技术，经过gzip压缩后，页面大小可以变为原来的30%甚至更小。更小的网页会让用户浏览的体验更好，速度更快。gzip网页压缩的实现需要浏览器和服务器的支持。</p>
<p>当浏览器支持gzip压缩时，会在请求消息中包含 <code>Accept-Encoding:gzip</code>，这样Nginx就会向浏览器发送经过gzip压缩的内容，同时在相应的信息头加入 <code>Content-Encoding:gzip</code>,声明这是gzip后的内容，浏览器需要先解压才可以解析解出。</p>
<p>gzip<a href="http://tool.chinaz.com/Gzips/Default.aspx">网站压缩检测</a></p>
<p>可以首先检测我的服务器ip</p>
<p><img src="/images/2018-11-26-前端必备的Nginx学习-gzipoff.png" alt="gzipoff"></p>
<p>可以看到是没有开启gzip的。</p>
<h3 id="gzip的配置项"><a href="#gzip的配置项" class="headerlink" title="gzip的配置项"></a><strong>gzip的配置项</strong></h3><p>Nginx 提供了专门的gzip模块。</p>
<ul>
<li>gzip:该指令用于开启或者关闭gzip指令</li>
<li>gzip_static:Nginx对于静态文件的处理模块,该模块可以读取预先压缩的gz文件，这样可以减少每次请求进行gzip压缩的CPU资源消耗,on|off</li>
<li>gzip_buffers:设置系统获取几个单位的缓存用于存储gzip的压缩结果数据流</li>
<li>gzip_comp_level:gzip压缩比，压缩级别是1-9,1的级别最低，9的压缩级别最高。压缩时间也随着增长</li>
<li>gzip_disable:可以通过该指令对一些特定的 User-Agent不使用压缩功能。</li>
<li>gzip_min_length:设置运行压缩的页面最小字数，页面字节数从相应消息头 Content-length 中进行获取</li>
<li>gzip_http_version:识别HTTP协议版本，1.1或1.0</li>
<li>gzip_proxied:用于设置启动或禁用从代理服务器上收到相应内容gzip压缩</li>
<li>gzip_vary:用于在响应消息头中添加 Vary:Accept-Encoding，是代理服务器根据请求头中的 Accept-Encoding 识别是否启动 gzip压缩。</li>
</ul>
<h3 id="gzip简单配置"><a href="#gzip简单配置" class="headerlink" title="gzip简单配置"></a><strong>gzip简单配置</strong></h3><p><code>etc/nginx/nginx.conf</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">   .....</span><br><span class="line">    gzip on;</span><br><span class="line">    gzip_types text/plain application/javascript text/css;</span><br><span class="line">   .....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/images/2018-11-26-前端必备的Nginx学习-gzipon.png" alt="gzipon"></p>
<p>上面是检测工具的结果，打开网站按 <code>F12</code>, 查看网站资源。</p>
<p><img src="/images/2018-11-26-前端必备的Nginx学习-gzipon-network.png" alt="network"></p>
<p>可以清楚的看见<code>Content-Encoding</code>为gzip类型。我们就成功的开启了gzip。</p>
<p>这个压缩的配置需要自己摸索，才可以知道最佳的压缩度。另外也并不是什么东西都需要压缩可以得到更小的文件。有些本来就很小的文件压缩后反而会变得比原来的大。另外图片注意不要启用gzip压缩</p>
<h2 id="应用之反向代理百度爬虫支持-Github-Pages-收录"><a href="#应用之反向代理百度爬虫支持-Github-Pages-收录" class="headerlink" title="应用之反向代理百度爬虫支持 Github Pages 收录"></a>应用之反向代理百度爬虫支持 Github Pages 收录</h2><p>百度爬取 github 给 403 的主要依据是 user agent，在 Nginx 中直接对 user agent 进行伪造</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  laibh.top;</span><br><span class="line"></span><br><span class="line">    #charset koi8-r;</span><br><span class="line">    #access_log  /var/log/nginx/host.access.log  main;</span><br><span class="line"></span><br><span class="line">    # location / &#123;</span><br><span class="line">    #     root   /usr/share/nginx/html;</span><br><span class="line">    #     index  index.html index.htm;</span><br><span class="line">    # &#125;</span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass         http://LbhFront-end.github.io; #替换成自己的 github pages 主页</span><br><span class="line">        proxy_redirect     off;</span><br><span class="line">        proxy_set_header   User-Agent "Mozilla/5.0";</span><br><span class="line">        proxy_set_header   Host                        $host;</span><br><span class="line">        proxy_set_header   X-Real-IP                $remote_addr;</span><br><span class="line">        proxy_set_header   X-Forwarded-For    $proxy_add_x_forwarded_for;      </span><br><span class="line">    &#125;   </span><br><span class="line"></span><br><span class="line">    location ~* \.(xml|html|htm)$ &#123;</span><br><span class="line">        proxy_pass         http://LbhFront-end.github.io; #替换成自己的 github pages 主页</span><br><span class="line">        proxy_redirect     off;</span><br><span class="line">        proxy_set_header   User-Agent "Mozilla/5.0";</span><br><span class="line">        proxy_set_header   Host                        $host;</span><br><span class="line">        proxy_set_header   X-Real-IP                $remote_addr;</span><br><span class="line">        proxy_set_header   X-Forwarded-For    $proxy_add_x_forwarded_for;      </span><br><span class="line">    &#125;     </span><br><span class="line"></span><br><span class="line">    #error_page  404              /404.html;</span><br><span class="line"></span><br><span class="line">    # redirect server error pages to the static page /50x.html</span><br><span class="line">    #</span><br><span class="line">    error_page   500 502 503 504  /50x.html;</span><br><span class="line">    location = /50x.html &#123;</span><br><span class="line">        root   /usr/share/nginx/html;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # proxy the PHP scripts to Apache listening on 127.0.0.1:80</span><br><span class="line">    #</span><br><span class="line">    #location ~ \.php$ &#123;</span><br><span class="line">    #    proxy_pass   http://127.0.0.1;</span><br><span class="line">    #&#125;</span><br><span class="line"></span><br><span class="line">    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span><br><span class="line">    #</span><br><span class="line">    #location ~ \.php$ &#123;</span><br><span class="line">    #    root           html;</span><br><span class="line">    #    fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">    #    fastcgi_index  index.php;</span><br><span class="line">    #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span><br><span class="line">    #    include        fastcgi_params;</span><br><span class="line">    #&#125;</span><br><span class="line"></span><br><span class="line">    # deny access to .htaccess files, if Apache's document root</span><br><span class="line">    # concurs with nginx's one</span><br><span class="line">    #</span><br><span class="line">    #location ~ /\.ht &#123;</span><br><span class="line">    #    deny  all;</span><br><span class="line">    #&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>百度抓取诊断记录一片绿，直接起飞</p>

      
    </div>
    
    
    

    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    赖彬鸿
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://laibh.top/2018-11-26-前端必备的Nginx学习.html" title="前端必备的Nginx学习">http://laibh.top/2018-11-26-前端必备的Nginx学习.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Nginx/" <i class="fa fa-tag"></i> Nginx</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018-11-12-JavaScipt数据结构与算法Part12.html" rel="next" title="为什么我要放弃javaScript数据结构与算法（第十二章）—— 算法复杂度">
                <i class="fa fa-chevron-left"></i> 为什么我要放弃javaScript数据结构与算法（第十二章）—— 算法复杂度
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018-11-28-NodeJs2-Part1.html" rel="prev" title="Nodejs实战 —— 欢迎进入Nodejs的世界">
                Nodejs实战 —— 欢迎进入Nodejs的世界 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
        
  <script>
    window._bd_share_config = {
      "common": {
        "bdText": "",
        "bdMini": "1",
        "bdMiniList": false,
        "bdPic": ""
      },
      "image": {
        "viewList": ["tsina", "douban", "sqq", "qzone", "weixin", "twi", "fbook"],
        "viewText": "分享到：",
        "viewSize": "16"
      },
      "slide": {
        "bdImg": "5",
        "bdPos": "left",
        "bdTop": "100"
      }
    }
  </script>

<script>
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/static/api/js/share.js?v=89860593.js?'+~(-new Date()/36e5)];;
</script>

      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC8zOTcwMy8xNjIzMA"></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/myPhoto.jpg"
                alt="赖彬鸿" />
            
              <p class="site-author-name" itemprop="name">赖彬鸿</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">135</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">32</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">40</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          
          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/LbhFront-end" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.cnblogs.com/lbh2018/" target="_blank" title="博客园">
                      
                        <i class="fa fa-fw fa-globe"></i>博客园</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://yq.aliyun.com/users/1802204154913774?spm=a2c4e.11153940.blogcont662526.4.6c0a34f6E2lR5o" target="_blank" title="云栖">
                      
                        <i class="fa fa-fw fa-globe"></i>云栖</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:544289495@qq.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=544289495&website=www.oicqzone.com" target="_blank" title="QQ">
                      
                        <i class="fa fa-fw fa-qq"></i>QQ</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.google.com.hk/search?safe=strict&source=hp&ei=JtLCXIriJ8G4-gS_-4qABQ&q=site%3Alaibh.top&btnK=Google+%E6%90%9C%E7%B4%A2&oq=site%3Alaibh.top&gs_l=psy-ab.3...1158.6834..7051...5.0..1.246.3720.2-17......0....1..gws-wiz.....0..0j0i10.rJMUHvdrbds" target="_blank" title="Google">
                      
                        <i class="fa fa-fw fa-google"></i>Google</a>
                  </span>
                
            </div>
          
         <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=90  src="//music.163.com/outchain/player?type=0&id=2353471182&auto=0&height=90"></iframe>
          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                友情链接
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.chjtx.com/JRoll/" title="醉萝卜" target="_blank">醉萝卜</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://hzd.plus/" title="Zhendong" target="_blank">Zhendong</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.cnblogs.com/cnyball" title="cnyballk" target="_blank">cnyballk</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://johnzz.top/" title="John" target="_blank">John</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://xiaojun1994.top/" title="xiaojun1994" target="_blank">xiaojun1994</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://me.ursb.me" title="Airing" target="_blank">Airing</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.iyouhun.com" title="游魂" target="_blank">游魂</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://icoty.github.io/" title="荒野之萍" target="_blank">荒野之萍</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://im-one.github.io/" title="imOne" target="_blank">imOne</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://blog.hourxu.com/" title="Ambre" target="_blank">Ambre</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.huyujs.com" title="胡雨" target="_blank">胡雨</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.andou.live" title="安逗" target="_blank">安逗</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.jianshu.com/u/701a8bbf4f7e" title="陈健斌" target="_blank">陈健斌</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://itobys.github.io/" title="汤姆Tom酱" target="_blank">汤姆Tom酱</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://breeze2.github.io/blog/" title="林毅锋" target="_blank">林毅锋</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.qzroc.com/" title="大鹏博客" target="_blank">大鹏博客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://lyreal666.com/" title="余腾靖的博客" target="_blank">余腾靖的博客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://buzuosheng.com/" title="不作声" target="_blank">不作声</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.baidu.com/s?ie=UTF-8&wd=site%3Alaibh.top" title="百度" target="_blank">百度</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.google.com.hk/search?safe=strict&source=hp&ei=zXdWXfemLJbO0PEP8qyXyA0&q=site%3Alaibh.top&oq=site%3Alaibh.top&gs_l=psy-ab.3...580.8501..8767...0.0..0.397.934.2-1j2......0....2j1..gws-wiz.QESXfWGadT0&ved=0ahUKEwi3wbusiofkAhUWJzQIHXLWBdkQ4dUDCAU&uact=5" title="谷歌" target="_blank">谷歌</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#了解Nginx和环境准备"><span class="nav-number">1.</span> <span class="nav-text">了解Nginx和环境准备</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Nginx是什么？"><span class="nav-number">1.1.</span> <span class="nav-text">Nginx是什么？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Nginx的优点"><span class="nav-number">1.2.</span> <span class="nav-text">Nginx的优点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用yum安装"><span class="nav-number">1.3.</span> <span class="nav-text">使用yum安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#建立目录"><span class="nav-number">1.4.</span> <span class="nav-text">建立目录</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Nginx的快速搭建"><span class="nav-number">2.</span> <span class="nav-text">Nginx的快速搭建</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Nginx版本说明"><span class="nav-number">2.1.</span> <span class="nav-text">Nginx版本说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建-yum源"><span class="nav-number">2.2.</span> <span class="nav-text">创建 yum源</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Nginx基本配置文件详解"><span class="nav-number">3.</span> <span class="nav-text">Nginx基本配置文件详解</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#nginx-conf"><span class="nav-number">3.1.</span> <span class="nav-text">nginx.conf</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#default-conf"><span class="nav-number">3.2.</span> <span class="nav-text">default.conf</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#启动服务"><span class="nav-number">3.3.</span> <span class="nav-text">启动服务</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Nginx服务启动、停止、重启"><span class="nav-number">4.</span> <span class="nav-text">Nginx服务启动、停止、重启</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#服务启动"><span class="nav-number">4.1.</span> <span class="nav-text">服务启动</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#服务停止"><span class="nav-number">4.2.</span> <span class="nav-text">服务停止</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#服务重启"><span class="nav-number">4.3.</span> <span class="nav-text">服务重启</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#自定义错误页和访问设置"><span class="nav-number">5.</span> <span class="nav-text">自定义错误页和访问设置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#多错误指向一个页面"><span class="nav-number">5.1.</span> <span class="nav-text">多错误指向一个页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#单独为错误置顶处理方式"><span class="nav-number">5.2.</span> <span class="nav-text">单独为错误置顶处理方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#把错误码换成一个地址"><span class="nav-number">5.3.</span> <span class="nav-text">把错误码换成一个地址</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#简单实现访问控制"><span class="nav-number">5.4.</span> <span class="nav-text">简单实现访问控制</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Nginx访问权限"><span class="nav-number">6.</span> <span class="nav-text">Nginx访问权限</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#指令优先级"><span class="nav-number">6.1.</span> <span class="nav-text">指令优先级</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#复杂访问控制权限匹配"><span class="nav-number">6.2.</span> <span class="nav-text">复杂访问控制权限匹配</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用正则表达式设置访问权限"><span class="nav-number">6.3.</span> <span class="nav-text">使用正则表达式设置访问权限</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Nginx设置虚拟主机"><span class="nav-number">7.</span> <span class="nav-text">Nginx设置虚拟主机</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#基于端口号配置虚拟主机"><span class="nav-number">7.1.</span> <span class="nav-text">基于端口号配置虚拟主机</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#基于IP配置虚拟主机"><span class="nav-number">7.2.</span> <span class="nav-text">基于IP配置虚拟主机</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用域名设置虚拟主机"><span class="nav-number">7.3.</span> <span class="nav-text">使用域名设置虚拟主机</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Nginx反向代理的设置"><span class="nav-number">8.</span> <span class="nav-text">Nginx反向代理的设置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#最简单的反向代理"><span class="nav-number">8.1.</span> <span class="nav-text">最简单的反向代理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Nginx适配PC或移动设备"><span class="nav-number">9.</span> <span class="nav-text">Nginx适配PC或移动设备</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#http-user-agent的使用"><span class="nav-number">9.1.</span> <span class="nav-text">$http_user_agent的使用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Nginx的Gzip压缩配置"><span class="nav-number">10.</span> <span class="nav-text">Nginx的Gzip压缩配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#gzip的配置项"><span class="nav-number">10.1.</span> <span class="nav-text">gzip的配置项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#gzip简单配置"><span class="nav-number">10.2.</span> <span class="nav-text">gzip简单配置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#应用之反向代理百度爬虫支持-Github-Pages-收录"><span class="nav-number">11.</span> <span class="nav-text">应用之反向代理百度爬虫支持 Github Pages 收录</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart throb" style="color: #d43f57;"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">赖彬鸿</span>

  
</div>

  <script src='https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js'></script>
  <script>
    if (window.mermaid) {
      mermaid.initialize("");
    }
  </script>

<!--

  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>



-->
<div>
<span id="busuanzi_container_site_pv" title="访问量">
    <i class="fa fa fa-eye"></i> <span id="busuanzi_value_site_pv"></span>
</span>
<span id="busuanzi_container_site_uv" title="访问人数">
  <i class="fa fa-user"></i> <span id="busuanzi_value_site_uv"></span>
</span>
<span class="post-count" title="博客总字数"><i class="fa fa-pagelines" aria-hidden="true"></i>745.9k</span>
</div>
<i class="fa fa-shield" aria-hidden="true" title="本站安全运行时间"></i> <span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span>
<script>
    var now = new Date();
    function createtime() {
        var grt= new Date("01/29/2018 09:47:04");//此处修改你的建站时间或者网站上线时间
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds);
        if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = dnum+" 天 ";
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒";
    }
setInterval("createtime()",250);
</script>

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>
  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="//cdn.bootcss.com/jquery/2.1.3/jquery.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  












  




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=5.1.4"></script>



  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("JcDzlAxx8A0MJDQ9xpJTOBUe-gzGzoHsz", "hih724suAgjSWQnvOuIEvxza");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  
  <script type="text/javascript" src="/js/src/js.cookie.js?v=5.1.4"></script>
  <script type="text/javascript" src="/js/src/scroll-cookie.js?v=5.1.4"></script>


  

  <!-- 代码块复制功能 -->
  <script type="text/javascript" src="/js/src/clipboard.js"></script>  
  <script type="text/javascript" src="/js/src/clipboard-use.js"></script>
<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/tororo.model.json"},"display":{"position":"right","width":200,"height":400},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
